<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<!-- Created by htmlize-1.34 in css mode. -->
<html>
  <head>
    <title>proxy-conn.hpp</title>
    <style type="text/css">
    <!--
      body {
        color: #000000;
        background-color: #ebebeb;
      }
      .comment {
        /* font-lock-comment-face */
        color: #666666;
      }
      .comment-delimiter {
        /* font-lock-comment-delimiter-face */
        color: #666666;
      }
      .constant {
        /* font-lock-constant-face */
        color: #00008b;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #0000ff;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #a020f0;
      }
      .negation-char {
      }
      .preprocessor {
        /* font-lock-preprocessor-face */
        color: #006400;
      }
      .string {
        /* font-lock-string-face */
        color: #008b00;
      }
      .type {
        /* font-lock-type-face */
        color: #0000ff;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #8b0000;
      }

      a {
        color: inherit;
        background-color: inherit;
        font: inherit;
        text-decoration: inherit;
      }
      a:hover {
        text-decoration: underline;
      }
    -->
    </style>
  </head>
  <body>
    <pre>
<span class="comment-delimiter">/**</span><span class="comment">
 * </span><span class="comment"><span class="keyword">@file</span></span><span class="comment">   proxy-conn.hpp
 * </span><span class="comment"><span class="keyword">@author</span></span><span class="comment"> Alex Ott &lt;<a href="mailto:alexott&#64;gmail.com">alexott&#64;gmail.com</a>&gt;
 * 
 * </span><span class="comment"><span class="keyword">@brief</span></span><span class="comment">  
 * 
 * 
 */</span>

<span class="preprocessor">#if</span><span class="negation-char"><span class="preprocessor">n</span></span><span class="preprocessor">def</span> _PROXY_CONN_H
<span class="preprocessor">#define</span> <span class="variable-name">_PROXY_CONN_H</span> 1

<span class="preprocessor">#include</span> <span class="string">"common.h"</span>
<span class="preprocessor">#include</span> <span class="string">&lt;map&gt;</span>

<span class="keyword">class</span> <span class="type">connection</span> : <span class="keyword">public</span> <span class="constant">boost</span>::<span class="type">enable_shared_from_this</span>&lt;<span class="type">connection</span>&gt; {
<span class="keyword">public</span>:
    <span class="keyword">typedef</span> <span class="constant">boost</span>::<span class="type">shared_ptr</span>&lt;<span class="type">connection</span>&gt; <span class="type">pointer</span>;

    <span class="keyword">static</span> <span class="type">pointer</span> <span class="function-name">create</span>(<span class="constant">ba</span>::<span class="type">io_service</span>&amp; <span class="variable-name">io_service</span>) {
        <span class="keyword">return</span> pointer(<span class="keyword">new</span> <span class="type">connection</span>(io_service));
    }

    <span class="constant">ba</span>::<span class="constant">ip</span>::<span class="constant">tcp</span>::<span class="type">socket</span>&amp; <span class="function-name">socket</span>() {
        <span class="keyword">return</span> bsocket_;
    }

    <span class="type">void</span> <span class="function-name">start</span>();

<span class="keyword">private</span>:
    <span class="function-name">connection</span>(<span class="constant">ba</span>::<span class="type">io_service</span>&amp; <span class="variable-name">io_service</span>);
    <span class="type">void</span> <span class="function-name">handle_browser_write</span>(<span class="keyword">const</span> <span class="constant">bs</span>::<span class="type">error_code</span>&amp; <span class="variable-name">err</span>, <span class="type">size_t</span> <span class="variable-name">len</span>);
    <span class="type">void</span> <span class="function-name">handle_browser_read_headers</span>(<span class="keyword">const</span> <span class="constant">bs</span>::<span class="type">error_code</span>&amp; <span class="variable-name">err</span>, <span class="type">size_t</span> <span class="variable-name">len</span>);
    <span class="type">void</span> <span class="function-name">handle_server_write</span>(<span class="keyword">const</span> <span class="constant">bs</span>::<span class="type">error_code</span>&amp; <span class="variable-name">err</span>, <span class="type">size_t</span> <span class="variable-name">len</span>);
    <span class="type">void</span> <span class="function-name">handle_server_read_headers</span>(<span class="keyword">const</span> <span class="constant">bs</span>::<span class="type">error_code</span>&amp; <span class="variable-name">err</span>, <span class="type">size_t</span> <span class="variable-name">len</span>);
    <span class="type">void</span> <span class="function-name">handle_server_read_body</span>(<span class="keyword">const</span> <span class="constant">bs</span>::<span class="type">error_code</span>&amp; <span class="variable-name">err</span>, <span class="type">size_t</span> <span class="variable-name">len</span>);
    <span class="type">void</span> <span class="function-name">start_connect</span>();
    <span class="type">void</span> <span class="function-name">start_write_to_server</span>();
    <span class="type">void</span> <span class="function-name">shutdown</span>();
    <span class="type">void</span> <span class="function-name">handle_resolve</span>(<span class="keyword">const</span> <span class="constant">boost</span>::<span class="constant">system</span>::<span class="type">error_code</span>&amp; <span class="variable-name">err</span>,
                                    <span class="constant">ba</span>::<span class="constant">ip</span>::<span class="constant">tcp</span>::<span class="constant">resolver</span>::<span class="type">iterator</span> <span class="variable-name">endpoint_iterator</span>);
    <span class="type">void</span> <span class="function-name">handle_connect</span>(<span class="keyword">const</span> <span class="constant">boost</span>::<span class="constant">system</span>::<span class="type">error_code</span>&amp; <span class="variable-name">err</span>,
                                    <span class="constant">ba</span>::<span class="constant">ip</span>::<span class="constant">tcp</span>::<span class="constant">resolver</span>::<span class="type">iterator</span> <span class="variable-name">endpoint_iterator</span>);

    <span class="constant">ba</span>::<span class="type">io_service</span>&amp; <span class="variable-name">io_service_</span>;
    <span class="constant">ba</span>::<span class="constant">ip</span>::<span class="constant">tcp</span>::<span class="type">socket</span> <span class="variable-name">bsocket_</span>;
    <span class="constant">ba</span>::<span class="constant">ip</span>::<span class="constant">tcp</span>::<span class="type">socket</span> <span class="variable-name">ssocket_</span>;
    <span class="constant">ba</span>::<span class="constant">ip</span>::<span class="constant">tcp</span>::<span class="type">resolver</span> <span class="variable-name">resolver_</span>;
    <span class="type">bool</span> <span class="variable-name">proxy_closed</span>;
    <span class="type">bool</span> <span class="variable-name">isPersistent</span>;
    <span class="type">int32_t</span> <span class="variable-name">RespLen</span>;
    <span class="type">int32_t</span> <span class="variable-name">RespReaded</span>;

    <span class="constant">boost</span>::<span class="type">array</span>&lt;<span class="type">char</span>, 8192&gt; <span class="variable-name">bbuffer</span>;
    <span class="constant">boost</span>::<span class="type">array</span>&lt;<span class="type">char</span>, 8192&gt; <span class="variable-name">sbuffer</span>;

    <span class="constant">std</span>::<span class="type">string</span> <span class="variable-name">fURL</span>;
    <span class="constant">std</span>::<span class="type">string</span> <span class="variable-name">fHeaders</span>;
    <span class="constant">std</span>::<span class="type">string</span> <span class="variable-name">fNewURL</span>;
    <span class="constant">std</span>::<span class="type">string</span> <span class="variable-name">fMethod</span>;
    <span class="constant">std</span>::<span class="type">string</span> <span class="variable-name">fReqVersion</span>;
    <span class="constant">std</span>::<span class="type">string</span> <span class="variable-name">fServer</span>;
    <span class="constant">std</span>::<span class="type">string</span> <span class="variable-name">fPort</span>;
    <span class="type">bool</span> <span class="variable-name">isOpened</span>;

    <span class="constant">std</span>::<span class="type">string</span> <span class="variable-name">fReq</span>;

    <span class="keyword">typedef</span> <span class="constant">std</span>::<span class="type">map</span>&lt;<span class="constant">std</span>::<span class="type">string</span>,<span class="constant">std</span>::<span class="type">string</span>&gt; <span class="type">headersMap</span>;
    <span class="type">headersMap</span> <span class="variable-name">reqHeaders</span>, <span class="variable-name">respHeaders</span>;
    
    <span class="type">void</span> <span class="function-name">parseHeaders</span>(<span class="keyword">const</span> <span class="constant">std</span>::<span class="type">string</span>&amp; <span class="variable-name">h</span>, <span class="type">headersMap</span>&amp; <span class="variable-name">hm</span>);
};


<span class="preprocessor">#endif</span> <span class="comment-delimiter">/* </span><span class="comment">_PROXY-CONN_H */</span>

</pre>
  </body>
</html>
