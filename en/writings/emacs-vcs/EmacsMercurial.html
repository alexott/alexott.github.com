<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
  <head>
    <title>Use Emacs to work with mercurial</title>
    <meta name="generator" content="muse.el">
    <meta name="author" content="Alex Ott">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="keywords" content="emacs, version control, mercurial, hg">
    
    <link rel="stylesheet" type="text/css" charset="utf-8" media="screen,projection" href="web.css">
    <link rel="stylesheet" type="text/css" href="print.css" media="print">
  </head>
  <body>
    <div id="wrap">
    <h1>Use Emacs to work with mercurial</h1>
    <!-- Page published by Emacs Muse begins here -->
<div class="contents">
<dl>
<dt>
<a href="#sec1">Работа с пакетом</a>
</dt>
<dt>
<a href="#sec2">Настройка пакета</a>
</dt>
</dl>
</div>


<h2><a name="sec1" id="sec1"></a>
Работа с пакетом</h2>

<p class="first">Принципы работы <em>mercurial.el</em> во многом аналогичны работе пакета VC (стоит отметить, что
поддержка <em>Mercurial</em> имеется и в VC) и используют те же самые привязки клавиш, что и пакет
VC.  <em>mercurial.el</em> &mdash; вспомогательный режим, который добавляет некоторое количество команд
для выполнения основных задач при работе с репозиториями.</p>

<p>Часть команд пакета имеет глобальные привязки клавиш (по умолчанию это <code>C-c h</code>, но может
быть и изменено в настройке), а часть команд доступна только внутри буфера, в котором
включен режим <code>hg-mode</code>.  При этом, для многих команд можно также задать префиксный
аргумент, который позволит задать дополнительные параметры в интерактивном режиме.
Справку по командам и привязкам клавиш пакета можно получить с помощью команды
<code>hg-help-overview</code> (<code>C-c h h</code>).</p>

<p>Чтобы просмотреть изменения, сделанные в процессе работы, пользователь может использовать
либо команду <code>hg-diff</code> (<code>C-x v =</code>), которая показывает изменения для текущего
файла, либо команду <code>hg-diff-repo</code> (<code>C-c h =</code>), которая показывает изменения для
всего репозитория.  Обе этих команды, открывают дополнительный буфер, в котором и
отображаются изменения.  Чтобы закрыть этот буфер используйте клавишу <code>q</code>.</p>

<p>Подтверждение изменений осуществляется командой <code>hg-commit-start</code>, которая имеет две
привязки клавиш: локальную &mdash; 
<code>C-x v n</code> и глобальную &mdash; 
<code>C-c h c</code>.  При выполнении этой
команды, <em>mercurial.el</em> создает новый буфер, в котором пользователь может ввести текст
сообщения, которое будет записано в журнал изменений.  Кроме текста пользователя, в нижней
части буфера отображается список файлов, изменения для которых будут подтверждены.  По
умолчанию, это все файлы, но пользователь может изменить этот список путем перемещения
курсора на имя файла и изменения признака выбора (жирный шрифт) с помощью клавиш <code>SPC</code> или
<code>RET</code>, или с помощью средней кнопки мыши.  На рисунке можно увидеть пример работы с этим
буфером, при подтверждении изменений.</p>

<p class="image"><img src="mercurial-el.png" alt=""></p>

<p>В буфере, созданном при выполнении команды <code>hg-commit-start</code> включается отдельный режим,
имеющий название <code>hg-commit-mode</code>.  Для него определено несколько сочетаний клавиш, которые
могут быть использованы пользователем.  <code>C-c C-c</code>, так же как и во многих других пакетах,
производит операцию подтверждения изменений в репозиторий, используя введенный
пользователем текст.  Сочетание <code>C-c C-k</code> прерывает процесс подтверждения изменений.  А
сочетание <code>C-x v =</code> позволяет выполнить просмотр подтверждаемых изменений.</p>

<p>Для отмены сделанных изменений можно также воспользоваться одной из двух команд:
<code>hg-revert-buffer</code> (<code>C-x v u</code>) откатывает изменения только для текущего файла, а команда
<code>hg-revert</code> (<code>C-c h U</code>) проделывает то же самое для всех измененных файлов в репозитории.</p>

<p>Для добавления файла в репозиторий можно воспользоваться командой <code>hg-add</code> (<code>C-c h a</code>).  По
умолчанию, она добавляет в репозиторий текущий файл, но если ей задать префиксный
аргумент, то она запросит имя файла, который необходимо добавить в репозиторий.  Функция
<code>hg-forget</code> (<code>C-c h f</code>) (она еще не реализована полностью) предназначена для отмены добавления
файла в репозиторий, если вы еще не выполнили команду подтверждения изменений, что бывает
полезно в некоторых случаях.</p>

<p>Чтобы посмотреть статус файлов в репозитории, можно воспользоваться командой <code>hg-status</code>
(<code>C-c h s</code>), но в отличии от других пакетов, пользователю не разрешается выполнять
какие либо операции с полученными данными.  Для просмотра истории изменений конкретного
файла определена команда <code>hg-log</code> (<code>C-x v l</code>).  Аналогичная команда для просмотра истории
изменений репозитория называется <code>hg-log-repo</code> (<code>C-c h l</code>).  Также, определена и команда
<code>hg-annotate</code> (<code>C-x v a</code>), которая должна показывать файл, с указанием того, в какой версии
что менялось, но пока эта функция полностью не реализована.</p>

<p>Кроме этих базовых операций, пакет также предоставляет набор основных операций для работы
с ветками и удаленными репозиториями.  Команда <code>hg-incoming</code> (<code>C-c h ,</code>) позволяет просмотреть
список изменений в удаленном репозитории, которые отсутствуют в текущем репозитории, а
команды <code>hg-pull</code> (<code>C-c h &lt;</code>) и hg-update (<code>C-c h u</code>), соответственно, скачать
изменения, и применить их к текущему репозиторию.  Команды <code>hg-outgoing</code> (C-c h .) и <code>hg-push</code>
(<code>C-c h &gt;</code>) позволяют просмотреть какие изменения присутствуют в текущем репозитории, но
отсутствуют в удаленном, и поместить их туда (push).</p>


<h2><a name="sec2" id="sec2"></a>
Настройка пакета</h2>

<p class="first">Настройка пакета осуществляется с помощью стандартных средств Emacs.  Группа настройки
называется <code>mercurial</code>.  Пользователь может, например, изменить префикс для глобальных
привязок клавиш, используемых некоторыми командами (по умолчанию &mdash; 
<code>C-c h</code>).</p>

<p>Пользователь для настройки поведения пакета может воспользоваться несколькими хуками,
которые будут вызываться в определенные моменты работы пакета.  <code>hg-commit-mode-hook</code> будет
вызываться после создания буфера, отображаемого пользователю перед подтверждением
изменений.  В свою очередь <code>hg-pre-commit-hook</code> вызывается после того, как пользователь
введет сообщение для журнала изменений, и перед тем, как будет выполнено подтверждение
изменений в репозитории.  <code>hg-log-mode-hook</code> вызывается после создания буфера, заполненного
информацией из журнала изменений при вызове команд <code>hg-log-repo</code> и <code>hg-log</code>.  И конечно,
пользователь может определить <code>hg-mode-hook</code>, который будет выполнен в процессе включения
<code>hg-mode</code> для данного буфера.</p>




<!-- Page published by Emacs Muse ends here -->
  </div>
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
	_uacct = "UA-78697-3";
	urchinTracker();
</script>
  </body>
</html>
