<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Пакет VC</title><meta name="generator" content="DocBook XSL Stylesheets V1.73.2"><meta name="keywords" content="Emacs, GNU Emacs, XEmacs, version control, configuration management, "><link rel="start" href="index.html" title="Использование Emacs совместно с системами контроля версий"><link rel="up" href="index.html" title="Использование Emacs совместно с системами контроля версий"><link rel="prev" href="ar01s01.html" title="Введение"><link rel="next" href="ar01s03.html" title="Пакет DVC"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Пакет <span class="application">VC</span></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ar01s01.html">Пред.</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ar01s03.html">След.</a></td></tr></table><hr></div><div class="section" lang="ru"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="emacs.vcs.vc"></a>Пакет <span class="application">VC</span></h2></div></div></div><p>Пакет <span class="application">VC</span> предоставляет пользователю унифицированный интерфейс к различным
  системам контроля версий.  В настоящее время существуют интерфейсы к системам <span class="application">RCS</span>,
  <span class="application">CVS</span>, <span class="application">MetaCVS</span>, <span class="application">Subversion</span>, <span class="application">GNU Arch</span>, <span class="application">SCCS</span>, <span class="application">Darcs</span>, <span class="application">SourceSafe</span>, <span class="application">ClearCase</span>,
  <span class="application">Git</span> и <span class="application">Mercurial</span> (некоторые из них доступны только в версии <span class="application">GNU Emacs</span> 22.0,
  репозитории <span class="application">GNU Emacs</span> или с сайтов авторов).  К тому же не все модули имеют поддержку
  всех команд, которые предоставляются пакетом <span class="application">VC</span>, например, модуль
  <span class="application">vc-arch</span> не поддерживает команду
  <code class="function">vc-cancel-version</code>, и некоторые другие.</p><div class="section" lang="ru"><div class="titlepage"><div><div><h3 class="title"><a name="id2523676"></a>Основные понятия и подходы</h3></div></div></div><p>На развитие пакета <span class="application">VC</span> очень сильное влияние оказала система контроля версий
    <span class="application">RCS</span>, поэтому некоторые концепции напрямую связаны с принципами использования данного
    пакета.</p><p>Когда файл находится под контролем системы контроля версий, то говорят, что файл
    «<span class="quote">зарегистрирован</span>» в системе контроля версий.  Каждому файлу соответствует
    «<span class="quote">главный</span>» файл, который содержит данные и историю изменений.
    «<span class="quote">Главному</span>» файлу может соответствовать «<span class="quote">рабочий</span>» файл, в
    который можно вносить изменения.  В некоторых системах контроля версий, вы должны
    «<span class="quote">блокировать</span>» рабочий файл, перед внесением изменений.  В других системах
    контроля версий, вы можете вносить изменения в собственные рабочие версии файлов, и
    должны явно подтверждать изменения в центральный репозиторий.  Для систем контроля
    версий, в которых требуются блокировка файлов, для внесения изменений необходимо
    перевести файл из состояния «<span class="quote">только для чтения</span>», в режим доступности для
    записи.  Плюс, в таких системах контроля версий, обычно только один пользователь может
    одновременно вносить изменения в файлы, а остальные пользователи должны ожидать
    окончания работы данного пользователя.  Это в первую очередь касается системы контроля
    версий <span class="application">RCS</span>.</p><p>При работе с пакетом <span class="application">VC</span> некоторая информация отображается в строке состояния. Информация представляется в следующем виде —  сначала идет сокращенное название
    системы контроля версий, контролирующей данный файл, затем идет символ, описывающий
    состояние файла, а затем отображается номер версии данного файла.  Если символ,
    описывающий состояние файла равен <code class="literal">-</code>, то файл не заблокирован
    или не изменен, а если он заблокирован или изменен, то будет использоваться
    символ <code class="literal">:</code>.  В том случае, если файл был заблокирован другим
    пользователем, то поле статуса будет выглядеть как <code class="literal">:user:</code>.</p></div><div class="section" lang="ru"><div class="titlepage"><div><div><h3 class="title"><a name="id2523849"></a>Работа с пакетом</h3></div></div></div><div class="section" lang="ru"><div class="titlepage"><div><div><h4 class="title"><a name="id2523855"></a>Основная цепочка действий</h4></div></div></div><p>Основной командой в пакете <span class="application">VC</span> является
      <code class="function">vc-next-action</code>, которая выполняет следующую
      логическую команду для данной системы контроля версий.  В зависимости
      от используемой системы контроля версий, порядок команд в цепочке
      действий может отличаться.</p><p>Для систем, которые требуют блокировки файла (это <span class="application">RCS</span>, <span class="application">SCCS</span>,
      и <span class="application">CVS</span> при соответствующей настройке), порядок действий следующий:
      </p><div class="orderedlist"><ol type="1"><li><p>если файл не зарегистрирован, то он регистрируется;</p></li><li><p>если файл зарегистрирован и не заблокирован, то команда вытягивает свежий файл, и блокирует его;</p></li><li><p>если файл был заблокирован пользователем, но не изменялся, то выполняется обновление буфера до новой версии;</p></li><li><p>если файл изменялся, то эта команда приводит к появлению буфера для ввода описания изменения, а затем подтверждает изменения;</p></li><li><p>если файл был заблокирован кем-то другим, то <span class="application">VC</span>
        старается получить блокировку.</p></li></ol></div><p>
      </p><p>Для систем не поддерживающих концепцию блокировок, порядок
      выполнения действия следующий:
      </p><div class="orderedlist"><ol type="1"><li><p>если файл не зарегистрирован, то он регистрируется, но изменения не подтверждаются;</p></li><li><p>если файл уже был добавлен, но не подтвержден, то это изменение подтверждается;</p></li><li><p>если файл был изменен, а «<span class="quote">главный</span>» файл
        нет, то ваши изменения подтверждаются после ввода описания
        изменений;</p></li><li><p>если файл в репозитории был изменен, то пользователю выдадут запрос на слияние изменений в ваш рабочий файл.</p></li></ol></div><p>
      </p><p>Пользователь может задавать префиксные аргументы для команды
      <code class="function">vc-next-action</code>.  Использование префиксного
      аргумента изменяет поведение команды, что позволяет изменять номер
      версии под которой файл будет зарегистрирован, номер версии, которую
      необходимо получить, или изменить имя используемой системы контроля
      версий, что часто полезно, если файл был зарегистрирован в нескольких
      системах контроля версий.</p><p>Ввод описания изменения производится в специальном буфере,
      который называется <code class="literal">*VC-Log*</code>.  В нем вы можете
      ввести сообщение, и подтвердить изменения используя сочетание клавиш
      <span class="keysym">C</span>+<span class="keysym">c</span>
      <span class="keysym">C</span>+<span class="keysym">c</span>, находясь в
      этом буфере.  Чтобы не подтверждать изменения, просто покиньте это
      буфер без использования <span class="keysym">C</span>+<span class="keysym">c</span> <span class="keysym">C</span>+<span class="keysym">c</span>.  А если вы хотите использовать одно и
      то же сообщение для нескольких файлов, то вы можете воспользоваться
      сочетаниями клавиш <span class="keysym">M</span>+<span class="keysym">n</span>, <span class="keysym">M</span>+<span class="keysym">p</span>, <span class="keysym">M</span>+<span class="keysym">s</span> и <span class="keysym">M</span>+<span class="keysym">r</span>, которые работают так же как и в
      мини-буфере, позволяя перемещаться по истории сообщений.</p></div><div class="section" lang="ru"><div class="titlepage"><div><div><h4 class="title"><a name="id2524316"></a>Работа с изменениями</h4></div></div></div><p>Пакет <span class="application">VC</span> позволяет пользователю просматривать изменения
      внесенные в процессе работы с файлами.  Для получения списка изменений
      между вашей рабочей версией и последней подтвержденной версией,
      пользователь может воспользоваться командой
      <code class="function">vc-diff</code> (сочетание клавиш
      <span class="keysym">C</span>+<span class="keysym">x</span>
      <span class="keysym">v</span> <span class="keysym">=</span>).  При использовании данной
      команды с префиксным аргументом, пользователь может получить список
      изменений между двумя произвольными версиями.  Команда
      <code class="function">vc-version-other-window</code> (сочетание
      <span class="keysym">C</span>+<span class="keysym">x</span>
      <span class="keysym">v</span> <span class="keysym">~</span>) позволяет получить произвольную
      версию файла, и показать ее в отдельном буфере.  А некоторые версии
      систем контроля версий позволяют получать аннотированные версии
      файлов, находящихся под управлением системы контроля версий.  Эту
      задачу реализует команда <code class="function">vc-annotate</code>, которая
      запускается сочетанием <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">v</span> <span class="keysym">g</span>.
      Аннотированная версия позволяет понять как вносились изменения, и
      просматривать изменения внесенные в конкретных версиях.</p><p>Вы можете отменить внесенные изменения с помощью команд, определенных пакетом. Пакет определяет две команды отмены изменений —  <code class="function">vc-revert-buffer</code> (сочетание
      <span class="keysym">C</span>+<span class="keysym">x</span>
      <span class="keysym">v</span> <span class="keysym">u</span>), которая возвращает файл
      связанный с буфером к версии, на которой он был основан, а команда
      <code class="function">vc-cancel-version</code> (сочетание
      <span class="keysym">C</span>+<span class="keysym">x</span>
      <span class="keysym">v</span> <span class="keysym">c</span>) отменяет последнее
      подтвержденное изменение.  Для последней команды, вы можете не
      откатывать изменения для текущего буфера, так что вы можете внести
      новые изменения, основанные на промежуточных результатах.  После
      выполнения команды <code class="function">vc-revert-buffer</code> файл остается
      не заблокированным, так что для внесения изменений, вас необходимо
      снова заблокировать его.</p></div><div class="section" lang="ru"><div class="titlepage"><div><div><h4 class="title"><a name="id2570989"></a>Работа с файлами</h4></div></div></div><p>Регистрация файла в системе контроля версий производится с
      помощью команды <code class="function">vc-register</code> (сочетание клавиш
      <span class="keysym">C</span>+<span class="keysym">x</span>
      <span class="keysym">v</span> <span class="keysym">i</span>).  Выбор системы контроля версий
      в которой файл будет зарегистрирован, зависит от нескольких
      параметров.  Если в данном каталоге есть файлы, зарегистрированные в
      какой-либо системе контроля версий, то используется именно она.  Если
      в каталоге находятся файлы зарегистрированные в нескольких системах
      контроля версий, то используется та, которая находится первой в списке
      <code class="varname">vc-handled-backends</code>.  А если нет ни одного
      зарегистрированного файла в данном каталоге, то используется первая
      запись из списка <code class="varname">vc-handled-backends</code>.  Так что вы
      зарегистрируете файл в <span class="application">CVS</span> в пустом каталоге только явно указав
      использовать эту систему контроля версий :-)</p><p>По умолчанию, новый файл получает номер версии равный 1.1.  Вы
      можете использовать другое число, если вы используете числовой
      аргумент при выполнении данной команды.  В том случае, если переменная
      <code class="varname">vc-initial-comment</code> имеет не пустое значение, то
      данная команда запросит у пользователя комментарий, который будет
      использован для описания файла.</p><p>Пакет <span class="application">VC</span> поддерживает переименование зарегистрированных
      файлов.  Для этой цели вы можете использовать команду
      <code class="function">vc-rename-file</code>, которая переименовывает рабочий
      файл, а также «<span class="quote">главный</span>» файл.  К тому же эта команда,
      обновляет все снимки, чтобы они ссылались на новое имя файла.  Но вы
      не можете использовать эту команду для заблокированных файлов.</p><p>Для получения информации о текущем файле вы можете использовать
      команду <code class="function">vc-print-log</code>, которая привязана к
      сочетанию клавиш <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">v</span> <span class="keysym">l</span>.
      Данная команда отображает историю изменений, включая текст
      комментариев к этим изменениям.</p></div><div class="section" lang="ru"><div class="titlepage"><div><div><h4 class="title"><a name="id2571184"></a>Использование <span class="application">VC</span> совместно с Dired</h4></div></div></div><p>Команды описанные в предыдущих разделах в первую очередь предназначены для работы с отдельными файлами. Но для больших проектов, часто необходимо работать с множеством файлов — 
      просматривать какие файлы изменились, список изменений и т.п.  Для
      реализации этих действий, пакет <span class="application">VC</span> поддерживает специальный режим —  <code class="function">vc-dired-mode</code>.  Для создания буфера,
      использующего такой режим, используется команда
      <code class="function">vc-directory</code> (сочетание
      <span class="keysym">C</span>+<span class="keysym">x</span>
      <span class="keysym">v</span> <span class="keysym">d</span>).  Буфер созданный такой
      командой почти не отличается от обычного буфера Dired.  В буфер
      помещается рекурсивный список файлов, зарегистрированных в системе
      контроля версий.</p><p>При работе с буфером dired, данные могут отображаться в
      сокращенном или полном режиме.  В сокращенном режиме показываются
      только измененные или не обновленные файлы.  В полном режиме,
      показываются все файлы зарегистрированные в системе контроля версий.
      Пользователь может переключаться между полным и сокращенным режимом с
      помощью сочетания клавиш <span class="keysym">v</span> <span class="keysym">t</span>.  При
      показе данных в буфере, отображается имя пользователя (для систем
      поддерживающих блокировки) или статус файла (для остальных
      систем).</p><p>В буфере с <code class="function">vc-dired-mode</code> действуют все
      команды dired, за исключением команды <span class="keysym">v</span>, которая
      используется в качестве префиксной для команд пакета <span class="application">VC</span>.  Команды
      <span class="application">VC</span> те же самые, что и описанные в прочих разделах, только не
      используется префикс <span class="keysym">C</span>+<span class="keysym">x</span>, и они могут выполняться к множеству
      помеченных файлов.</p></div><div class="section" lang="ru"><div class="titlepage"><div><div><h4 class="title"><a name="id2571358"></a>Ветви версий (branches)</h4></div></div></div><p>Как и другие пакеты для интеграции с системами контроля версий,
      пакет <span class="application">VC</span> поддерживает работу с разными ветвями версий.  Пакет
      поддерживает создание ветвей, переключение между ними, а также слияние
      изменений между разными ветвями.  Для переключения на другую ветвь
      разработки пользователю необходимо лишь задать префиксный аргумент для
      команды <code class="function">vc-next-action</code>.  Пользователь может
      указывать не конкретную версию, а лишь номер ветви.  Следующая работа
      будет производиться именно в этой ветви.</p><p>Создание новой версии производится аналогичным образом — 
      необходимо лишь при подтверждении изменений с помощью команды
      <code class="function">vc-next-action</code> указать новый номер версии
      используя префиксный аргумент.  Если пользователь укажет номер для не
      существующей ветви, то она будет создана.  После создания ветви, все
      остальные действия будут производиться в рамках этой ветви.  Для
      работы с другой веткой, пользователь должен явно переключиться на
      нее.</p><p>Для слияния изменений используется команда
      <code class="function">vc-merge</code>, которая привязана к сочетанию клавиш
      <span class="keysym">C</span>+<span class="keysym">x</span>
      <span class="keysym">v</span> <span class="keysym">m</span>.  Данная команда запрашивает у
      вас откуда необходимо брать изменения, и применяет их к вашей рабочей
      версии.  Если вы ничего не ввели в ответ на запрос, то будут взяты
      изменения из ветви с которой вы работаете, если они были подтверждены
      за время работы с вашим файлом.  Если во время работы возникают
      конфликты, то пакет оповещает пользователя об этом, и помечает
      конфликты в файле, или даже может запустить Ediff для их разрешения.
      Вы можете воспользоваться командой
      <code class="function">vc-resolve-conflicts</code> для разрешения возникших
      конфликтов.  Она запускает новую сессию Ediff, где вы можете
      просматривать возникшие конфликты, и применять или отвергать
      предлагаемые изменения.</p></div><div class="section" lang="ru"><div class="titlepage"><div><div><h4 class="title"><a name="id2571509"></a>Взаимодействие с удаленными репозиториями</h4></div></div></div><p>Некоторые системы контроля версий поддерживают концепцию
      центрального репозитория, который хранит «<span class="quote">главные</span>» файлы, а также
      историю изменений.  Репозиторий может быть локальным, или
      располагаться на удаленном сервере.  <span class="application">VC</span> автоматически распознает тот
      случай, когда репозиторий располагается на удаленном сервере, и
      принимает некоторые действия, которые позволяют более комфортно
      работать с данными, особенно в тех случаях, когда связь является
      медленной и нестабильной.</p><p>При первом редактировании файла, создается локальная копия
      изменяемого файла.  Это позволяет выполнять команды получения списка
      изменений, или отмены внесенных изменений, без какого-либо сетевого
      взаимодействия.  Создаваемая копия файла имеет имя
      <code class="filename">FILE.~VERSION.~</code>.  При подтверждении изменений в
      репозиторий, локальная копия удаляется.  Пользователи также могут
      создавать резервные копии вручную, используя команду
      <code class="function">vc-version-other-window</code>, разница между резервными
      копиями созданными автоматически и вручную, лишь в лишнем знаке точка
      перед знаком <code class="literal">~</code>.  Многие команды <span class="application">VC</span> могут
      использовать любую из резервных копий.</p></div><div class="section" lang="ru"><div class="titlepage"><div><div><h4 class="title"><a name="id2571614"></a>Работа со «<span class="quote">снимками</span>»</h4></div></div></div><p>«<span class="quote">Снимок</span>» (snapshot) —  это именованный набор версий
      файлов, который может рассматриваться как отдельная единица.
      Некоторые системы контроля версий сами поддерживают концепцию
      «<span class="quote">снимков</span>», тогда пакет <span class="application">VC</span> использует эти возможности.
      Для прочих систем контроля версий, пакет <span class="application">VC</span> сам реализует поддержку
      «<span class="quote">снимков</span>».  В этом случае, эти «<span class="quote">снимки</span>»
      видны только при использовании пакета <span class="application">VC</span>.</p><p>Для работы со «<span class="quote">снимками</span>» пакет <span class="application">VC</span> определяет две
      команды.  Команда <code class="function">vc-create-snapshot</code> (сочетание
      <span class="keysym">C</span>+<span class="keysym">x</span>
      <span class="keysym">v</span> <span class="keysym">s</span>) создает «<span class="quote">снимок</span>»
      на базе версий файлов находящихся в текущем каталоге, или ниже.
      Команда <code class="function">vc-retrieve-snapshot</code> (сочетание клавиш
      <span class="keysym">C</span>+<span class="keysym">x</span>
      <span class="keysym">v</span> <span class="keysym">r</span>) позволяет пользователю получить
      «<span class="quote">снимок</span>» с заданным именем.</p><p>Многие команды пакета <span class="application">VC</span> позволяют использовать имена
      «<span class="quote">снимков</span>» в качестве аргументов вместо номеров версий
      файлов.  Это особенно полезно просмотре списка изменений между
      релизами программ.</p></div><div class="section" lang="ru"><div class="titlepage"><div><div><h4 class="title"><a name="id2571786"></a>Прочие команды</h4></div></div></div><p>Обычно, для файлов находящихся под управлением системы контроля
      версий, для каждого файла ведется отдельный список изменений.  Но в
      проектах GNU списки изменений ведутся для всего проекта, или для
      отдельных каталогов.  Для организации взаимодействия между этими двумя
      подходами, пакет <span class="application">VC</span> определяет отдельную команду
      <code class="function">vc-update-change-log</code> (она привязана к сочетанию
      <span class="keysym">C</span>+<span class="keysym">x</span>
      <span class="keysym">v</span> <span class="keysym">a</span>), которая обновляет общий список
      изменений на основании списка изменений для отдельных файлов.  При
      использовании префиксов, данная команда позволяет обновить общий
      список изменений, только изменениями для отдельных файлов.</p><p>Вы можете вставлять в файлы специальные идентификационные
      заголовки.  Эти заголовки зависят от конкретной используемой системы
      контроля версий, и в некоторых системах, они используются для
      служебных целей.  Для вставки такого заголовка, вы можете использовать
      команду <code class="function">vc-insert-headers</code> (сочетание клавиш
      <span class="keysym">C</span>+<span class="keysym">x</span>
      <span class="keysym">v</span> <span class="keysym">h</span>).  <span class="application">VC</span> автоматически выбирает
      заголовок подходящий для системы контроля версий.  Заголовки хранятся
      в переменных вида <code class="varname">vc-BACKEND-header</code>, так что вы
      можете изменять их значения, для вставки собственных
      заголовков.</p></div></div><div class="section" lang="ru"><div class="titlepage"><div><div><h3 class="title"><a name="id2571928"></a>Настройка</h3></div></div></div><p>Используя стандартные средства настройки Emacs пользователь может
    настроить поведение выполняемых команд.  Для этого необходимо лишь
    выполнить <code class="function"><span class="keysym">M</span>+<span class="keysym">x</span> customize-group vc</code>.  Часть
    опций применяется ко всем поддерживаемым системам контроля версий, часть
    применяется только к конкретным реализациям.  Полное описание основных
    переменных, используемых для настройки пакета <span class="application">VC</span> вы можете найти в
    руководстве по <span class="application">GNU Emacs</span>.</p></div><div class="section" lang="ru"><div class="titlepage"><div><div><h3 class="title"><a name="id2571983"></a>Дополнительная информация</h3></div></div></div><p>Некоторые из подсистем, обеспечивающих работу пакета <span class="application">VC</span> с разными системами
    контроля версий доступны только с сайтов их авторов, и пока не включены в поставку
    <span class="application">GNU Emacs</span> или <span class="application">XEmacs</span>.  Вы можете найти эти модули по адресам: <a class="ulink" href="http://www.emacswiki.org/elisp/vc-darcs.el" target="_top">vc-darcs</a>, <a class="ulink" href="http://www.chezmarshall.freeserve.co.uk/elisp/vcvss.html" target="_top">vc-vss</a>, <a class="ulink" href="http://www.fukt.hk-r.se/~flognat/vc/" target="_top">vc-clearcase</a>.</p><p>Много информации относящейся к пакету <span class="application">VC</span>, а также к другим модулям вы можете
    найти на сайте <a class="ulink" href="http://www.emacswiki.org/cgi-bin/wiki/CategoryVersionControl" target="_top">Emacs WiKi</a>.
    Кроме этого, подробное описание пакета вы можете найти в руководстве по
    <span class="application">Emacs</span>.</p></div></div><script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">
      _uacct = "UA-78697-3";
      urchinTracker();
    </script><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ar01s01.html">Пред.</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ar01s03.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">Введение </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> Пакет <span class="application">DVC</span></td></tr></table></div></body></html>
