<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Поддержка Mercurial</title><link rel="stylesheet" href="web.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.73.2"><meta name="keywords" content="Emacs, GNU Emacs, XEmacs, version control, configuration management, "><link rel="start" href="index.html" title="Использование Emacs совместно с системами контроля версий"><link rel="up" href="index.html" title="Использование Emacs совместно с системами контроля версий"><link rel="prev" href="ar01s14.html" title="Работа с Git"><link rel="next" href="ar01s16.html" title="Дополнительная информация"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Поддержка <span class="application">Mercurial</span></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ar01s14.html">Пред.</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ar01s16.html">След.</a></td></tr></table><hr></div><div class="section" lang="ru"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="emacs.vcs.mercurial"></a>Поддержка <span class="application">Mercurial</span></h2></div></div></div><p>Поддержка <span class="application">Mercurial</span> в <span class="application">Emacs</span> реализуется несколькими пакетами.  В поставке
  <span class="application">Mercurial</span> идет пакет <span class="application">mercurial.el</span>.  Также поддержка <span class="application">Mercurial</span> может обеспечиваться
  модулем из пакета <span class="application">DVC</span>, который описан в разделе <a class="xref" href="ar01s03.html" title="Пакет DVC">Пакет <span class="application">DVC</span></a>.  Данный раздел будет полностью посвящен описанию пакета
  <span class="application">mercurial.el</span>.</p><div class="section" lang="ru"><div class="titlepage"><div><div><h3 class="title"><a name="id2591904"></a>Установка и настройка пакета</h3></div></div></div><p>Для установки пакета необходимо скопировать его из каталога
    <code class="filename">contrib</code> дистрибутива <span class="application">Mercurial</span> в то место, где его сможет найти
    <span class="application">Emacs</span>, и прописать в файле инициализации следующую команду<sup>[<a name="id2591937" href="#ftn.id2591937" class="footnote">7</a>]</sup>:

    </p><pre class="screen">(require 'mercurial)</pre><p>

    </p></div><div class="section" lang="ru"><div class="titlepage"><div><div><h3 class="title"><a name="id2591970"></a>Работа с пакетом</h3></div></div></div><p>Принципы работы <span class="application">mercurial.el</span> во многом аналогичны работе пакета <span class="application">VC</span> (стоит
  отметить, что поддержка <span class="application">Mercurial</span> имеется и в <span class="application">VC</span>) и используют те же самые привязки
  клавиш, что и пакет <span class="application">VC</span>.  <span class="application">mercurial.el</span> —  вспомогательный режим, который
  добавляет некоторое количество команд для выполнения основных задач при работе с
  репозиториями.</p><p>Часть команд пакета имеет глобальные привязки клавиш (по умолчанию это
  <span class="keysym">C</span>+<span class="keysym">c</span> <span class="keysym">h</span>, но
  может быть и изменено в настройке), а часть команд доступна только внутри буфера, в
  котором включен режим <code class="function">hg-mode</code>.  При этом, для многих команд можно
  также задать префиксный аргумент, который позволит задать дополнительные параметры в
  интерактивном режиме.  Справку по командам и привязкам клавиш пакета можно получить с
  помощью команды <code class="function">hg-help-overview</code> (<span class="keysym">C</span>+<span class="keysym">c</span> <span class="keysym">h</span> <span class="keysym">h</span>).</p><p>Чтобы просмотреть изменения, сделанные в процессе работы, пользователь может
  использовать либо команду <code class="function">hg-diff</code> (<span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">v</span> <span class="keysym">=</span>), которая
  показывает изменения для текущего файла, либо команду <code class="function">hg-diff-repo</code>
  (<span class="keysym">C</span>+<span class="keysym">c</span> <span class="keysym">h</span> <span class="keysym">=</span>), которая показывает
  изменения для всего репозитория.  Обе этих команды, открывают дополнительный буфер, в
  котором и отображаются изменения.  Чтобы закрыть этот буфер используйте
  клавишу <span class="keysym">q</span>.</p><p>Подтверждение изменений осуществляется командой
  <code class="function">hg-commit-start</code>, которая имеет две привязки клавиш: локальную —  <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">v</span> <span class="keysym">n</span> и глобальную — 
  <span class="keysym">C</span>+<span class="keysym">c</span> <span class="keysym">h</span> <span class="keysym">c</span>.  При выполнении этой
  команды, <span class="application">mercurial.el</span> создает новый буфер, в котором пользователь может ввести текст
  сообщения, которое будет записано в журнал изменений.  Кроме текста пользователя, в
  нижней части буфера отображается список файлов, изменения для которых будут
  подтверждены.  По умолчанию, это все файлы, но пользователь может изменить этот список
  путем перемещения курсора на имя файла и изменения признака выбора (жирный шрифт) с
  помощью клавиш <span class="keysym">SPC</span> или <span class="keysym">RET</span>, или с помощью средней
  кнопки мыши.  На рисунке <a class="xref" href="ar01s15.html#emacs.vcs.mercurial.window" title="Рисунок 6. Подтверждение изменений в репозиторий mercurial">Подтверждение изменений в репозиторий mercurial</a> можно увидеть пример работы с этим буфером,
  при подтверждении изменений.</p><p>
      </p><div class="figure-float" style="float: left;"><div class="figure"><a name="emacs.vcs.mercurial.window"></a><p class="title"><b>Рисунок 6. Подтверждение изменений в репозиторий mercurial</b></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="mercurial-el.png" alt="Подтверждение изменений в репозиторий mercurial"></div></div></div></div><br class="figure-break"></div><p>
    </p><p>В буфере, созданном при выполнении команды <code class="function">hg-commit-start</code>
  включается отдельный режим, имеющий название <code class="function">hg-commit-mode</code>.  Для
  него определено несколько сочетаний клавиш, которые могут быть использованы
  пользователем.  <span class="keysym">C</span>+<span class="keysym">c</span> <span class="keysym">c</span>+<span class="keysym">c</span>, так же как
  и во многих других пакетах, производит операцию подтверждения изменений в репозиторий,
  используя введенный пользователем текст.  Сочетание <span class="keysym">C</span>+<span class="keysym">c</span> <span class="keysym">c</span>+<span class="keysym">k</span> прерывает процесс подтверждения изменений.  А сочетание
  <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">v</span> <span class="keysym">=</span> позволяет выполнить просмотр
  подтверждаемых изменений.</p><p>Для отмены сделанных изменений можно также воспользоваться одной из двух команд:
  <code class="function">hg-revert-buffer</code> (<span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">v</span> <span class="keysym">u</span>) откатывает изменения только
  для текущего файла, а команда <code class="function">hg-revert</code>
  (<span class="keysym">C</span>+<span class="keysym">c</span> <span class="keysym">h</span> <span class="keysym">U</span>) проделывает то же самое для
  всех измененных файлов в репозитории.</p><p>Для добавления файла в репозиторий можно воспользоваться командой
  <code class="function">hg-add</code> (<span class="keysym">C</span>+<span class="keysym">c</span> <span class="keysym">h</span> <span class="keysym">a</span>).  По умолчанию, она
  добавляет в репозиторий текущий файл, но если ей задать префиксный аргумент, то она
  запросит имя файла, который необходимо добавить в репозиторий.  Функция
  <code class="function">hg-forget</code> (<span class="keysym">C</span>+<span class="keysym">c</span> <span class="keysym">h</span> <span class="keysym">f</span>) (она еще не реализована
  полностью) предназначена для отмены добавления файла в репозиторий, если вы еще не
  выполнили команду подтверждения изменений, что бывает полезно в некоторых
  случаях.</p><p>Чтобы посмотреть статус файлов в репозитории, можно воспользоваться командой
  <code class="function">hg-status</code> (<span class="keysym">C</span>+<span class="keysym">c</span> <span class="keysym">h</span> <span class="keysym">s</span>), но в отличии от других
  пакетов, пользователю не разрешается выполнять какие либо операции с полученными
  данными.  Для просмотра истории изменений конкретного файла определена команда
  <code class="function">hg-log</code> (<span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">v</span> <span class="keysym">l</span>).  Аналогичная команда для
  просмотра истории изменений репозитория называется <code class="function">hg-log-repo</code>
  (<span class="keysym">C</span>+<span class="keysym">c</span> <span class="keysym">h</span> <span class="keysym">l</span>).  Также, определена и
  команда <code class="function">hg-annotate</code> (<span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">v</span> <span class="keysym">a</span>), которая
  должна показывать файл, с указанием того, в какой версии что менялось, но пока эта
  функция полностью не реализована.</p><p>Кроме этих базовых операций, пакет также предоставляет набор основных операций для
  работы с ветками и удаленными репозиториями.  Команда <code class="function">hg-incoming</code>
  (<span class="keysym">C</span>+<span class="keysym">c</span> <span class="keysym">h</span> <span class="keysym">,</span>) позволяет просмотреть
  список изменений в удаленном репозитории, которые отсутствуют в текущем репозитории, а
  команды <code class="function">hg-pull</code> (<span class="keysym">C</span>+<span class="keysym">c</span> <span class="keysym">h</span> <span class="keysym">&lt;</span>) и hg-update
  (<span class="keysym">C</span>+<span class="keysym">c</span> <span class="keysym">h</span> <span class="keysym">u</span>), соответственно, скачать
  изменения, и применить их к текущему репозиторию.  Команды
  <code class="function">hg-outgoing</code> (<span class="keysym">C</span>+<span class="keysym">c</span> <span class="keysym">h</span> <span class="keysym">.</span>) и
  <code class="function">hg-push</code> (<span class="keysym">C</span>+<span class="keysym">c</span> <span class="keysym">h</span> <span class="keysym">&gt;</span>) позволяют просмотреть
  какие изменения присутствуют в текущем репозитории, но отсутствуют в удаленном, и
  поместить их туда (push).</p></div><div class="section" lang="ru"><div class="titlepage"><div><div><h3 class="title"><a name="id2592782"></a>Настройка пакета</h3></div></div></div><p>Настройка пакета осуществляется с помощью стандартных средств EMACS.  Группа
настройки называется <code class="varname">mercurial</code>. Пользователь может, например, изменить префикс для глобальных привязок клавиш, используемых некоторыми командами (по умолчанию —  <span class="keysym">C</span>+<span class="keysym">c</span> <span class="keysym">h</span>).</p><p>Пользователь для настройки поведения пакета может воспользоваться несколькими
хуками, которые будут вызываться в определенные моменты работы пакета.
<code class="varname">hg-commit-mode-hook</code> будет вызываться после создания буфера,
отображаемого пользователю перед подтверждением изменений.  В свою очередь
<code class="varname">hg-pre-commit-hook</code> вызывается после того, как пользователь введет
сообщение для журнала изменений, и перед тем, как будет выполнено подтверждение изменений
в репозитории.  <code class="varname">hg-log-mode-hook</code> вызывается после создания буфера,
заполненного информацией из журнала изменений при вызове команд
<code class="varname">hg-log-repo</code> и <code class="varname">hg-log</code>.  И конечно, пользователь может
определить <code class="varname">hg-mode-hook</code>, который будет выполнен в процессе включения
<code class="varname">hg-mode</code> для данного буфера.</p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a name="ftn.id2591937" href="#id2591937" class="para">7</a>] </sup>Самую
    последнюю версию пакета <span class="application">mercurial.el</span> можно взять из репозитория, ссылка на который
    указана на <a class="ulink" href="http://www.emacswiki.org/cgi-bin/wiki/MercurialMode" target="_top">странице
    Emacs WiKi, посвященной <span class="application">Mercurial</span></a>.</p></div></div></div><script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">
      _uacct = "UA-78697-3";
      urchinTracker();
    </script><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ar01s14.html">Пред.</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ar01s16.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">Работа с  <span class="application">Git</span> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> Дополнительная информация</td></tr></table></div></body></html>
