<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html><head><title>Интеграция с Perforce</title>
<meta name="generator" content="muse.el" />
<meta name="author" content="Alex Ott" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="keywords" content="alex ott, emacs, perforce, p4" />


<link rel="stylesheet" type="text/css" charset="utf-8" media="screen,projection" href="../../../web.css" />
<link rel="stylesheet" type="text/css" href="../../../print.css" media="print" />
<link rel="alternate" type="application/atom+xml" title="Alex Ott's Russian Blog" href="http://feeds.feedburner.com/alexott-ru" />
<link rel="alternate" type="application/atom+xml" title="Alex Ott's English Blog" href="http://feeds.feedburner.com/alexott" />
<link rel="alternate" type="application/atom+xml" title="Alex Ott's German Blog" href="http://feeds.feedburner.com/alexott-de" />
</head><body>
<div id="wrap"><div id="header"><h1>Интеграция с Perforce</h1>
<p><a href="../../../ru/index.html">Russian</a>
&middot; <a href="../../../en/index.html">English</a></p></div>
<div id="leftside"><h2 class="hide">Меню:</h2><ul class="avmenu"><li><a href="../../index.html">Главная</a></li><li><a href="../../cf/">Информационная безопасность</a></li><li><a href="../../fp/">Функциональное программирование</a></li><li><a href="../../lisp/">Lisp</a></li><li><a href="../../clojure/">Clojure</a></li><li><a href="../../scheme/">Scheme</a></li><li><a href="../../erlang/">Erlang</a></li><li><a href="../../cpp/">C++</a></li><li><a href="../../oss/">Open Source Projects</a></li><li><a href="../../emacs/">Emacs</a></li><li><a href="../../writings/" class="current">Статьи</a></li></ul>
<div class="announce"><br><form action="http://www.google.com/cse" id="searchbox_006849776194404728512:q7vjogjzehm">  
<input type="hidden" name="cx" value="006849776194404728512:q7vjogjzehm">  
<input type="text" name="q" size="17">  <input type="submit" name="sa" value="Search"> </form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=searchbox_006849776194404728512%3Aq7vjogjzehm&lang=ru"></script></div></div> <!-- leftside -->
<div id="contentwide">
<div class="contents">
<dl>
<dt>
<a href="#sec1">Установка</a>
</dt>
<dt>
<a href="#sec2">Работа с пакетом</a>
</dt>
<dt>
<a href="#sec3">Работа с репозиторием, файлами, заданиями и ветками</a>
</dt>
<dt>
<a href="#sec4">Работа с изменениями</a>
</dt>
<dt>
<a href="#sec5">Получение информации</a>
</dt>
<dt>
<a href="#sec6">Управление репозиторием</a>
</dt>
<dt>
<a href="#sec7">Прочие команды</a>
</dt>
<dt>
<a href="#sec8">Настройка</a>
</dt>
<dt>
<a href="#sec9">Дополнительная информация</a>
</dt>
</dl>
</div>


<p><em>Perforce</em> &mdash; достаточно популярная система контроля версий, используемая во многих проектах
по разработке коммерческого программного обеспечения.  Ссылки на ресурсы об использовании
<em>Perforce</em> вы можете найти в разделе <a href="#addinfo">Дополнительная информация</a>.  Поддержка <em>Perforce</em> в Emacs
осуществляется с помощью пакета <em>p4</em>.</p>

<h2><a name="sec1" id="sec1"></a>
Установка</h2>

<p class="first">Для установки пакета вам нужно скачать исходный текст с <a href="http://p4el.sourceforge.net">сайта проекта</a>.  Поместите пакет в
место, где его найдет Emacs, и поместите следующую команду в файл инициализации Emacs:</p>

<pre class="src">
(<span style="color: #a020f0;">require</span> '<span style="color: #00008b;">p4</span>)
</pre>

<p>Пакет может работать как с GNU Emacs, так и с XEmacs.  Для работы пакета необходимо
наличие <em>Ediff</em>, и еще нескольких пакетов, которые обычно идут в составе Emacs.</p>


<h2><a name="sec2" id="sec2"></a>
Работа с пакетом</h2>

<p class="first">Работу с пакетом можно логически разделить на несколько групп действий &mdash; работа с
репозиторием, получение информации о файлах, работа с файлами и ветками, работа с
изменениями, настройка параметров и прочие команды.  Более подробно, каждая из групп
действий будет рассмотрена в следующих разделах.</p>

<p>Команды выполняются через стандартные средства выполнения команд Emacs, используя привязки
клавиш или используя меню <code>P4</code>, которое появляется после загрузки пакета, и в котором
перечислены практически все команды предоставляемые пакетом.  Для некоторых команд пакета,
пользователь может задать дополнительные аргументы, используя сочетание клавиш <code>C-u</code>.</p>


<h2><a name="sec3" id="sec3"></a>
Работа с репозиторием, файлами, заданиями и ветками</h2>

<p class="first">Синхронизация локальных файлов с репозиторием производится с помощью команды <code>p4-get</code>
(сочетание <code>C-x p G</code>).  Команда позволяет синхронизировать как отдельные файлы, так и все
файлы клиента.  Пользователь может указать номер версии, с которой будет
синхронизироваться клиент.</p>

<p>После получения файлов из репозитория пользователь может открыть его для изменения с
помощью команды <code>p4-edit</code> (сочетание клавиш <code>C-x p e</code>).  При выполнении данной команды, сервер
уведомляется что файл открывается для изменения и файл переводится из состояния только для
чтения, в состояние доступное для изменения.  Пользователь может указать номер изменения,
к которому будут относиться новые изменения, а также тип файла.  Можно открыть файл с
новыми параметрами (тип файла или номер изменения), для этого в пакете <em>p4</em> определена
команда <code>p4-reopen</code> (<code>C-x p E</code>).  Кроме этого, пользователь может открыть файл напрямую в
репозитории, с помощью команды <code>p4-depot-find-file</code>, которая привязана к сочетанию клавиш
<code>C-x p C-f</code>.</p>

<p>Добавление файла в репозиторий производится с помощью команды <code>p4-add</code> (сочетание <code>C-x p a</code>).
С помощью аргументов, пользователь может указать тип файла &mdash; текстовый или двоичный, а
также связать новый файл с указанным отложенным изменением.  Если тип файла не был указан
явно, то он определяется автоматически.  Удаление файла из репозитория производится с
помощью команды <code>p4-delete</code> (сочетание клавиш <code>C-x p x</code>).  Файл удаляется как из репозитория,
так и у клиента.  Если файл уже открыт, то он пере-открывается для удаления и помещается в
указанное неподтвержденное изменение.  Переименование файла производится с помощью команды
<code>p4-rename</code> (<code>C-x p m</code>).  Данная команда поддерживает использование шаблонных символов, так
что можно одновременно переименовывать множество файлов.</p>

<p>Работа с заданиями (jobs) в <em>Perforce</em> реализуется пакетом <em>p4</em> с помощью нескольких команд.
Команда <code>p4-jobs</code> (<code>C-x p J</code>) используется для получения списка всех заданий определенных в
системе.  С помощью аргументов пользователь может сужать список заданий, список
поддерживаемых аргументов вы можете найти в документации на пакет <em>p4</em>.  Создание и
изменение заданий производится с помощью команды <code>p4-job</code> (сочетание клавиш <code>C-x p j</code>).  С
помощью префиксных аргументов, данная команда может удалять задания, а также изменять их.
А команда <code>p4-fix</code> (сочетание <code>C-x p X</code>) используется для связывания задания с номером
изменения.  Связанные с изменениями задания закрываются в том случае, если изменения
подтверждаются.</p>

<p>Спецификации веток могут редактироваться с помощью команды <code>p4-branch</code>, которая привязана к
сочетанию клавиш <code>C-x p B</code>.  Пользователь может выполнить слияние изменений между ветками с
помощью команды <code>p4-integ</code> (<code>C-x p I</code>).  Можно выполнять слияние как между отдельными файлами,
так и между полными ветками.  С помощью аргументов, пользователь может указать в какое
изменение будет производиться слияние.</p>

<p>Пакет также поддерживает работу с метками.  Для получения списка пометок используется
команда <code>p4-labels</code> (<code>C-x p L</code>).  Редактирование спецификации метки производится с помощью
команды <code>p4-label</code> (сочетание клавиш <code>C-x p L</code>), а синхронизация меток с клиентом производится
с помощью команды <code>p4-labelsync</code> (сочетание клавиш <code>C-x p l</code>).</p>


<h2><a name="sec4" id="sec4"></a>
Работа с изменениями</h2>

<p class="first">Работа с изменениями является важной частью использования системы контроля версий.  Для
поддержки этого, пакет <em>p4</em> имеет в своем составе множество команд &mdash; для просмотра
изменений, подтверждения или отмены изменений.</p>

<p>Получить список изменений, внесенных пользователем можно получить с помощью команды
<code>p4-changes</code>, которая привязана к <code>C-x p C</code>.  Эта команда выдает список отложенных и
подтвержденных изменений для указанного файла.  Если не было передано никаких аргументов,
то данная команда выдает список изменений для файлов в текущем каталоге, и каталогах
лежащих ниже.  Список файлов, которые открыты для отложенного изменения, пользователь
может получить с помощью команды <code>p4-opened</code> (сочетание клавиш <code>C-x p o</code>).</p>

<p>Детальный список изменений, внесенных пользователем можно получить с помощью нескольких
команд, однако основной командой является команда <code>p4-diff</code> (сочетание клавиш <code>C-x p
=</code>) &mdash; с ее помощью можно получить список изменений между текущим файлом и версией в
репозитории.  Однако изменения для текущего файла выдаются только в том случае, если этот
файл был открыт для редактирования.  Если текущий файл не открыт для изменения, то
выдается список изменений для всех открытых файлов и их соответствующих версий в
репозитории.  Кроме этого, задавая ключи командной строки для команды <code>diff</code>, можно изменять
выдаваемые данные для получения данных от открытых файлов, файлов отсутствующих клиентов и
т.д.</p>

<p>Кроме указанной выше команды, существует еще несколько команд для получения детального
списка изменений.  Для сравнения двух файлов в репозитории можно использовать команду
<code>p4-diff2</code> (сочетание клавиш <code>C-x p d</code>).  Команда <code>p4-diff-head</code> выдает изменения между файлами
текущего клиента и самыми последними версиями в репозитории.  Для сравнения файлов можно
использовать пакет <em>Ediff</em>, что и делают две команды &mdash; 
<code>p4-ediff</code> и <code>p4-ediff2</code>.  Первая
команда выполняет сравнение текущего файла с его базовой версией, а вторая команда
сравнивает между собой два файла в репозитории.</p>

<p>Подтверждение изменения осуществляется с помощью команды <code>p4-submit</code> (сочетание клавиш <code>C-x
p S</code>).  При выполнении этой команды, отложенное изменение и связанные с ним файлы вносятся
в репозиторий.  В том случае, если перед подтверждением программа не смогла заблокировать
все файлы, затрагиваемые изменением, то процесс прекращается и подтверждения не
происходит.  Пользователь может оповещать других пользователей о вносимых изменениях.  Для
этого может использоваться команда <code>p4-notify</code> (сочетание клавиш <code>C-x p n</code>), которая
выполняется пользователем.  Но кроме этого, может использоваться автоматическое оповещение
пользователей при каждом подтверждении изменений.  Список пользователей, которые будут
оповещены при изменении, задается с помощью команды <code>p4-set-notify-list</code>.  Оповещение
пользователей производится с помощью электронной почты, так что вы должны задать
корректный путь к программе <code>sendmail</code>.</p>

<p>Отмена изменений в текущем файле производится с помощью команды <code>p4-revert</code>, которая
привязана к сочетанию клавиш <code>C-x p r</code>.  Если аргумент <code>SHOW-OUTPUT</code> имеет истинное значение,
то результаты выполнения команды будут отображены в буфере <code>*P4 Output*</code>.  Для обновления
изменений в не-открытых файлах используется команда <code>p4-refresh</code> (<code>C-x p R</code>), так что вам
нужно использовать обе команды, если у вас есть открытые и не-открытые файлы в одном
каталоге и вы хотите обновить их из репозитория.</p>


<h2><a name="sec5" id="sec5"></a>
Получение информации</h2>

<p class="first">Для получения информации о конкретном изменении, может использоваться команда <code>p4-describe</code>
(она привязана к сочетанию клавиш <code>C-x p D</code>).  Она отображает описание изменения, его номер,
имя пользователя, дату и прочую информацию, включающую в себя список файлов, список
конкретных изменений и т.п.</p>

<p>Просмотр истории изменений для текущего файла может быть выполнен с помощью команды
<code>p4-filelog</code> (сочетание клавиш <code>C-x p f</code>).  Информация отображается в порядке убывания
времени, вплоть до самого начала истории файла, когда он был добавлен в репозиторий.</p>

<p>Чтобы получить файл из репозитория вместе с историей изменения, пользователь может
использовать команду <code>p4-print-with-rev-history</code> (сочетание <code>C-x p V</code>).  Для получения только
самого файла, без истории, пользователь может использовать команду <code>p4-print</code> (<code>C-x p p</code>).
Эти две команды не затрагивают список файлов полученных данным клиентом.</p>

<p>Для получения информации о клиенте и сервере может использоваться команда <code>p4-info</code>
(сочетание <code>C-x p i</code>), которая выдает информацию о клиенте &mdash; имя пользователя, название
клиента и каталог, а также некоторую информацию о сервере.</p>

<p>Чтобы узнать как соотносятся между собой имена локальных файлов и имена соответствующих
файлов в репозитории, пользователь может использовать команду <code>p4-where</code>, которая привязана
к <code>C-x p w</code>.  А список версий, которые были в последний раз получены, пользователь может
получить с помощью команды <code>p4-have</code> (<code>C-x p H</code>).  Получить список файлов в репозитории можно
с помощью команды <code>p4-files</code> (сочетание клавиш <code>C-x p F</code>).  Пользователь может получить список
всех файлов, или только файлов, совпадающих с заданной маской.</p>


<h2><a name="sec6" id="sec6"></a>
Управление репозиторием</h2>

<p class="first">Пакет <em>p4</em> позволяет управлять репозиторием <em>Perforce</em> не покидая Emacs.  Сюда относятся
команды управления пользователями, группами пользователей и клиентами.</p>

<p>Создание нового пользователя производится с помощью команды <code>p4-user</code> (сочетание клавиш <code>C-x
p u</code>).  Эта же команда используется для редактирования спецификации уже существующего
пользователя.  Спецификация сохраняется во временный и файл и для ее редактирования
запускается редактор, определенный переменной среды <code>EDITOR</code>.  В спецификацию пользователя
входят его имя, полное имя, уровень доступа и другие параметры.  Обычно, спецификация
пользователя создается автоматически при запуске любой команды, которая может обновить
репозиторий.  Список существующих пользователей можно получить с помощью команды <code>p4-users</code>
(сочетание <code>C-x p U</code>).</p>

<p>Аналогичным образом организована и работа с группами пользователей.  Для получения списков
уже существующих групп, может использоваться команда <code>p4-groups</code>, а для создания группы
пользователей используется команда <code>p4-group</code>.  Но для создания группы пользователей,
текущий пользователь должен обладать специальными правами.</p>

<p>Редактирование спецификации клиента производится с помощью команды <code>p4-client</code>, которая
привязана к сочетанию клавиш <code>C-x p c</code>.  В спецификацию клиента входят его имя, описание,
список файлов, которые будут видны в репозитории, и другие параметры.  По умолчанию, новые
клиенты создаются с возможностью просмотра всех файлов в репозитории.</p>


<h2><a name="sec7" id="sec7"></a>
Прочие команды</h2>

<p class="first">Сочетание клавиш <code>C-x p h</code> запускает команду <code>p4-help</code>, которая может использоваться для
получения справочной информации о работе с пакетом, или о работе с конкретной командой.
Описание привязок клавиш, предоставляемых пакетом <em>p4</em>, можно получить с помощью команды
<code>p4-describe-bindings</code> (сочетание клавиш <code>C-x p ?</code>).</p>

<p>Номер используемой версии пакета <em>p4</em> пользователь может получить с помощью команды
<code>p4-emacs-version</code>, которая привязана к сочетанию клавиш <code>C-x p v</code>.  В том случае, если вы
нашли ошибку в работе пакета, то вы можете сообщить о ней с помощью команды <code>p4-bug-report</code>
(сочетание клавиш <code>C-x p b</code>).</p>

<p>В том случае, если сервер <em>Perforce</em> недоступен или вы работаете отключившись от сети, то вы
можете отключить проверку версий, при открытии файлов.  Включение и отключение этой
проверки пользователь может выполнить с помощью команды <code>p4-toggle-vc-mode</code> (сочетание
клавиш <code>C-x p t</code>).</p>


<h2><a name="sec8" id="sec8"></a>
Настройка</h2>

<p class="first">Для работы с пакетом <em>p4</em>, ну и конечно с <em>Perforce</em>, необходимо установить значения
переменных среды <code>P4CLIENT</code>, <code>P4USER</code> и <code>P4PORT</code>.  Однако вы можете задать нужные значения и с
помощью команд пакета.  Для этого используются команды <code>p4-set-client</code> (сочетание клавиш
<code>C-x p s</code>) и <code>p4-set-p4-port</code> (сочетание <code>C-x p P</code>).  Получить название клиента, который
используется для доступа к репозиторий можно с помощью команды <code>p4-get-client-name</code>
(сочетание <code>C-x p g</code>).</p>

<p>Используя стандартные средства настройки Emacs пользователь может настроить различные
параметры пакета, такие как путь к исполняемым файлам <em>Perforce</em>, переменные, влияющие на
вывод результатов и многое другое.  Группа настройки имеет тоже название что и сам пакет
&mdash; 
<em>p4</em>.</p>

<h2><a name="sec9" id="sec9"></a>
<a name="addinfo" id="addinfo"></a>Дополнительная информация</h2>

<p class="first">Полное описание команд пакета <em>p4</em> вы можете найти на <a href="http://p4el.sf.net">сайте проекта</a>.  А информацию о
<em>Perforce</em> и его использовании вы сможете найти на <a href="http://www.perforce.com">сайте компании</a>.  Кроме этой информации, в
интернете существует достаточное количество описаний, которые могут помочь начинающему
пользователю в освоении этой системы контроля версий.</p>

<div id="rule"><a href="index.html">На главную страницу</a></div>


<!-- Page published by Emacs Muse ends here -->
<div id="lastchange"><p><em>Last change: 05.03.2013 16:54</em></p></div>
<div id="rule"><div id="disqus_thread"></div>
<script type="text/javascript">
var disqus_shortname = 'alexottnet';
var disqus_identifier = '/ru/writings/emacs-vcs/EmacsPerforce.html';
var disqus_url = 'http://alexott.net/ru/writings/emacs-vcs/EmacsPerforce.html';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
</div></div><!-- div-contentwide -->
<div id="footer"><p>Copyright &copy; 1997-2011<a href="../../../copyright.html">Alex Ott</a> &middot; Design by <a href="http://andreasviklund.com/">Andreas Viklund</a>&nbsp;&middot;&nbsp; <a href="http://mwolson.org/projects/EmacsMuse.html"><img alt="muse logo" src="../../../muse-grey-bar.png" /></a></p></div></div> <!-- div-wrap -->
<script type="text/javascript">var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">try {var pageTracker = _gat._getTracker("UA-78697-10");pageTracker._trackPageview();} catch(err) {}</script></body></html>