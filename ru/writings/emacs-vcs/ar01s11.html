<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Интеграция с Perforce</title><link rel="stylesheet" href="web.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.73.2"><meta name="keywords" content="Emacs, GNU Emacs, XEmacs, version control, configuration management, "><link rel="start" href="index.html" title="Использование Emacs совместно с системами контроля версий"><link rel="up" href="index.html" title="Использование Emacs совместно с системами контроля версий"><link rel="prev" href="ar01s10.html" title="Работа с ClearCase"><link rel="next" href="ar01s12.html" title="Интеграция с Microsoft Visual SourceSafe"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Интеграция с <span class="application">Perforce</span></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ar01s10.html">Пред.</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ar01s12.html">След.</a></td></tr></table><hr></div><div class="section" lang="ru"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="emacs.vcs.perforce"></a>Интеграция с <span class="application">Perforce</span></h2></div></div></div><p><span class="application">Perforce</span> —  достаточно популярная система контроля версий,
  используемая во многих проектах по разработке коммерческого программного
  обеспечения.  Ссылки на ресурсы об использовании <span class="application">Perforce</span> вы можете
  найти в разделе <a class="xref" href="ar01s11.html#emacs.vcs.perforce.addinfo" title="Дополнительная информация">Дополнительная информация</a>.  Поддержка <span class="application">Perforce</span> в <span class="application">Emacs</span>
  осуществляется с помощью пакета <span class="application">p4</span>.</p><div class="section" lang="ru"><div class="titlepage"><div><div><h3 class="title"><a name="id2587707"></a>Установка</h3></div></div></div><p>Для установки пакета вам нужно скачать исходный текст с <a class="ulink" href="http://p4el.sourceforge.net" target="_top">сайта проекта</a>.  Поместите
    пакет в место, где его найдет <span class="application">Emacs</span>, и поместите следующую команду в
    файл инициализации <span class="application">Emacs</span>:

    </p><pre class="screen">(require 'p4)
</pre><p>

    Пакет может работать как с <span class="application">GNU Emacs</span>, так и с <span class="application">XEmacs</span>.  Для
    работы пакета необходимо наличие <span class="application">Ediff</span>, и еще нескольких пакетов,
    которые обычно идут в составе <span class="application">Emacs</span>.</p></div><div class="section" lang="ru"><div class="titlepage"><div><div><h3 class="title"><a name="id2587775"></a>Работа с пакетом</h3></div></div></div><p>Работу с пакетом можно логически разделить на несколько групп действий — работа с репозиторием, получение информации о файлах, работа с файлами и ветками, работа с изменениями, настройка параметров и прочие команды. Более подробно, каждая из групп действий будет рассмотрена в следующих разделах.</p><p>Команды выполняются через стандартные средства выполнения команд
    <span class="application">Emacs</span>, используя привязки клавиш или используя меню
    <code class="literal">P4</code>, которое появляется после загрузки пакета, и в
    котором перечислены практически все команды предоставляемые пакетом.
    Для некоторых команд пакета, пользователь может задать дополнительные
    аргументы, используя сочетание клавиш <span class="keysym">C</span>+<span class="keysym">u</span>.</p><div class="section" lang="ru"><div class="titlepage"><div><div><h4 class="title"><a name="id2587842"></a>Работа с репозиторием, файлами, заданиями и ветками</h4></div></div></div><p>Синхронизация локальных файлов с репозиторием производится с
      помощью команды <code class="function">p4-get</code> (сочетание
      <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">G</span>).
      Команда позволяет синхронизировать как отдельные файлы, так и все
      файлы клиента.  Пользователь может указать номер версии, с которой
      будет синхронизироваться клиент.</p><p>После получения файлов из репозитория пользователь может открыть
      его для изменения с помощью команды <code class="function">p4-edit</code>
      (сочетание клавиш <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">e</span>).
      При выполнении данной команды, сервер уведомляется что файл открывается
      для изменения и файл переводится из состояния только для чтения, в
      состояние доступное для изменения.  Пользователь может указать номер
      изменения, к которому будут относиться новые изменения, а также тип
      файла.  Можно открыть файл с новыми параметрами (тип файла или номер
      изменения), для этого в пакете <span class="application">p4</span> определена команда
      <code class="function">p4-reopen</code> (<span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">E</span>).
      Кроме этого, пользователь может открыть файл напрямую в репозитории, с
      помощью команды <code class="function">p4-depot-find-file</code>, которая
      привязана к сочетанию клавиш <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">C</span>+<span class="keysym">f</span>. </p><p>Добавление файла в репозиторий производится с помощью команды
      <code class="function">p4-add</code> (сочетание <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">a</span>). С помощью аргументов, пользователь может указать тип файла — 
      текстовый или двоичный, а также связать новый файл с указанным
      отложенным изменением.  Если тип файла не был указан явно, то он
      определяется автоматически.  Удаление файла из репозитория
      производится с помощью команды <code class="function">p4-delete</code>
      (сочетание клавиш <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">x</span>).
      Файл удаляется как из репозитория, так и у клиента.  Если файл уже
      открыт, то он пере-открывается для удаления и помещается в указанное
      неподтвержденное изменение.  Переименование файла производится с
      помощью команды <code class="function">p4-rename</code>
      (<span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">m</span>).
      Данная команда поддерживает использование шаблонных символов, так что
      можно одновременно переименовывать множество файлов.</p><p>Работа с заданиями (jobs) в <span class="application">Perforce</span> реализуется пакетом <span class="application">p4</span>
      с помощью нескольких команд.  Команда <code class="function">p4-jobs</code>
      (<span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">J</span>)
      используется для получения списка всех заданий определенных в системе.
      С помощью аргументов пользователь может сужать список заданий, список
      поддерживаемых аргументов вы можете найти в документации на пакет
      <span class="application">p4</span>.  Создание и изменение заданий производится с помощью команды
      <code class="function">p4-job</code> (сочетание клавиш
      <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">j</span>).
      С помощью префиксных аргументов, данная команда может удалять задания,
      а также изменять их.  А команда <code class="function">p4-fix</code> (сочетание
      <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">X</span>)
      используется для связывания задания с номером изменения.  Связанные с
      изменениями задания закрываются в том случае, если изменения
      подтверждаются. </p><p>Спецификации веток могут редактироваться с помощью команды
      <code class="function">p4-branch</code>, которая привязана к сочетанию клавиш
      <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">B</span>.
      Пользователь может выполнить слияние изменений между ветками с помощью
      команды <code class="function">p4-integ</code> (<span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">I</span>).
      Можно выполнять слияние как между отдельными файлами, так и между
      полными ветками.  С помощью аргументов, пользователь может указать в
      какое изменение будет производиться слияние.</p><p>Пакет также поддерживает работу с метками.  Для получения списка
      пометок используется команда <code class="function">p4-labels</code>
      (<span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">L</span>).
      Редактирование спецификации метки производится с помощью команды
      <code class="function">p4-label</code> (сочетание клавиш
      <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">L</span>),
      а синхронизация меток с клиентом производится с помощью команды
      <code class="function">p4-labelsync</code> (сочетание клавиш <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">l</span>).</p></div><div class="section" lang="ru"><div class="titlepage"><div><div><h4 class="title"><a name="id2588385"></a>Работа с изменениями</h4></div></div></div><p>Работа с изменениями является важной частью использования
      системы контроля версий.  Для поддержки этого, пакет <span class="application">p4</span> имеет в своем составе множество команд —  для просмотра изменений,
      подтверждения или отмены изменений.</p><p>Получить список изменений, внесенных пользователем можно
      получить с помощью команды <code class="function">p4-changes</code>, которая
      привязана к <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">C</span>.
      Эта команда выдает список отложенных и подтвержденных изменений для
      указанного файла.  Если не было передано никаких аргументов, то данная
      команда выдает список изменений для файлов в текущем каталоге, и
      каталогах лежащих ниже.  Список файлов, которые открыты для
      отложенного изменения, пользователь может получить с помощью команды
      <code class="function">p4-opened</code> (сочетание клавиш
      <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">o</span>).</p><p>Детальный список изменений, внесенных пользователем можно
      получить с помощью нескольких команд, однако основной командой
      является команда <code class="function">p4-diff</code> (сочетание клавиш
      <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">=</span>) —  с
      ее помощью можно получить список изменений между текущим файлом и
      версией в репозитории.  Однако изменения для текущего файла выдаются
      только в том случае, если этот файл был открыт для редактирования.
      Если текущий файл не открыт для изменения, то выдается список
      изменений для всех открытых файлов и их соответствующих версий в
      репозитории.  Кроме этого, задавая ключи командной строки для команды
      diff, можно изменять выдаваемые данные для получения данных от
      открытых файлов, файлов отсутствующих клиентов и т.д.</p><p>Кроме указанной выше команды, существует еще несколько команд
      для получения детального списка изменений.  Для сравнения двух файлов
      в репозитории можно использовать команду <code class="function">p4-diff2</code>
      (сочетание клавиш <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">d</span>).
      Команда <code class="function">p4-diff-head</code> выдает изменения между
      файлами текущего клиента и самыми последними версиями в репозитории.
      Для сравнения файлов можно использовать пакет
      <span class="application">Ediff</span>, что и делают две команды — 
      <code class="function">p4-ediff</code> и <code class="function">p4-ediff2</code>.
      Первая команда выполняет сравнение текущего файла с его базовой
      версией, а вторая команда сравнивает между собой два файла в
      репозитории.</p><p>Подтверждение изменения осуществляется с помощью команды
      <code class="function">p4-submit</code> (сочетание клавиш
      <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">S</span>).
      При выполнении этой команды, отложенное изменение и связанные с ним
      файлы вносятся в репозиторий.  В том случае, если перед подтверждением
      программа не смогла заблокировать все файлы, затрагиваемые изменением,
      то процесс прекращается и подтверждения не происходит.  Пользователь
      может оповещать других пользователей о вносимых изменениях.  Для этого
      может использоваться команда <code class="function">p4-notify</code> (сочетание
      клавиш <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">n</span>),
      которая выполняется пользователем.  Но кроме этого, может
      использоваться автоматическое оповещение пользователей при каждом
      подтверждении изменений.  Список пользователей, которые будут
      оповещены при изменении, задается с помощью команды
      <code class="function">p4-set-notify-list</code>.  Оповещение пользователей
      производится с помощью электронной почты, так что вы должны задать
      корректный путь к программе sendmail.</p><p>Отмена изменений в текущем файле производится с помощью команды
      <code class="function">p4-revert</code>, которая привязана к сочетанию клавиш
      <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">r</span>.
      Если аргумент <code class="varname">SHOW-OUTPUT</code> имеет истинное значение,
      то результаты выполнения команды будут отображены в буфере
      <code class="literal">*P4 Output*</code>.  Для обновления изменений в не-открытых
      файлах используется команда <code class="function">p4-refresh</code>
      (<span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">R</span>),
      так что вам нужно использовать обе команды, если у вас есть открытые и
      не-открытые файлы в одном каталоге и вы хотите обновить их из
      репозитория.</p></div><div class="section" lang="ru"><div class="titlepage"><div><div><h4 class="title"><a name="id2588808"></a>Получение информации</h4></div></div></div><p>Для получения информации о конкретном изменении, может
      использоваться команда <code class="function">p4-describe</code> (она привязана
      к сочетанию клавиш <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">D</span>).
      Она отображает описание изменения, его номер, имя пользователя, дату и
      прочую информацию, включающую в себя список файлов, список конкретных
      изменений и т.п.</p><p>Просмотр истории изменений для текущего файла может быть
      выполнен с помощью команды <code class="function">p4-filelog</code> (сочетание
      клавиш <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">f</span>).
      Информация отображается в порядке убывания времени, вплоть до самого
      начала истории файла, когда он был добавлен в репозиторий.  </p><p>Чтобы получить файл из репозитория вместе с историей изменения,
      пользователь может использовать команду
      <code class="function">p4-print-with-rev-history</code> (сочетание
      <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">V</span>).
      Для получения только самого файла, без истории, пользователь может
      использовать команду ` p4-print' (<span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">p</span>).
      Эти две команды не затрагивают список файлов полученных данным
      клиентом.</p><p>Для получения информации о клиенте и сервере может
      использоваться команда <code class="function">p4-info</code> (сочетание
      <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">i</span>), которая выдает информацию о клиенте —  имя пользователя, название
      клиента и каталог, а также некоторую информацию о сервере.</p><p>Чтобы узнать как соотносятся между собой имена локальных файлов
      и имена соответствующих файлов в репозитории, пользователь может
      использовать команду <code class="function">p4-where</code>, которая привязана
      к <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">w</span>.
      А список версий, которые были в последний раз получены, пользователь
      может получить с помощью команды <code class="function">p4-have</code>
      (<span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">H</span>).
      Получить список файлов в репозитории можно с помощью команды
      <code class="function">p4-files</code> (сочетание клавиш
      <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">F</span>).
      Пользователь может получить список всех файлов, или только файлов,
      совпадающих с заданной маской.</p></div><div class="section" lang="ru"><div class="titlepage"><div><div><h4 class="title"><a name="id2589078"></a>Управление репозиторием</h4></div></div></div><p>Пакет <span class="application">p4</span> позволяет управлять репозиторием <span class="application">Perforce</span> не
      покидая <span class="application">Emacs</span>.  Сюда относятся команды управления пользователями,
      группами пользователей и клиентами.</p><p>Создание нового пользователя производится с помощью команды
      <code class="function">p4-user</code> (сочетание клавиш
      <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">u</span>).
      Эта же команда используется для редактирования спецификации уже
      существующего пользователя.  Спецификация сохраняется во временный и
      файл и для ее редактирования запускается редактор, определенный
      переменной среды <code class="varname">EDITOR</code>.  В спецификацию
      пользователя входят его имя, полное имя, уровень доступа и другие
      параметры.  Обычно, спецификация пользователя создается автоматически
      при запуске любой команды, которая может обновить репозиторий.  Список
      существующих пользователей можно получить с помощью команды
      <code class="function">p4-users</code> (сочетание <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">U</span>). </p><p>Аналогичным образом организована и работа с группами
      пользователей.  Для получения списков уже существующих групп, может
      использоваться команда <code class="function">p4-groups</code>, а для создания
      группы пользователей используется команда
      <code class="function">p4-group</code>.  Но для создания группы пользователей,
      текущий пользователь должен обладать специальными правами. </p><p>Редактирование спецификации клиента производится с помощью
      команды <code class="function">p4-client</code>, которая привязана к сочетанию
      клавиш <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">c</span>.
      В спецификацию клиента входят его имя, описание, список файлов,
      которые будут видны в репозитории, и другие параметры.  По умолчанию,
      новые клиенты создаются с возможностью просмотра всех файлов в
      репозитории.</p></div><div class="section" lang="ru"><div class="titlepage"><div><div><h4 class="title"><a name="id2589257"></a>Прочие команды</h4></div></div></div><p>Сочетание клавиш <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">h</span>
      запускает команду <code class="function">p4-help</code>, которая может
      использоваться для получения справочной информации о работе с пакетом,
      или о работе с конкретной командой.  Описание привязок клавиш,
      предоставляемых пакетом <span class="application">p4</span>, можно получить с помощью команды
      <code class="function">p4-describe-bindings</code> (сочетание клавиш
      <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">?</span>). </p><p>Номер используемой версии пакета <span class="application">p4</span> пользователь может
      получить с помощью команды <code class="function">p4-emacs-version</code>,
      которая привязана к сочетанию клавиш <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">v</span>.
      В том случае, если вы нашли ошибку в работе пакета, то вы можете
      сообщить о ней с помощью команды <code class="function">p4-bug-report</code>
      (сочетание клавиш <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">b</span>).</p><p>В том случае, если сервер <span class="application">Perforce</span> недоступен или вы работаете
      отключившись от сети, то вы можете отключить проверку версий, при
      открытии файлов.  Включение и отключение этой проверки пользователь
      может выполнить с помощью команды
      <code class="function">p4-toggle-vc-mode</code> (сочетание клавиш
      <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">t</span>).</p></div></div><div class="section" lang="ru"><div class="titlepage"><div><div><h3 class="title"><a name="id2589441"></a>Настройка</h3></div></div></div><p>Для работы с пакетом <span class="application">p4</span>, ну и конечно с <span class="application">Perforce</span>, необходимо
    установить значения переменных среды <code class="varname">P4CLIENT</code>,
    <code class="varname">P4USER</code> и <code class="varname">P4PORT</code>.  Однако вы можете
    задать нужные значения и с помощью команд пакета.  Для этого
    используются команды <code class="function">p4-set-client</code> (сочетание
    клавиш <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">s</span>)
    и <code class="function">p4-set-p4-port</code> (сочетание
    <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">P</span>).
    Получить название клиента, который используется для доступа к
    репозиторий можно с помощью команды
    <code class="function">p4-get-client-name</code> (сочетание
    <span class="keysym">C</span>+<span class="keysym">x</span> <span class="keysym">p</span> <span class="keysym">g</span>).</p><p>Используя стандартные средства настройки <span class="application">Emacs</span> пользователь
    может настроить различные параметры пакета, такие как путь к исполняемым
    файлам <span class="application">Perforce</span>, переменные, влияющие на вывод результатов и многое другое. Группа настройки имеет тоже название что и сам пакет —  <span class="application">p4</span>.</p></div><div class="section" lang="ru"><div class="titlepage"><div><div><h3 class="title"><a name="emacs.vcs.perforce.addinfo"></a>Дополнительная информация</h3></div></div></div><p>Полное описание команд пакета <span class="application">p4</span> вы можете найти на <a class="ulink" href="http://p4el.sf.net" target="_top">сайте проекта</a>.  А информацию о
    <span class="application">Perforce</span> и его использовании вы сможете найти на <a class="ulink" href="http://www.perforce.com" target="_top">сайте компании</a>.  Кроме этой
    информации, в интернете существует достаточное количество описаний,
    которые могут помочь начинающему пользователю в освоении этой системы
    контроля версий.</p></div></div><script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">
      _uacct = "UA-78697-3";
      urchinTracker();
    </script><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ar01s10.html">Пред.</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ar01s12.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">Работа с <span class="application">ClearCase</span> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> Интеграция с Microsoft <span class="application">Visual SourceSafe</span></td></tr></table></div></body></html>
