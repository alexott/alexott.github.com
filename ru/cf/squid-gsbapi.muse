#title Поддержка Google Safe Browsing API в Squid
#keywords squid, google safe browsing, redirector, gsb

Данная система реализует поддержку Google Safe Browsing API в Squid.  Она реализована
как редиректор для Squid, и устанавливается в соответствии с документацией squid.

* Как получить программу

Последние версии этой программы вы можете найти в репозитории на [[http://github.com/alexott/squid-gsb/tree/master][GitHub]].  Стабильные
версии доступны с [[../../common/cf][моего сайта]] в виде архивов.

* Как собрать

Для сборки вам необходимо иметь [[http://www.boost.org][Boost]] версии 1.35 или выше, а также [[http://cmake.org][CMake]], который
используется для сборки.  Для конфигурации необходимо выполнить следующую команду стоя в
верхнем каталоге проекта:

<src lang="sh">
cmake . -DCMAKE_INSTALL_PREFIX=install_path
</src>

В том случае, если Boost установлен в нестандартном месте, то вам необходимо указать
расположение заголовочных файлов и библиотек с помощью директив CMake
<code>-DBOOST_INCLUDEDIR=path_to_includes</code> и
<code>-DBOOST_LIBRARYDIR=path_to_libraries</code>.  При конфигурации, =cmake= автоматически
найдет нужные библиотеки.

После конфигурации, вы можете собрать программу с помощью стандартной последовательности
=make= && =make install=.

Данная программа была успешно проверена на Linux с ядром 2.6 (Ubuntu) и Mac OS X Tiger
(10.4) на iMac.  Теоретически, она также должна собираться и работать под управлением MS
Windows, но я это еще не проверял.

* Как запустить

Эта система состоит из двух утилит: программы обновления (=gsb-updater=) и программы
проверки данных (=gsb-redirector=).  Обе утилиты используют одни и те же опции командной
строки и один и тот же конфигурационный файл.  Наиболее важная опция -- =-c=, указывает
местоположение файла конфигурации.  По умолчанию используется файл
=PREFIX/etc/squid-gsb.conf=.

Программа обновления должна запускаться периодически (раз в полчаса, через cron,
например) и будет выполнять подключение к серверу Google и обновлять данные, используемые
программой проверки.

Редиректор работает в бесконечном цикле и считывает адрес со стандартного ввода,
проверяет его, и выводит заданный адрес, если данный сайт найден в одной из таблиц с
данными, или пустую строку, если данный сайт не был найден.  Утилита автоматически
определяет обновление таблиц с данными, и перечитывает их.

* Файлы конфигурации

Пользователь может указать в файле конфигурации следующие опции (данный файл
устанавливается в =PREFIX/etc/squid-gsb.conf=):

 =black-hash-file= :: файл с таблицей "черных" сайтов. Значение по умолчанию --
   =PREFIX/var/squid-gsb/black-hash.dat=

 =black-url= (required) :: URL, который будет подставлен для сайтов в "черном" списке

 =malware-hash-file= :: файл с таблицей "вредоносных" (malware) сайтов. Значение по
   умолчанию -- =PREFIX/var/squid-gsb/malware-hash.dat=

 =malware-url= (required) :: URL, который будет подставлен для сайтов в "вредоносном"
   (malware) списке

 =key= (required) :: ключ для подключения к серверу Google Safe Browsing API и скачиывания
   обновлений с него.  Вы можете получить его со страницы проекта [[http://code.google.com/apis/safebrowsing/][Google Safe Browsing API]]

 =debug= :: определяет, должна ли выводиться отладочная информация во время работы
   утилит. Значение по умолчанию - =no=.



;  LocalWords:  redirector GSB gsb
