<HTML>
<HEAD>
<!-- Created by texi2html 1.56k from emacs.texi on 29 October 2002 -->

<TITLE>Руководство по GNU Emacs - Emacs и MS-DOS</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="emacs_1.html">first</A>, <A HREF="emacs_39.html">previous</A>, <A HREF="emacs_41.html">next</A>, <A HREF="emacs_46.html">last</A> section, <A HREF="emacs_toc.html">table of contents</A>.
<P><HR><P>


<H1><A NAME="SEC513" HREF="emacs_toc.html#TOC513">Emacs и MS-DOS</A></H1>
<P>
<A NAME="IDX2749"></A>
<A NAME="IDX2750"></A>


<P>
  Этот раздел кратко описывает особенности использования Emacs под
"операционной системой" MS-DOS (известной также как "MS-DOG").  Если
вы соберете Emacs для MS-DOS, этот двоичный файл можно будет также
запустить на Windows 3.X, Windows NT, Windows 9X или OS/2 как приложение
DOS; сведения из данной главы относятся ко всем этим системам, если вы
используете Emacs, который был скомпилирован для MS-DOS.


<P>
  Заметьте, что возможно собрать Emacs специально для Windows NT или
Windows 9X.  Если вы сделаете так, большая часть главы будет неприменима
к вашему случаю; тогда вы получите поведение, которое более близко к
тому, что описано в остальной части руководства, и которое включает
поддержку для длинных имен файлов, множественных фреймов, полосок
прокрутки, меню для мыши и подпроцессов.  Однако, раздел о текстовых и
двоичных файлах все еще будет иметь силу.  Также в конце этой главы есть
два раздела, которые относятся исключительно к Windows NT и 9X.




<H2><A NAME="SEC514" HREF="emacs_toc.html#TOC514">Клавиатура и мышь в MS-DOS</A></H2>

<P>
<A NAME="IDX2751"></A>
<A NAME="IDX2752"></A>
<A NAME="IDX2753"></A>
<A NAME="IDX2754"></A>
<A NAME="IDX2755"></A>
  Раскладки клавиатуры PC используют в качестве клавиши <KBD>META</KBD> левую
клавишу <KBD>ALT</KBD>.  Вы можете выбрать между двумя способами эмулирования
клавиш <KBD>SUPER</KBD> и <KBD>HYPER</KBD>: использовать либо правый <KBD>CTRL</KBD>,
либо правый <KBD>ALT</KBD>, установив переменные <CODE>dos-hyper-key</CODE> и
<CODE>dos-super-key</CODE>, соответственно, в значение 1 или 2.  Если ни
<CODE>dos-super-key</CODE>, ни <CODE>dos-hyper-key</CODE> не равна 1, то по
умолчанию правый <KBD>ALT</KBD> также отображается в клавишу <KBD>META</KBD>.
Однако, если установлена @command{KEYB.COM}, программа для поддержки в
MS-DOS многоязыковой клавиатуры, Emacs <EM>не будет</EM> отображать правый
<KBD>ALT</KBD> в <KBD>META</KBD>, так как он используется для получения таких
знаков, как <KBD>~</KBD> и <KBD>@</KBD> в раскладках, отличных от раскладки US; в
таком случае вы можете использовать в качестве клавиши <KBD>META</KBD> только
левый <KBD>ALT</KBD>.


<P>
<A NAME="IDX2756"></A>
<A NAME="IDX2757"></A>
  Переменная <CODE>dos-keypad-mode</CODE> -- это флаг, который управляет
кодами, возвращаемыми клавишами дополнительной цифровой клавиатуры.  Вы
также можете определить клавишу <KBD>ENTER</KBD> с дополнительной клавиатуры
как <KBD>C-j</KBD>, поместив в ваш файл <TT>`_emacs'</TT> следующую строку:



<PRE>
;; Делает так, чтобы Enter с дополнительной
;; клавиатуры действовал как C-j.
(define-key function-key-map [kp-enter] [?\C-j])
</PRE>

<P>
<A NAME="IDX2758"></A>
<A NAME="IDX2759"></A>
  Клавиша, известная в Emacs как <KBD>DEL</KBD> (потому что таково ее
назначение на большинстве рабочих станций), на PC известна как <KBD>BS</KBD>
(забой).  Поэтому специфичная для PC инициализация терминала изменяет
отображение клавиши <KBD>BS</KBD> таким образом, чтобы она действовала как
<KBD>DEL</KBD>; клавиша <KBD>DEL</KBD> отображается в <KBD>C-d</KBD> по тем же
причинам.


<P>
<A NAME="IDX2760"></A>
<A NAME="IDX2761"></A>
<A NAME="IDX2762"></A>
  Emacs, собранный для MS-DOS, распознает в качестве ключа выхода
комбинацию <KBD>C-<KBD>BREAK</KBD></KBD>, точно так же, как <KBD>C-g</KBD>.  Это
делается, потому что Emacs не может зарегистрировать нажатие <KBD>C-g</KBD>,
если только он не готов к принятию ввода.  Как следствие, вы не можете
использовать <KBD>C-g</KBD> для остановки запущенной команды (see section <A HREF="emacs_37.html#SEC476">Выход и аварийное завершение</A>).
Напротив, <KBD>C-<KBD>BREAK</KBD></KBD> <EM>можно</EM> уловить, как только вы ее
набрали (как <KBD>C-g</KBD> на других системах), поэтому ее можно применять
для остановки работающей команды и для аварийного выхода
(see section <A HREF="emacs_37.html#SEC485">Аварийный выход</A>).


<P>
<A NAME="IDX2763"></A>
  Emacs поддерживает в MS-DOS мышь (только на терминале по умолчанию).
Команды мыши работают как описано, включая те, что используют меню и
полоску меню (see section <A HREF="emacs_6.html#SEC16">Полоска меню</A>).  Полоски прокрутки не работают в
MS-DOS Emacs.  Мыши на PC обычно имеют только две кнопки; они действуют
как <KBD>Mouse-1</KBD> и <KBD>Mouse-2</KBD>, но если вы нажмете их вместе, то они
подействуют как <KBD>Mouse-3</KBD>.


<P>
<A NAME="IDX2764"></A>
<A NAME="IDX2765"></A>
  Собранный для MS-DOS и запущенный под Windows Emacs поддерживает
операции с буфером обмена.  Команды, которые помещают текст в список
уничтожений или восстанавливают текст из него, сначала проверяют буфер
обмена, так же, как в X Windows (see section <A HREF="emacs_22.html#SEC177">Команды мыши для редактирования</A>).  В MS-DOS Emacs
под Windows поддерживаются только первичное выделение и буфер вырезок;
вторичное выделение всегда выглядит как пустое.


<P>
  Доступ к буферу обмена реализован в Windows так, что длина текста,
который вы можете в него поместить, ограничена количеством доступной
Emacs свободной памяти DOS.  Обычно в буфере может уместиться до 620KB
текста, но этот предел зависит от конфигурации системы и будет меньше,
если вы запустите Emacs как подпроцесс другой программы.  Если
уничтоженный текст не умещается, Emacs печатает сообщение об этом и не
помещает этот текст в буфер обмена.


<P>
  Также, в буфер обмена Windows нельзя поместить знаки с нулевым кодом.
Если уничтожаемый текст содержит нули, Emacs не будет записывать его в
буфер обмена и напечатает об этом предупреждение в эхо-области.


<P>
<A NAME="IDX2766"></A>
  Переменная <CODE>dos-display-scancodes</CODE>, если она не равна <CODE>nil</CODE>,
велит Emacs показывать ASCII-значение скан-кодов клавиатуры при каждом
нажатии клавиши; эта возможность служит дополнением к команде
<CODE>view-lossage</CODE>, она полезна для отладки.




<H2><A NAME="SEC515" HREF="emacs_toc.html#TOC515">Изображение в MS-DOS</A></H2>
<P>
<A NAME="IDX2767"></A>
<A NAME="IDX2768"></A>


<P>
  В MS-DOS нельзя использовать вариации шрифтов, такие как курсив или
жирный шрифт, но множественные начертания поддерживаются; каждое из них
может определять цвета шрифта и фона.  Следовательно, вы можете
пользоваться всей функциональностью пакетов Emacs, которые используют
шрифты (таких как <CODE>font-lock</CODE>, режим Enriched Text и других),
определяя подходящие начертания как использующие различные цвета.  Чтобы
посмотреть, какие цвета и начертания доступны, и как они выглядят,
запустите команду <CODE>list-colors-display</CODE> (see section <A HREF="emacs_22.html#SEC186">Установка параметров фрейма</A>)
и команду <CODE>list-faces-display</CODE> (see section <A HREF="emacs_22.html#SEC189">Использование разных начертаний</A>).


<P>
  See section <A HREF="emacs_40.html#SEC519">Поддержка разных языков в MS-DOS</A>, где описано, как Emacs отображает глифы и знаки,
которые не поддерживаются встроенными шрифтами.


<P>
<A NAME="IDX2769"></A>
  Множественные фреймы (see section <A HREF="emacs_22.html#SEC176">Фреймы и X Windows</A>) поддерживаются в MS-DOS, но они
перекрываются, так что в одно время вы можете видеть только один из них.
Этот единственный фрейм занимает весь экран.  Когда вы запускаете Emacs
в сеансе DOS из-под MS-Windows, вы можете сделать так, чтобы видимый
фрейм занимал не весь экран, но Emacs все равно не может показать более
одного фрейма одновременно.


<P>
<A NAME="IDX2770"></A>
<A NAME="IDX2771"></A>
<A NAME="IDX2772"></A>
  Команда <CODE>mode4350</CODE> переключает между отображением 43 или 50
строк, в зависимости от вашей аппаратуры; команда <CODE>mode25</CODE>
переключает к размеру экрана по умолчанию, 80x25.


<P>
  По умолчанию Emacs знает только как установить размер окна для 80-ти
столбцов на 25, 28, 35, 40, 43 или 50 строк.  Однако, если у вашего
видеоадаптера есть особые видеорежимы, которые переключаю изображение в
другие размеры, вы можете сделать так, чтобы Emacs поддерживал и их
тоже.  Когда вы просите Emacs изменить размер фрейма на <VAR>n</VAR> столбцов
и <VAR>m</VAR> строк, он проверяет, есть ли переменная с именем
<CODE>screen-dimensions-<VAR>n</VAR>x<VAR>m</VAR></CODE>, и если она есть, использует
ее значение (которое должно быть целым числом) как видеорежим, в который
нужно переключиться.  (Emacs переключается в этот видеорежим, вызывая
функцию BIOS <CODE>Set Video Mode</CODE> со значением
<CODE>screen-dimensions-<VAR>n</VAR>x<VAR>m</VAR></CODE> в регистре <CODE>AL</CODE>.)
Например, представим, что ваш адаптер переходит к размерам 66x80, когда
его перевели в видеорежим 85.  Тогда вы можете сделать так, чтобы Emacs
поддерживал этот размер экрана, поместив в ваш файл <TT>`_emacs'</TT>
следующее:



<PRE>
(setq screen-dimensions-66x80 85)
</PRE>

<P>
  Поскольку Emacs способен в MS-DOS установить размер фрейма только к
конкретным поддерживаемым размерам, он не может следовать любому
возможному запросу на его изменение.  Когда запрошен неподдерживаемый
размер, Emacs выбирает следующий, больший, чем указанный.  Например,
если вы потребуете фрейм 36x80, вместо этого вы получите 40x80.


<P>
  Переменные <CODE>screen-dimensions-<VAR>n</VAR>x<VAR>m</VAR></CODE> используются,
только если они точно совпадают с указанным размером; при поиске
следующего большего размера они игнорируются.  В примере выше, даже если
ваш VGA-адаптер поддерживает размер 38x80, и вы определили переменную
<CODE>screen-dimensions-38x80</CODE> с соответствующим значением, вы тем не
менее получите экран 40x80, когда потребуете сделать размер фрейма
равным 36x80.  Если вы хотите получить в этом случае размеры 38x80, вы
можете сделать это, установив переменную с именем
<CODE>screen-dimensions-36x80</CODE> и тем же значением видеорежима, что и
<CODE>screen-dimensions-38x80</CODE>.


<P>
  Изменение размеров фрейма в MS-DOS приводит также к новым размерам и
все остальные фреймы.




<H2><A NAME="SEC516" HREF="emacs_toc.html#TOC516">Имена файлов в MS-DOS</A></H2>
<P>
<A NAME="IDX2773"></A>
<A NAME="IDX2774"></A>


<P>
  MS-DOS обычно использует для разделения единиц имени файла обратную
косую черту, <SAMP>`\'</SAMP>, а не обычную косую черту, как другие системы.
Emacs под MS-DOS позволяет использовать и простую, и обратную косую
черту, а также знает о буквах дисков в именах файлов.


<P>
  Имена файлов в MS-DOS регистронезависимы и ограничены восемью знаками
плюс необязательная точка и еще три знака.  Emacs достаточно осведомлен
об этих ограничениях, чтобы справляться с именами файлов,
предназначенных для других операционных систем.  К примеру, начальные
точки <SAMP>`.'</SAMP>  в имени файла недопустимы в MS-DOS, поэтому Emacs
автоматически переводит их в подчерки <SAMP>`_'</SAMP>; так что ваш файл
инициализации по умолчанию (see section <A HREF="emacs_36.html#SEC470">Файл инициализации, <TT>`~/.emacs'</TT></A>) называется в
MS-DOS <TT>`_emacs'</TT>.  Излишние знаки перед или после точки обычно
игнорируются самой MS-DOS; поэтому, если вы обращаетесь к файлу
<TT>`LongFileName.EvenLongerExtension'</TT>, вы без предупреждений получите
<TT>`longfile.eve'</TT>, но в строке режима Emacs все так же будет
показывать это длинное имя файла.  Во всех остальных отношениях вы сами
должны заботиться об указании допустимых под MS-DOS имен файлов;
описанное выше прозрачное преобразование действует только на имена
файлов внутри Emacs.
 
<A NAME="IDX2775"></A>
  Упомянутые выше ограничения на имена файлов в MS-DOS делают
конструирование имен резервных файлов почти невозможным (see section <A HREF="emacs_19.html#SEC113">Одиночные или нумерованные резервные файлы</A>) без потери некоторых знаков из
первоначального имени файла.  Например, именем резервного файла для
<TT>`docs.txt'</TT> будет <TT>`docs.tx~'</TT>, даже если использован
единственный резервный файл.


<P>
<A NAME="IDX2776"></A>
<A NAME="IDX2777"></A>
  Если вы запускаете Emacs как приложение DOS под Windows 9X, вы можете
включить поддержку длинных имен файлов.  Если вы сделаете так, Emacs не
станет усекать имена файлов или приводить их к нижнему регистру;
напротив, он будет использовать имена файлов так, как вы их задали, без
изменений.  Чтобы задействовать поддержку длинных имен файлов,
установите переменную среды @env{LFN} равной <SAMP>`y'</SAMP> перед запуском
Emacs.  К сожалению, Windows NT не позволяет программам DOS получать
доступ к длинным именам файлов, так что собранный для MS-DOS Emacs будет
видеть только их короткие псевдонимы в форме 8+3.


<P>
<A NAME="IDX2778"></A>
  В MS-DOS нет понятия о начальном каталоге, поэтому в MS-DOS Emacs
делает вид, что каталог, в котором он установлен -- это значение
переменной среды @env{HOME}.  То есть, если исполняемый файл Emacs,
<TT>`emacs.exe'</TT>, находится в каталоге <TT>`c:/utils/emacs/bin'</TT>, то
Emacs ведет себя так, как если бы @env{HOME} была установлена равной
<SAMP>`c:/utils/emacs'</SAMP>.  В частности, именно здесь Emacs ищет файл
инициализации, <TT>`_emacs'</TT>.  Помня это, вы можете использовать в
именах файлов знак <SAMP>`~'</SAMP> как псевдоним начального каталога, как вы
делали бы это в Unix.  Вы также можете установить переменную среды
@env{HOME} до запуска Emacs; ее значение перекроет описанное выше
поведение по умолчанию.


<P>
  Emacs обрабатывает в MS-DOS имя каталога <TT>`/dev'</TT> особым образом,
из-за некоторых средств в библиотеках эмулятора из DJGPP, которые
создают видимость, что в этом каталоге перечислены имена устройств
ввода/вывода.  Мы рекомендуем избегать использования на любом диске
настоящего каталога с именем <TT>`/dev'</TT>.




<H2><A NAME="SEC517" HREF="emacs_toc.html#TOC517">Текстовые файлы и двоичные файлы</A></H2>
<P>
<A NAME="IDX2779"></A>


<P>
  GNU Emacs использует для разделения строк знак перевода строки.  Это
соглашение относится к Unix, на которой GNU Emacs был разработан, и в
системах GNU, так как они принимают Unix за модель.


<P>
<A NAME="IDX2780"></A>
  MS-DOS и MS-Windows обычно используют для разделения строк
последовательность возврат каретки-прогон строки.  (Прогон строки ---
это тот же знак, что и перевод строки.)  Следовательно, для удобного
редактирования в Emacs необходимо преобразование этих
последовательностей конец-строки (EOL).  И обычно Emacs делает это: во
время считывания файла он превращает возврат каретки-перевод строки в
перевод строки, а во время записи -- перевод строки в возврат
каретки-перевод строки.  Это преобразование реализуется тем же
механизмом, что управляет преобразованием кодов знаков из разных языков
(see section <A HREF="emacs_23.html#SEC205">Системы кодирования</A>).


<P>
<A NAME="IDX2781"></A>
<A NAME="IDX2782"></A>
  Одним из следствий этого особого преобразования формата большинства
файлов является то, что сообщаемая Emacs позиция знака
(see section <A HREF="emacs_9.html#SEC33">Информация о позиции курсора</A>) не соответствует информации о размере
файла, известной операционной системе.


<P>
<A NAME="IDX2783"></A>
  Некоторые виды файлов не должны преобразовываться, так как их
содержимое не является на самом деле текстом.  Следовательно, Emacs
различает в MS-DOS некоторые файлы как <EM>двоичные</EM> и считывает и
записывает их буквально.  (Это различение -- не часть MS-DOS; оно
делается только в Emacs.)  Сюда включаются исполняемые файлы, сжатые
архивы и так далее.  Emacs решает, двоичный это файл или нет, по его
имени: шаблоны имен, указывающих на двоичные файлы, определяются
переменной <CODE>file-name-buffer-file-type-alist</CODE>. Обратите внимание,
если имя файла соответствует одному из шаблонов для двоичных файлов в
<CODE>file-name-buffer-file-type-alist</CODE>, Emacs использует систему
кодирования <CODE>no-conversion</CODE> (see section <A HREF="emacs_23.html#SEC205">Системы кодирования</A>), которая
выключает <EM>все</EM> преобразования кодирования, а не только EOL.


<P>
  Кроме того, если Emacs узнает из содержимого файла, что в нем в
качестве разделителя строк используется перевод строки, а не возврат
каретки-прогон строки, он не делает превращения при чтении или записи
этого файла.  Таким образом, вы можете редактировать в MS-DOS файлы с
систем Unix или GNU без специальных усилий, и в них останутся знаки EOL
в стиле Unix.


<P>
<A NAME="IDX2784"></A>
<A NAME="IDX2785"></A>
  Вы можете обратиться к файлу и указать, нужно ли воспринимать его как
текстовый или же как двоичный, с помощью команд <CODE>find-file-text</CODE> и
<CODE>find-file-binary</CODE>.  Преобразование EOL -- это часть более общего
механизма преобразования системы кодирования, поэтому другой способ
указать это же -- воспользоваться командами для задания системы
кодирования (see section <A HREF="emacs_23.html#SEC207">Задание системы кодирования</A>).  Например, <KBD>C-x <KBD>RET</KBD>
c undecided-unix <KBD>RET</KBD> C-x C-f foobar.txt</KBD> обратится к файлу
<TT>`foobar.txt'</TT> без превращения EOL.


<P>
  В строке режима показывается, использовалось ли для текущего буфера
преобразование EOL.  Обычно после буквы системы кодирования в начале
строки режима появляется двоеточие.  Если в этом буфере используется
преобразование последовательности конец-строки MS-DOS, этот знак
заменяется на обратную косую черту.


<P>
<A NAME="IDX2786"></A>
<A NAME="IDX2787"></A>
  Если вы используете NFS или Samba для доступа к файловым системам,
находящимся на компьютерах с Unix или GNU, Emacs не должен производить
преобразование EOL для любых файлов в этих файловых системах -- даже
если вы создаете новый файл.  Чтобы затребовать это, обозначьте их как
<EM>нетранслируемые</EM> файловые системы, вызвав функцию
<CODE>add-untranslated-filesystem</CODE>.  Она принимает один аргумент: имя
файловой системы, включая букву диска, и, возможно, каталог.  Например,



<PRE>
(add-untranslated-filesystem "Z:")
</PRE>

<P>
обозначает как нетранслируемую файловую систему диск Z, а



<PRE>
(add-untranslated-filesystem "Z:\\foo")
</PRE>

<P>
обозначает как нетранслируемую файловую систему каталог <TT>`\foo'</TT> на
диске Z.


<P>
  Чаще всего <CODE>add-untranslated-filesystem</CODE> пишется в файле
<TT>`_emacs'</TT> или же в файле <TT>`site-start.el'</TT>, чтобы все
пользователи вашей системы получили от нее пользу.


<P>
<A NAME="IDX2788"></A>
  Чтобы отменить действие <CODE>add-untranslated-filesystem</CODE>,
используйте функцию <CODE>remove-untranslated-filesystem</CODE>.  Эта функция
принимает один аргумент, который должен быть такой же строкой, что была
ранее передана <CODE>add-untranslated-filesystem</CODE>.




<H2><A NAME="SEC518" HREF="emacs_toc.html#TOC518">Печать в MS-DOS</A></H2>

<P>
  Команды печати, такие как <CODE>lpr-buffer</CODE> (see section <A HREF="emacs_35.html#SEC428">Вывод твердой копии</A>) и
<CODE>ps-print-buffer</CODE> (see section <A HREF="emacs_35.html#SEC429">Печать через Postscript</A>), могут работать в MS-DOS и
MS-Windows, посылая вывод на порты принтера, если недоступна команда в
стиле Unix @command{lpr}.  Такое поведение контролируется теми же
переменными, что управляют печатью через @command{lpr} в Unix
(see section <A HREF="emacs_35.html#SEC428">Вывод твердой копии</A>, see section <A HREF="emacs_35.html#SEC430">Переменные, управляющие печатью в Postscript</A>), но MS-DOS и MS-Windows значения этих переменных по
умолчанию отличаются от их значений по умолчанию в Unix.


<P>
<A NAME="IDX2789"></A>
  Если вы хотите использовать ваш локальный принтер, печатающий обычным
для DOS образом, то установите лисповскую переменную <CODE>lpr-command</CODE>
в значение <CODE>""</CODE> (это значение по умолчанию), а <CODE>printer-name</CODE>
--- равной имени порта принтера -- например, <CODE>"PRN"</CODE>, обычного
порта локального принтера (это значение по умолчанию), или
<CODE>"LPT2"</CODE>, или <CODE>"COM1"</CODE>, для последовательного принтера.  Вы
также можете установить <CODE>printer-name</CODE> равной имени файла, в этом
случае "печатаемый" вывод на самом деле добавляется в конец этого
файла.  Если вы установите <CODE>printer-name</CODE> в значение <CODE>"NUL"</CODE>,
печатаемый вывод забывается (посылается в системное нулевое устройство)
без предупреждений.


<P>
  В MS-Windows, когда установлено сетевое программное обеспечение, вы
можете также использовать принтер, предоставляемый другой машиной,
установив <CODE>printer-name</CODE> равной UNC-имени разделяемого ресурса для
этого принтера -- например, <CODE>"//joes_pc/hp4si"</CODE>.  (Здесь не имеет
значения, пишете ли вы простые или обратные косые черты.)  Чтобы
выяснить имена разделяемых принтеров, запустите в командной подсказке
DOS команду <SAMP>`net view'</SAMP> для получения перечня серверов и <SAMP>`net
view <VAR>имя-сервера</VAR>'</SAMP>, чтобы увидеть имена принтеров (и каталогов),
предоставляемых этим сервером.


<P>
  Если вы устанавливаете <CODE>printer-name</CODE> равной имени файла, лучше
всего будет задать абсолютное имя.  Emacs изменяет рабочий каталог в
соответствии с каталогом по умолчанию текущего буфера, так что если имя
файла в <CODE>printer-name</CODE> относительно, в результате у вас окажется
несколько таких файлов, по одному в каталоге каждого буфера, откуда
производилась печать.


<P>
<A NAME="IDX2790"></A>
<A NAME="IDX2791"></A>
<A NAME="IDX2792"></A>
  Команды <CODE>print-buffer</CODE> и <CODE>print-region</CODE> вызывают программу
@command{pr} или используют особые переключатели программы
@command{lpr}, чтобы создать на каждой напечатанной странице заголовок.
Обычно в MS-DOS и MS-Windows нет этих программ, поэтому по умолчанию
переменная <CODE>lpr-headers-switches</CODE> устанавливается так, что запросы
на печать заголовков страниц игнорируются.  Поэтому <CODE>print-buffer</CODE>
и <CODE>print-region</CODE> дают тот же вывод, что и <CODE>lpr-buffer</CODE> и
<CODE>lpr-region</CODE>, соответственно.  Если у вас есть подходящая программа
@command{pr} (например, из GNU Textutils), установите
<CODE>lpr-headers-switches</CODE> равной <CODE>nil</CODE>; тогда Emacs будет
вызывать @command{pr} для создания заголовков страниц и печатать
полученный вывод, как указано переменной <CODE>printer-name</CODE>.


<P>
<A NAME="IDX2793"></A>
<A NAME="IDX2794"></A>
<A NAME="IDX2795"></A>
<A NAME="IDX2796"></A>
  Наконец, если у вас есть подобие @command{lpr}, вы можете установить
переменную <CODE>lpr-command</CODE> в значение <CODE>"lpr"</CODE>.  Тогда Emacs
будет использовать для печати @command{lpr}, как и в других системах.
(Если имя этой программы отличается от <SAMP>`lpr'</SAMP>, установите
<CODE>lpr-command</CODE> так, чтобы она указывала, где ее можно найти.)  Когда
<CODE>lpr-command</CODE> не равна <CODE>""</CODE>, переменная <CODE>lpr-switches</CODE>
несет свой обычный смысл.  Если значением переменной <CODE>printer-name</CODE>
является строка, то она используется как значение ключа @option{-P} для
@command{lpr}, как и в Unix.


<P>
<A NAME="IDX2797"></A>
<A NAME="IDX2798"></A>
<A NAME="IDX2799"></A>
<A NAME="IDX2800"></A>
<A NAME="IDX2801"></A>
  Параллельный набор переменных, <CODE>ps-lpr-command</CODE>,
<CODE>ps-lpr-switches</CODE> и <CODE>ps-printer-name</CODE> (see section <A HREF="emacs_35.html#SEC430">Переменные, управляющие печатью в Postscript</A>), определяет, как нужно
печатать PostScript-файлы.  Эти переменные используются таким же
способом, как соответствующие описанные выше переменные для печати не в
PostScript.  Таким образом, значение <CODE>ps-printer-name</CODE> используется
в качестве имени устройства (или файла), на которое посылается вывод
PostScript, так же, как <CODE>printer-name</CODE> используется для печати не в
PostScript.  (Это два различных набора переменных в случае, если у вас
два принтера, подсоединенных к разным портам, и только один из них ---
PostScript-принтер.)


<P>
  Значение переменной <CODE>ps-lpr-command</CODE> равно по умолчанию
<CODE>""</CODE>, что направляет вывод PostScript на порт принтера, заданный в
<CODE>ps-printer-name</CODE>.  Но <CODE>ps-lpr-command</CODE> можно также установить
равной имени программы, воспринимающей PostScript-файлы.  Это значит,
что если у вас не PostScript-принтер, вы можете задать в этой переменной
имя программы-интерпретатора PostScript (такой как Ghostscript).  Любые
переключатели, которые необходимо передать интерпретатору, указываются в
переменной <CODE>ps-lpr-switches</CODE>.  (Если значением
<CODE>ps-printer-name</CODE> является строка, она будет добавлена к списку
переключателей в качестве значения ключа @option{-P}.  Скорее всего, это
будет полезно, только если вы пользуетесь @command{lpr}, поэтому, если
вы печатаете через интерпретатор, вам следует cделать
<CODE>ps-printer-name</CODE> не строкой, чтобы она проигнорировалась.)


<P>
  Например, чтобы использовать Ghostscript для печати на принтере Epson,
подсоединенному к порту <SAMP>`LPT2'</SAMP>, поместите в ваш файл <TT>`_emacs'</TT>
такой код:



<PRE>
(setq ps-printer-name t)  ; Ghostscript не принимает -P
(setq ps-lpr-command "c:/gs/gs386")
(setq ps-lpr-switches '("-q" "-dNOPAUSE"
			"-sDEVICE=epson"
			"-r240x72"
			"-sOutputFile=LPT2"
			"-Ic:/gs"))
</PRE>

<P>
(Это предполагает, что Ghostscript установлен в каталоге
<TT>`"c:/gs"'</TT>.)


<P>
<A NAME="IDX2802"></A>
<A NAME="IDX2803"></A>
  Для обратной совместимости, если переменная <CODE>dos-printer</CODE>
(<CODE>dos-ps-printer</CODE>) имеет значение, то оно перекрывает значение
<CODE>printer-name</CODE> (<CODE>ps-printer-name</CODE>); это относится только к
MS-DOS и MS-Windows.




<H2><A NAME="SEC519" HREF="emacs_toc.html#TOC519">Поддержка разных языков в MS-DOS</A></H2>
<P>
<A NAME="IDX2804"></A>


<P>
  Emacs поддерживает в MS-DOS те же наборы знаков разных языков, что и в
Unix, и на других платформах (see section <A HREF="emacs_23.html#SEC198">Поддержка разных языков</A>), включая системы кодирования
для преобразования между различными наборами знаков.  Однако, из-за
несовместимости между MS-DOS/MS-Windows и Unix у этой поддержки есть
несколько специфичных для DOS аспектов, о которых пользователи должны
знать.  Эти аспекты описаны в данном разделе.


<DL COMPACT>

<DT><KBD>M-x dos-codepage-setup</KBD>
<DD>
Приводит экран Emacs и системы кодирования в соответствие с текущей
кодовой страницей DOS.

<DT><KBD>M-x codepage-setup</KBD>
<DD>
Создает систему кодирования для конкретной кодовой страницы DOS.
</DL>

<P>
<A NAME="IDX2805"></A>
<A NAME="IDX2806"></A>
  По своему дизайну MS-DOS поддерживает один набор из 256 знаков в
каждый момент времени, но дает вам выбрать из множества наборов знаков.
Эти альтернативные наборы знаков известны как <EM>кодовые страницы
DOS</EM>.  Каждая кодовая страница включает все 128 знаков ASCII, но
остальные 128 (с кодами от 128 до 255) изменяются от одной кодовой
страницы к другой.  Каждой кодовой странице DOS присвоен трехзначный
номер, как 850, 862, etc.


<P>
  В противоположность X Windows, которая позволяет вам использовать
несколько шрифтов одновременно, в MS-DOS нельзя использовать несколько
кодовых страниц в течение одного сеанса.  Вместо этого, MS-DOS загружает
одну кодовую страницу во время запуска, и чтобы изменить кодовую
страницу, вы должны перезагрузить MS-DOS<A NAME="DOCF8" HREF="emacs_foot.html#FOOT8">(8)</A>.  Практически те же ограничения применяются к
исполняемым файлам DOS в других системах, таких как MS-Windows.


<P>
<A NAME="IDX2807"></A>
  Если вы вызываете Emacs в MS-DOS с ключом @option{--unibyte}
(see section <A HREF="emacs_38.html#SEC496">Ключи запуска</A>), Emacs не делает никаких преобразований знаков,
не входящих в ASCII.  Напротив, он считывает и записывает такие знаки
буквально и буквально посылает их восьмибитные коды на дисплей.  Таким
образом, однобайтный Emacs поддерживает в MS-DOS текущую кодовую
страницу, какой бы она не была, но не может представить никакие другие
знаки.


<P>
<A NAME="IDX2808"></A>
  Для многобайтной работы на MS-DOS, Emacs должен знать, какие знаки
может отображать выбранная кодовая страница DOS.  Поэтому он вскоре
после старта посылает системе запрос о номере выбранной кодовой страницы
и сохраняет этот номер в переменной <CODE>dos-codepage</CODE>.  Некоторые
системы возвращают 437, значение по умолчанию, даже если в
действительности кодовая страница другая.  (Обычно это происходит, если
вы используете кодовую страницу, встроенную в дисплей.)  Вы можете
велеть Emacs использовать другую кодовую страницу, устанавливая в вашем
файле инициализации переменную <CODE>dos-codepage</CODE>.


<P>
<A NAME="IDX2809"></A>
  Многобайтный Emacs поддерживает только некоторые кодовые страницы DOS,
те, что показывают восточные виды письма, как японская кодовая страница
932, и те, которые кодируют один из наборов знаков ISO 8859.


<P>
  Дальневосточные кодовые страницы могут непосредственно отображать один
из наборов знаков MULE для этих стран, поэтому Emacs просто
подготавливает к применению подходящую систему кодирования терминала,
которая поддерживается этой кодовой страницей.  Описываемые в остальной
части главы особые средства относятся в основном к кодовым страницам,
кодирующим наборы знаков ISO 8859.


<P>
  Для кодовых страниц, соответствующих одному из наборов знаков ISO
8859, Emacs узнает имя этого набора, основываясь на номере кодовой
страницы.  Emacs автоматически создает систему кодирования для поддержки
чтения и записи файлов в текущей кодовой странице и использует эту
систему кодирования по умолчанию.  Имя этой системы кодирования ---
<CODE>cp<VAR>nnn</VAR></CODE>, где <VAR>nnn</VAR> -- это номер кодовой
страницы.<A NAME="DOCF9" HREF="emacs_foot.html#FOOT9">(9)</A>
(<SAMP>`c'</SAMP> с седилем) имеет в стандартном наборе символов Latin-1 код
231, но соответствующая кодовая страница 850 использует для этой буквы
код 135.}


<P>
<A NAME="IDX2810"></A>
  Все системы кодирования <CODE>cp<VAR>nnn</VAR></CODE> используют в качестве
мнемоники для строки режима букву <SAMP>`D'</SAMP> (от "DOS").  Поскольку во
время запуска и система кодирования терминала, и система кодирования для
ввода/вывода файлов устанавливаются в подходящее значение
<CODE>cp<VAR>nnn</VAR></CODE>, строка режима в MS-DOS обычно начинается
<SAMP>`-DD\-'</SAMP>.  See section <A HREF="emacs_6.html#SEC15">Строка режима</A>.


<P>
  Так как кодовая страница также указывает и на то, какой вид письма вы
используете, Emacs автоматически запускает
<CODE>set-language-environment</CODE>, чтобы выбрать языковую среду для этой
письменности (see section <A HREF="emacs_23.html#SEC201">Языковые среды</A>).


<P>
  Если буфер содержит знак, принадлежащий какому-то другому набору ISO
8859, не тому, что поддерживается выбранной кодовой страницей DOS, Emacs
показывает его с помощью последовательности знаков ASCII.  Например,
если в текущей кодовой странице нет глифа для буквы <SAMP>``o'</SAMP>
(маленькой <SAMP>`o'</SAMP> с акцентом грав), она отображается как
<SAMP>`{`o}'</SAMP>, где фигурные скобки служат визуальным указанием на то,
что это один знак.  (Это может выглядеть странно с некоторыми знаками не
из латиницы, а, например, из греческого или иврита; но это все же можно
читать, если вы знаете язык.)  Хотя знак может занимает на экране
несколько столбцов, он на самом деле является одиночным знаком, и все
команды Emacs понимают его как одиночный.


<P>
<A NAME="IDX2811"></A>
  Не всем знакам из кодовых страниц DOS есть соответствия в ISO 8859 ---
некоторые используются для других целей, например для псевдографики.  В
Emacs нет внутреннего представления для этих знаков, поэтому когда вы
считываете файл, содержащий такие знаки, они превращаются в определенные
знаковые коды, задаваемые переменной
<CODE>dos-unsupported-character-glyph</CODE>.


<P>
  Кроме ISO 8859, Emacs поддерживает много других наборов знаков, но он
не может отображать их в MS-DOS.  Поэтому, если в буфере появляется один
из таких многобайтных знаков, Emacs для MS-DOS показывает их, как
указано в переменной <CODE>dos-unsupported-character-glyph</CODE>; по
умолчанию этим глифом является пустой треугольник.  Чтобы увидеть
действительный код такого знака и набор, к которому он принадлежит,
используйте команду <KBD>C-u C-x =</KBD>.  See section <A HREF="emacs_9.html#SEC33">Информация о позиции курсора</A>.


<P>
<A NAME="IDX2812"></A>
  По умолчанию Emacs определяет систему кодирования для поддержки
текущей кодовой страницы.  Чтобы определить систему кодирования для
какой-то другой кодовой страницы (например, чтобы обратиться к файлу,
написанному на машине с DOS в другой стране), используйте команду
<KBD>M-x codepage-setup</KBD>.  Она запрашивает с возможностью завершения
трехзначный номер кодовой страницы, а затем создает для нее систему
кодирования.  Тогда для чтения и записи файла вы можете применять эту
новую систему кодирования, но тогда вы должны явно задавать ее командам
работы с файлами (see section <A HREF="emacs_23.html#SEC207">Задание системы кодирования</A>).


<P>
  Эти системы кодирования также полезны для обращения к файлам,
использующим кодовые страницы DOS, когда Emacs запущен на других
операционных системах.




<H2><A NAME="SEC520" HREF="emacs_toc.html#TOC520">Подпроцессы в MS-DOS</A></H2>

<P>
<A NAME="IDX2813"></A>
<A NAME="IDX2814"></A>
<A NAME="IDX2815"></A>
<A NAME="IDX2816"></A>
  Поскольку MS-DOS -- это однозадачная "операционная система",
асинхронные подпроцессы недоступны.  В частности, не работают режим
Shell и его варианты.  Также не работают большинство средств Emacs,
использующих асинхронные подпроцессы, включая проверку правописания и
GUD.  Когда вы сомневаетесь, попробуйте и увидите; неработающие команды
печатают сообщение об ошибке, говорящее, что асинхронные подпроцессы не
поддерживаются.


<P>
  Компиляция под Emacs с использованием <KBD>M-x compile</KBD>, поиск файлов
с помощью <KBD>M-x grep</KBD> и показ различий между файлами с помощью
<KBD>M-x diff</KBD> в действительности работают, запуская подчиненные
процессы синхронно.  Это означает, что вы не можете редактировать, пока
подчиненный процесс не завершится.


<P>
  Напротив, Emacs, скомпилированный как "родное" приложение Windows,
<STRONG>поддерживает</STRONG> асинхронные подпроцессы.  See section <A HREF="emacs_40.html#SEC521">Подпроцессы в Windows 95 и NT</A>.


<P>
<A NAME="IDX2817"></A>
  Команды печати, такие как <CODE>lpr-buffer</CODE> (see section <A HREF="emacs_35.html#SEC428">Вывод твердой копии</A>) и
<CODE>ps-print-buffer</CODE> (see section <A HREF="emacs_35.html#SEC429">Печать через Postscript</A>), работают в MS-DOS, посылая
вывод на один из портов принтера.  See section <A HREF="emacs_40.html#SEC518">Печать в MS-DOS</A>.


<P>
  Когда вы запустили синхронный процесс в MS-DOS, убедитесь, что он
завершился и не пытается читать ввод с клавиатуры.  Если программа не
завершится сама, вы не сможете прервать ее вручную, потому что MS-DOS не
предоставляет общего способа прервать процесс.  Иногда в таких случаях
может помочь нажатие <KBD>C-c</KBD> или <KBD>C-<KBD>BREAK</KBD></KBD>.


<P>
  Доступ к файлам на других машинах не поддерживается в MS-DOS.  Другие
ориентированные на работу с сетью команды, такие как отправка почты,
хождение по Web, удаленный вход в систему и другие, также не работают,
если в MS-DOS не встроен доступ к сети через сетевой редиректор.


<P>
<A NAME="IDX2818"></A>
<A NAME="IDX2819"></A>
  Dired в MS-DOS использует пакет <CODE>ls-lisp</CODE>, где на других
платформах применяется системная команда @command{ls}.  Поэтому Dired
поддерживает в MS-DOS лишь некоторые из возможных ключей, которые вы
можете перечислить в переменной <CODE>dired-listing-switches</CODE>.  Работают
ключи @option{-A}, @option{-a}, @option{-c}, @option{-i}, @option{-r},
@option{-S}, @option{-s}, @option{-t} и @option{-u}.




<H2><A NAME="SEC521" HREF="emacs_toc.html#TOC521">Подпроцессы в Windows 95 и NT</A></H2>

<P>
  Emacs, скомпилированный как "родное" приложение Windows (в
противоположность версии для DOS) включает полную поддержку асинхронных
подпроцессов.  В версии для Windows синхронные и асинхронные подпроцессы
работают нормально как в Windows 95, так и в Windows NT, до тех пор,
пока вы запускаете только 32-битные приложения Windows.  Однако, если вы
запускаете в подпроцессе приложение DOS, вы можете столкнуться с
некоторыми проблемами или вообще не суметь запустить это приложение; а
если вы одновременно запустили два приложения DOS в двух подпроцессах,
вам, возможно, придется перезагрузить систему.


<P>
  Поскольку стандартный интерпретатор команд (и большинство утилит
командной строки) в Windows 95 являются приложениями DOS, эти проблемы
весьма важны.  Но мы ничего не можем с этим поделать, их может исправить
только Microsoft.


<P>
  Если вы запустили только один подпроцесс с приложением DOS, он должен
работать, как ожидается, если только он "ведет себя хорошо" и не
пытается получить прямой доступ к дисплею и не делает необычных
действий.  Если у вас есть программа отслеживания загрузки CPU, то она
покажет, что машина загружена на 100%, даже если приложение DOS ничего
не делает, но это просто пережиток того способа, которым эти программы
измеряют загрузку CPU.


<P>
  Вы должны завершить приложение DOS до того, как запустите любое другое
в отдельном подпроцессе.  Emacs не может прервать или завершить
подпроцесс DOS.  Единственный способ остановить такой подпроцесс ---
дать его программе команду выхода.


<P>
  Если вы попытаетесь одновременно запустить два приложения DOS в разных
подпроцессах, второй будет приостановлен до завершения первого, даже
если оба они асинхронные.


<P>
  Если вы можете перейти в первый подпроцесс и велеть ему выйти, второй
процесс должен нормально продолжить работу.  Однако, если второй
подпроцесс синхронный, зависнет сам Emacs до тех пор, пока не завершится
первый подпроцесс.  Если это не может случаться без пользовательского
ввода, вам не останется ничего, кроме как перезагрузиться, если вы
работаете на Windows 95.  Если у вас Windows NT, вы можете использовать
монитор процессов, чтобы уничтожить нужный экземпляр ntvdm (это
уничтожит оба подпроцесса DOS).


<P>
  Если вам приходится в такой ситуации перезагружать Windows 95, не
используйте команду <CODE>Shutdown</CODE> в меню <CODE>Start</CODE>; это только
подвесит систему.  Вместо этого, нажмите <KBD>CTL-ALT-<KBD>DEL</KBD></KBD> и
выберите затем <CODE>Shutdown</CODE>.  Обычно это работает, хотя и может
занять несколько минут.




<H2><A NAME="SEC522" HREF="emacs_toc.html#TOC522">Использование системного меню в Windows</A></H2>

<P>
  Emacs, собранный как "родное" приложение Windows, обычно выключает
такое свойство Windows, что прижатие клавиши <KBD>ALT</KBD> вызывает меню.
Так делается, потому что <KBD>ALT</KBD> работает в Emacs в качестве
<KBD>META</KBD>.  Часто при использовании Emacs пользователи временно
нажимают клавишу <KBD>META</KBD>, а потом меняют решение; если это будет
вызывать меню Windows, то смысл последующих команд изменится.  Многие
находят это неприятным.


<P>
<A NAME="IDX2820"></A>
  Вы можете снова задействовать обработку прижатия клавиши <KBD>ALT</KBD>,
принятую в Windows по умолчанию, установив <CODE>w32-pass-alt-to-system</CODE>
в отличное от <CODE>nil</CODE> значение.
<P><HR><P>
Go to the <A HREF="emacs_1.html">first</A>, <A HREF="emacs_39.html">previous</A>, <A HREF="emacs_41.html">next</A>, <A HREF="emacs_46.html">last</A> section, <A HREF="emacs_toc.html">table of contents</A>.
</BODY>
</HTML>
