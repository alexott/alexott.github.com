<HTML>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- Created on December, 4  2003 by texi2html 1.64 -->
<!-- 
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Olaf Bachmann <obachman@mathematik.uni-kl.de>
Send bugs and suggestions to <texi2html@mathematik.uni-kl.de>
 
-->
<HEAD>
<TITLE>Программирование на Emacs Lisp: Полный график</TITLE>

<META NAME="description" CONTENT="Программирование на Emacs Lisp: Полный график">
<META NAME="keywords" CONTENT="Программирование на Emacs Lisp: Полный график">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META NAME="Generator" CONTENT="texi2html 1.64">

</HEAD>

<BODY LANG="" BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">

<A NAME="SEC225"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_21.html#SEC224"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC227"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_21.html#SEC214"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_23.html#SEC242"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_23.html#SEC242">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1> C. График с помечеными осями </H1>
<!--docid::SEC225::-->
<P>

Координатные оси помогают воспринимать график, обычно на них наносится
масштаб.  В предыдущих главах мы создали функции для печати тела
графика, сейчас мы напишем функции для печати вертикальной и
горизонтальной оси вместе с самим графиком.
</P><P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="emacs-lisp-intro_22.html#SEC226">Пример графика с пометками</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How a finished graph should look.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="emacs-lisp-intro_22.html#SEC228">C.2 The <CODE>print-Y-axis</CODE> Function</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Print a label for the vertical axis.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="emacs-lisp-intro_22.html#SEC233">C.3 The <CODE>print-X-axis</CODE> Function</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Print a horizontal label.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="emacs-lisp-intro_22.html#SEC235">C.4 Printing the Whole Graph</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">The function to print a complete graph.</TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Labelled Example"></A>
<A NAME="SEC226"></A>
<H2> Пример графика с пометками </H2>
<!--docid::SEC226::-->
<P>

Так как вставляемые символы заполняют буфер вправо и вниз наша новая
функция должна вначале печатать вертикальную ось или ось Y, затем тело
графика и в конце ось X или горизонтальную ось.  Все это можно
представить следующим образом:
</P><P>

<OL>
<LI>
Инициализация code.
<P>

<LI>
Печать оси Y.
<P>

<LI>
Печать графика.
<P>

<LI>
Печать оси X.
</OL>
<P>

Вот как может выглядеть наш график:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>    10 -          
                  *
                  *  *
                  *  **
                  *  ***
     5 -      *   *******
            * *** *******
            *************
          ***************
     1 - ****************
         |   |    |    |
         1   5   10   15
</pre></td></tr></table></P><P>

В этом графике координатные оси пронумерованы числами, однако иногда по
горизонтальной оси откладывается время и тогда лучше нумеровать
месяцами, например, как в следующем графике:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>     5 -      * 
            * ** *
            *******
          ********** **
     1 - **************
         |    ^      |
         Jan  June   Jan
</pre></td></tr></table></P><P>

На самом деле, если мы проявим немного фантазии, то сможем придумать
множество возможных способов нумерации координатных осей, но это только
усложнит задачу.  Вместо этого лучше вначале для первой попытки выбрать
простую схему, а впоследствии ее можно заменить или модифицировать.
</P><P>

Все эти рассуждения приводять нас к следующему шаблону для будущей
функции <CODE>print-graph</CODE>:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun print-graph (numbers-list)
  "<VAR>документация</VAR><small>...</small>"
  (let ((height  <small>...</small>
        <small>...</small>))
    (print-Y-axis height <small>...</small> )
    (graph-body-print numbers-list)
    (print-X-axis <small>...</small> )))
</pre></td></tr></table></P><P>

Теперь мы можем по очереди реализовывать каждую часть определения
функции <CODE>print-graph</CODE>.
</P><P>

<A NAME="Список переменных print-graph"></A>
<HR SIZE="6">
<A NAME="SEC227"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC225"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC228"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC226"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_23.html#SEC242">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> C.1 Список переменных <CODE>print-graph</CODE> </H2>
<!--docid::SEC227::-->
<P>

При создании функции <CODE>print-graph</CODE> первая задача написать список
переменных для выражения <CODE>let</CODE>.  (Пока мы не будем задумываться
документировании функции и о том будет ли она интерактивной или нет.)
</P><P>

В списке переменных будет создано несколько значений.  Ясно, что верхняя
метка для вертикальной оси должна быть по крайней мере равна высоте
графика, это значит что здесь нам понадобится эта информация.  Отметим,
что функции <CODE>print-graph-body</CODE> так же требуется эта информация.
Нет никаких оснований вычислять высоту графика в двух разных местах,
поэтому мы должны немного изменить предыдущую версию
<CODE>print-graph-body</CODE> для того чтобы воспользоваться появившимися
преимуществами. 
</P><P>

Аналогично и функции для печати оси X и функции <CODE>print-graph-body</CODE>
необходимо знать ширину каждого символа, поэтому мы можем произвести
вычисления ширины символа при создании списка аргументов и так же
немного изменить предыдущее определение <CODE>print-graph-body</CODE>.
</P><P>

Последняя метка откладываемая по горизонтали должна быть по крайней мере
такой же длины как и график, однака эта информация используется только в
функции для печати горизонтальной оси, поэтому мы можем не вычислять ее
в списке переменных выражения <CODE>let</CODE>.
</P><P>

Все это приводит нас к следующей форме списка переменных выражения
<CODE>let</CODE> для функции <CODE>print-graph</CODE>:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(let ((height (apply 'max numbers-list)) ; First version.
      (symbol-width (length graph-blank)))
</pre></td></tr></table></P><P>

В последствии мы увидим, что это выражение не совсем правильно.
</P><P>

<A NAME="print-Y-axis"></A>
<HR SIZE="6">
<A NAME="SEC228"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC227"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC229"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC233"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_23.html#SEC242">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> C.2 The <CODE>print-Y-axis</CODE> Function </H2>
<!--docid::SEC228::-->
<P>

Задача функции  <CODE>print-Y-axis</CODE> пронумеровать вертикальную ось, что
будет выглядеть примерно следующим образом:
              
<TABLE><tr><td>&nbsp;</td><td class=example><pre>    10 -
        
        
        
        
     5 -
        
        
        
     1 -
</pre></td></tr></table></P><P>

В эту функцию надо передать высоту графика, для того чтобы она должным
образом вставила соответствующие номера и метки.
</P><P>

Впрочем легко сказать или нарисовать как должна выглядеть ось Y; но
написать функцию это совсем другое дело.  Будет не совсем правильно
сказать, что мы хотим номер и метку каждые пять строки: ведь только три
строки между <SAMP>`1'</SAMP> и <SAMP>`5'</SAMP> (строки 2, 3 и 4), а между <SAMP>`5'</SAMP> и
<CODE>10</CODE> уже четыре строки (строки 6, 7, 8, 9).  Лучше скажем, что нам
нужна отметка и номер в начале оси и потом метка с номером каждые
следующие пять строк.
</P><P>

Следующее, что мы должны обсудить чему должна быть равна метка,
предположим что максимальная высота колонки графика равна 7.  Какой
должна быть верхняя отметка по оси Y <SAMP>`5 -'</SAMP>, ведь тогда график будет
выше отметки?  Или верхняя метка должна быть равна <SAMP>`7 -'</SAMP>, чтобы мы
знали чему равен пик графика?  А может быть верхняя метка должна быть
равна <CODE>10 -</CODE>, ведь 10 делится на пять, но тогда верхняя метка будет
расположена выше чем верхнее значение графика?
 
Лучше всего реализовать последний случай.  Большинство графиков рисуется
в прямоугольниках, чьи оси пронумерованы дискретно 5  --- 5, 10, 15,
и так далее.  Но как только мы решаем использовать дискретных шаг для
вертикальной оси, мы обнаруживаем, что простое выражение для списка
переменных вычисляющее высоту неправильно.  Это выражение <CODE>(apply
'max numbers-list)</CODE>, и оно вернет максимальную высоту столбца, а нам
необходимо значение округленное к ближайшему числу кратному пяти.
Значит необходимо более сложное выражение.
</P><P>

Как обычно сложная задача станет проще, если ее можно разделить на
несколько небольших задач.
</P><P>

Во первых может получится, что высота графика число кратное пяти ---
5, 10, 15 или какое-нибудь большее число.  В этом случая мы можем
использовать это значение как высоту оси Y.
</P><P>

Самый простой способ определить кратность числа пяти это разделить число
на пять и проанализировать остаток.  Если остаток равен 0, значит число
кратно пяти.  Например семь при делении на пять дает в остатке 2, значит
семь не кратно пяти.  Если сказать совсем просто, как обычно говорять в
школе пять входит в семь один раз с остатком два.  Однако пять входит в
делять дважды без остатка: значит десять кратно пяти.
</P><P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="emacs-lisp-intro_22.html#SEC231">C.2.3 Создание колонки оси Y</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Generate a list of Y axis labels.</TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Вычисление остатка"></A>
<HR SIZE="6">
<A NAME="SEC229"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC228"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC230"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC228"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_23.html#SEC242">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H3> C.2.1 Обходной путь: Вычисление остатка </H3>
<!--docid::SEC229::-->
<P>

<A NAME="IDX115"></A>
<A NAME="IDX116"></A>
В Лиспе есть функция для вычисления остатка это <CODE>%</CODE>.  Эта функция
возвращает остаток от деления своего первого аргумента на свой второй
аргумент.  Так случилось, что <CODE>%</CODE> функция Emacs Lisp, которую вы не
сможете обнаружить с помощью g <CODE>apropos</CODE>: поиск <KBD>M-x apropos
<KBD>RET</KBD> remainder <KBD>RET</KBD></KBD> ничего не выдасть.  Единственных способ
узнать о существовании <CODE>%</CODE> только прочесть об этом в какой-нибудь
хорошей книге или изучив исходные тексты Emacs Lisp.  Функция <CODE>%</CODE>
используется в определении функции <CODE>rotate-yank-pointer</CODE>, об этом
можно прочесть в приложении (See section <A HREF="emacs-lisp-intro_21.html#SEC216">Тело функции <CODE>rotate-yank-pointer</CODE></A>.)
</P><P>

Вы можете освоить функции <CODE>%</CODE> вычислив следующие два выражения:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(% 7 5)

(% 10 5)
</pre></td></tr></table></P><P>

Первое выражение вернет 2, а второе выражение вернет 0.
</P><P>

Для проверки того, равно ли значение нулю или нет мы можем использовать
функцию <CODE>zerop</CODE>.  Эта функция вернет <CODE>t</CODE>, если ее аргумент,
который должен быть числом, ноль.
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(zerop (% 7 5))
     => nil

(zerop (% 10 5))
     => t
</pre></td></tr></table></P><P>

Таким образом следующее выражение вернет  <CODE>t</CODE>, если высота графика
кратна пяти:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(zerop (% height 5))
</pre></td></tr></table></P><P>

(Значение <CODE>height</CODE>, можно найти с помощью выражения <CODE>(apply
'max numbers-list)</CODE>.)
</P><P>

С другой стороны, если значение <CODE>height</CODE> не кратно пяти, мы должны
установить его в большее значение, которое кратно пяти.  Это достаточно
простое арифметическое действие, которое вполне можно выполнить уже
знакомыми нам функциями.  Сначала мы разделим значение <CODE>height</CODE> на
пять для того чтобы определить сколько раз пять входит в это число.
Например пять два раза входит в двенадцать, если мы добавим к частному
единицу и умножим его на пять, то мы получим большее число кратное
пяти.  Пять два раза входит в двенадцать, добавив к двум один и умножив
на пять мы получим пятнадцать, число кратное пяти и большее чем
двенадцать.  Соответствующее Лисп выражение приведено ниже: 
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(* (1+ (/ height 5)) 5)
</pre></td></tr></table></P><P>

После вычисления следующего выражения вы получите 15:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(* (1+ (/ 12 5)) 5)
</pre></td></tr></table></P><P>

Во время наших рассуждений мы использовали `пять', как значение
дискретного шага по оси Y; но мы вполне можем выбрать и какое-нибудь
другое значение, лучше всего, если мы заменим `пять' переменной, которой
мы сможем присвоить значение.  Самое лучшее имя, которое я смог
придумать это <CODE>Y-axis-label-spacing</CODE>.  Используя новоизобретенную
переменную и выражение <CODE>if</CODE>, мы получим следующее выражение:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(if (zerop (% height Y-axis-label-spacing))
    height
  ;; else
  (* (1+ (/ height Y-axis-label-spacing))
     Y-axis-label-spacing))
</pre></td></tr></table></P><P>

Это выражение возвращает значение <CODE>height</CODE>, если высота кратна
значению <CODE>Y-axis-label-spacing</CODE> или вычисляет и присваивает
переменной <CODE>height</CODE> следующее большее число, кратное
<CODE>Y-axis-label-spacing</CODE>.
</P><P>

Мы можем теперь включить это выражение в список переменных формы
<CODE>let</CODE> для функции <CODE>print-graph</CODE> (конечно после того, как
присвоим значение переменной <CODE>Y-axis-label-spacing</CODE>):
<A NAME="IDX117"></A>
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defvar Y-axis-label-spacing 5
  "Масштаб по вертикальной оси.")

<small>...</small>
(let* ((height (apply 'max numbers-list))
       (height-of-top-line
        (if (zerop (% height Y-axis-label-spacing))
            height
          ;; else
          (* (1+ (/ height Y-axis-label-spacing))
             Y-axis-label-spacing)))
       (symbol-width (length graph-blank))))
<small>...</small>
</pre></td></tr></table></P><P>

(Стоит отметить, что здесь мы используем функцию <CODE>let*</CODE>: вначале
вычисляется значение height с помощью <CODE>(apply 'max numbers-list)</CODE> и
после этого получившееся значение используется для вычисления
окончательного результата. See section <A HREF="emacs-lisp-intro_13.html#SEC154">The <CODE>let*</CODE> expression</A>, за дополнительной информацией о <CODE>let*</CODE>.)
</P><P>

<A NAME="Элемент оси Y"></A>
<HR SIZE="6">
<A NAME="SEC230"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC229"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC231"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC228"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC233"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_23.html#SEC242">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H3> C.2.2 Создание элементов оси Y </H3>
<!--docid::SEC230::-->
<P>

Когда мы печатаем вертикальные оси, мы вставляем строки, такие как
<SAMP>`5 -'</SAMP> и <SAMP>`10 - '</SAMP> каждые пять строк.   Более того мы
хотим, чтобы числа и тире шли по линии вверх, так что более короткие
номера были выровнены ведущими пробелами.  Если некоторые из строк
используют двухцифровые числа, тогда строки с одной цифрой должны
включать ведущий пробел перед числом.
</P><P>

<A NAME="IDX118"></A>
Для того чтобы вычислить длину числа используется функция
<CODE>length</CODE>.  Но функция <CODE>length</CODE> работает только со строкой, а
не с числом, поэтому число необходимо конвертировать в строку.  Это
можно сделать с помощью функции <CODE>int-to-string</CODE>.  Например,
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(length (int-to-string 35))
     => 2

(length (int-to-string 100))
     => 3
</pre></td></tr></table></P><P>

Кроме этого в каждой метке за числом следует строка <SAMP>` - '</SAMP>,
которую мы будем называть маркером <CODE>Y-axis-tic</CODE>.  Эта переменная
определена с помощью <CODE>defvar</CODE>:
</P><P>

<A NAME="IDX119"></A>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defvar Y-axis-tic " - "
   "Строка следующая за числом по оси Y.")
</pre></td></tr></table></P><P>

Длина метки Y  это сумма длин  <CODE>Y-axis-tic</CODE> и длины наибольшего
числа отложенного по оси Y.
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(length (concat (int-to-string height) Y-axis-tic))
</pre></td></tr></table></P><P>

Это значение будет вычисляться в списке переменных функции
<CODE>print-graph</CODE> и присваиваться переменной <CODE>full-Y-label-width</CODE>.
(Стоит отметить, что мы не думали включать эту переменную в список
переменных с самого начала.)
</P><P>

Для того чтобы полностью напечатать метку по вертикальной оси, знак тире
надо слить с номером; и перед обеими знаками может потребоваться
вставить один или два пробела, в зависимости от того, какой длины число.
Метка состоит из трех частей: (необязательные) ведущие пробелы, число и
знак тире.  В функцию передается число для заданой строки и значение
ширины самой высокой метки, которое вычисляется (один раз) в функции
<CODE>print-graph</CODE>.
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun Y-axis-element (number full-Y-label-width) 
  "Construct a NUMBERed label element.
A numbered element looks like this `  5 - ',
and is padded as needed so all line up with
the element for the largest number."
  (let* ((leading-spaces 
         (- full-Y-label-width
            (length
             (concat (int-to-string number)
                     Y-axis-tic)))))
    (concat
     (make-string leading-spaces ? )
     (int-to-string number)
     Y-axis-tic)))
</pre></td></tr></table></P><P>

В функции <CODE>Y-axis-element</CODE> соединяются вместе ведущие пробелы, если
необходимо; число, как строка; и знак тире.
</P><P>

Для того чтобы вычислить, сколько требуется ведущих пробелов в функции
производится вычитание фактической длины метки --- длины числа плюс
длины символа тире --- из желаемой ширины метки.
</P><P>

<A NAME="IDX120"></A>
Пробелы вставляются с помощью функции <CODE>make-string</CODE>.  Этой функции
требуются два аргумента: первый задает, какой длины должна быть строка,
а второй символ, который нужно вставить, заданный в особом формате.  В
нашем случае формат это знак вопроса за которым следует пробел, например
<SAMP>`? '</SAMP>.  See section `Character Type' in <CITE>The GNU Emacs Lisp Reference Manual</CITE>, за подробным описанием синтаксиса для символов.
</P><P>

Функция <CODE>int-to-string</CODE> используется при конкатенции выражения, для
того, чтобы конвертировать число в строку, которая будет слита с
пробелами и знаком тире.
</P><P>

<A NAME="Y-axis-column"></A>
<HR SIZE="6">
<A NAME="SEC231"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC230"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC232"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC228"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_23.html#SEC242">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H3> C.2.3 Создание колонки оси Y </H3>
<!--docid::SEC231::-->
<P>

Предыдущая функция обеспечила все что нам необходимо для того, чтобы
составить функцию, которая произведет список пронумерованных и пустых
строк, для того чтобы нанести масштаб по вертикальной оси:
</P><P>

<A NAME="IDX121"></A>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun Y-axis-column (height width-of-label)
  "Construct list of Y axis labels and blank strings.
For HEIGHT of line above base and WIDTH-OF-LABEL."
  (let (Y-axis)
    (while (&#62; height 1)
      (if (zerop (% height Y-axis-label-spacing))
          ;; Insert label.
          (setq Y-axis
                (cons
                 (Y-axis-element height width-of-label)
                 Y-axis))
        ;; Else, insert blanks.
        (setq Y-axis
              (cons
               (make-string width-of-label ? )
               Y-axis)))
      (setq height (1- height)))
    ;; Insert base line.
    (setq Y-axis
          (cons (Y-axis-element 1 width-of-label) Y-axis))
    (nreverse Y-axis)))
</pre></td></tr></table></P><P>

В этой функции, мы начнем со значения <CODE>height</CODE> и последовательно
будем вычиать единицу из данного значения.  После каждого вычитания,
мы будем проверять, является ли значение множителем
<CODE>Y-axis-label-spacing</CODE>.  Если это так, то мы будем создавать
нумерованную пометку используя функцию <CODE>Y-axis-element</CODE>; если это
не так, то мы будем создавать пустую пометку используя функцию
<CODE>make-string</CODE>.  Базовая линия состоит из числа единица, за
которым следуюет временная пометка.
</P><P>

<A NAME="Финальная версия print-Y-axis"></A>
<HR SIZE="6">
<A NAME="SEC232"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC231"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC233"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC228"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC233"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_23.html#SEC242">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H3> C.2.4 Финальная версия <CODE>print-Y-axis</CODE> </H3>
<!--docid::SEC232::-->
<P>

Список созданный функцией <CODE>Y-axis-column</CODE> передается функции
the <CODE>print-Y-axis</CODE>, которая вставляет список в виде колонки.
</P><P>

<A NAME="IDX122"></A>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun print-Y-axis
  (height full-Y-label-width &#38;optional vertical-step)
  "Insert Y axis using HEIGHT and FULL-Y-LABEL-WIDTH.
Height must be the  maximum height of the graph.
Full width is the width of the highest label element.
Optionally, print according to VERTICAL-STEP."
;; Value of height and full-Y-label-width 
;; are passed by `print-graph'.
  (let ((start (point)))
    (insert-rectangle
     (Y-axis-column height full-Y-label-width vertical-step))
    ;; Place point ready for inserting graph.
    (goto-char start)      
    ;; Move point forward by value of full-Y-label-width
    (forward-char full-Y-label-width)))
</pre></td></tr></table></P><P>

Функция <CODE>print-Y-axis</CODE> использует функцию <CODE>insert-rectangle</CODE>
для вставки меток оси Y, созданных функцией <CODE>Y-axis-column</CODE>. В
добавление к этому, она помещает точку в правильную позицию для
вывода тела графика.
</P><P>

Вы можете проверить работу <CODE>print-Y-axis</CODE>:
</P><P>

<OL>
<LI>
Установите
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>Y-axis-label-spacing
Y-axis-tic
Y-axis-element
Y-axis-columnprint-Y-axis
</pre></td></tr></table></P><P>

<LI>
Скопируйте следующее выражение:
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(print-Y-axis 12 5)
</pre></td></tr></table></P><P>

<LI>
Переключитесь в буфер <TT>`*scratch*'</TT> и поместите курсор в точку, где
вы хотите начать помещать метки осей.
<P>

<LI>
Наберите <KBD>M-:</KBD> (<CODE>eval-expression</CODE>).
<P>

<LI>
Возьмите выражение <CODE>graph-body-print</CODE> в минибуфер с помощью
клавиши <KBD>C-y</KBD> (<CODE>yank)</CODE>.
<P>

<LI>
Нажмите <KBD>RET</KBD> для оценки выражения.
</OL>
<P>

Emacs will print labels vertically, the top one being 
<SAMP>`10 - '</SAMP>.  (The <CODE>print-graph</CODE> function 
will pass the value of <CODE>height-of-top-line</CODE>, which 
in this case would be 15.)
</P><P>

<A NAME="print-X-axis"></A>
<HR SIZE="6">
<A NAME="SEC233"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC232"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC234"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC228"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC235"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_23.html#SEC242">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> C.3 The <CODE>print-X-axis</CODE> Function </H2>
<!--docid::SEC233::-->
<P>

X axis labels are much like Y axis labels, except that the tics are on a
line above the numbers.  Labels should look like this:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>    |   |    |    |
    1   5   10   15
</pre></td></tr></table></P><P>

The first tic is under the first column of the graph and is preceded by
several blank spaces.  These spaces provide room in rows above for the Y
axis labels.  The second, third, fourth, and subsequent tics are all
spaced equally, according to the value of <CODE>X-axis-label-spacing</CODE>.
</P><P>

The second row of the X axis consists of numbers, preceded by several
blank spaces and also separated according to the value of the variable
<CODE>X-axis-label-spacing</CODE>.
</P><P>

The value of the variable <CODE>X-axis-label-spacing</CODE> should itself be
measured in units of <CODE>symbol-width</CODE>, since you may want to change
the width of the symbols that you are using to print the body of the
graph without changing the ways the graph is labeled.
</P><P>

The <CODE>print-X-axis</CODE> function is constructed in more or less the
same fashion as the <CODE>print-Y-axis</CODE> function except that it has
two lines: the line of tic marks and the numbers.  We will write a
separate function to print each line and then combine them within the
<CODE>print-X-axis</CODE> function.
</P><P>

This is a three step process:
</P><P>

<OL>
<LI>
Write a function to print the X axis tic marks, <CODE>print-X-axis-tic-line</CODE>.
<P>

<LI>
Write a function to print the X numbers, <CODE>print-X-axis-numbered-line</CODE>.
<P>

<LI>
Write a function to print both lines, the <CODE>print-X-axis</CODE> function,
using <CODE>print-X-axis-tic-line</CODE> and
<CODE>print-X-axis-numbered-line</CODE>.
</OL>
<P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="emacs-lisp-intro_22.html#SEC234">C.3.1 X Axis Tic Marks</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Create tic marks for the horizontal axis.</TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="X Axis Tic Marks"></A>
<HR SIZE="6">
<A NAME="SEC234"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC233"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC235"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC228"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC233"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC235"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_23.html#SEC242">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H3> C.3.1 X Axis Tic Marks </H3>
<!--docid::SEC234::-->
<P>

The first function should print the X axis tic marks.  We must specify
the tic marks themselves and their spacing:
 
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defvar X-axis-label-spacing 
  (if (boundp 'graph-blank)
      (* 5 (length graph-blank)) 5)
  "Number of units from one X axis label to next.")
</pre></td></tr></table></P><P>

(Note that the value of <CODE>graph-blank</CODE> is set by another
<CODE>defvar</CODE>.  The <CODE>boundp</CODE> predicate checks whether it has
already been set; <CODE>boundp</CODE> returns <CODE>nil</CODE> if it has not.  If
<CODE>graph-blank</CODE> were unbound and we did not use this conditional
construction, we would receive an error message saying <SAMP>`Symbol's
value as variable is void'</SAMP>.)
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defvar X-axis-tic-symbol "|"
  "String to insert to point to a column in X axis.")
</pre></td></tr></table></P><P>

The goal is to make a line that looks like this:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>       |   |    |    |
</pre></td></tr></table></P><P>

The first tic is indented so that it is under the first column, which is
indented to provide space for the Y axis labels.
</P><P>

A tic element consists of the blank spaces that stretch from one tic to
the next plus a tic symbol.  The number of blanks is determined by the
width of the tic symbol and the <CODE>X-axis-label-spacing</CODE>.
</P><P>

The code looks like this:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>;;; X-axis-tic-element
<small>...</small>
(concat  
 (make-string 
  ;; Make a string of blanks.
  (-  (* symbol-width X-axis-label-spacing)
      (length X-axis-tic-symbol))
  ? )
 ;; Concatenate blanks with tic symbol.
 X-axis-tic-symbol)
<small>...</small>
</pre></td></tr></table></P><P>

Next, we determine how many blanks are needed to indent the first tic
mark to the first column of the graph.  This uses the value of
<CODE>full-Y-label-width</CODE> passed it by the <CODE>print-graph</CODE> function.
</P><P>

The code to make <CODE>X-axis-leading-spaces</CODE>
looks like this:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>;; X-axis-leading-spaces
<small>...</small>
(make-string full-Y-label-width ? )
<small>...</small>
</pre></td></tr></table></P><P>

We also need to determine the length of the horizontal axis, which is
the length of the numbers list, and the number of tics in the horizontal
axis:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>;; X-length 
<small>...</small>
(length numbers-list)              

;; tic-width
<small>...</small>
(* symbol-width X-axis-label-spacing)

;; number-of-X-tics 
(if (zerop (% (X-length tic-width)))
    (/ (X-length tic-width))
  (1+ (/ (X-length tic-width))))
</pre></td></tr></table></P><P>

All this leads us directly to the function for printing the X axis tic line:
</P><P>

<A NAME="IDX123"></A>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun print-X-axis-tic-line
  (number-of-X-tics X-axis-leading-spaces X-axis-tic-element)
  "Print tics for X axis." 
    (insert X-axis-leading-spaces)
    (insert X-axis-tic-symbol)  ; Under first column.
    ;; Insert second tic in the right spot.
    (insert (concat  
             (make-string 
              (-  (* symbol-width X-axis-label-spacing)
                  ;; Insert white space up to second tic symbol.
                  (* 2 (length X-axis-tic-symbol)))
              ? )
             X-axis-tic-symbol))
    ;; Insert remaining tics.
    (while (&#62; number-of-X-tics 1)
      (insert X-axis-tic-element)
      (setq number-of-X-tics (1- number-of-X-tics))))
</pre></td></tr></table></P><P>

The line of numbers is equally straightforward:
</P><P>

First, we create a numbered element with blank spaces before each number:
</P><P>

<A NAME="IDX124"></A>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun X-axis-element (number)
  "Construct a numbered X axis element."
  (let ((leading-spaces 
         (-  (* symbol-width X-axis-label-spacing)
             (length (int-to-string number)))))
    (concat (make-string leading-spaces ? )
            (int-to-string number))))
</pre></td></tr></table></P><P>

Next, we create the function to print the numbered line, starting with
the number "1" under the first column:
</P><P>

<A NAME="IDX125"></A>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun print-X-axis-numbered-line
  (number-of-X-tics X-axis-leading-spaces)
  "Print line of X-axis numbers"
  (let ((number X-axis-label-spacing))
    (insert X-axis-leading-spaces)
    (insert "1")
    (insert (concat  
             (make-string 
              ;; Insert white space up to next number.
              (-  (* symbol-width X-axis-label-spacing) 2)
              ? )
             (int-to-string number)))
    ;; Insert remaining numbers.
    (setq number (+ number X-axis-label-spacing))
    (while (&#62; number-of-X-tics 1)
      (insert (X-axis-element number))
      (setq number (+ number X-axis-label-spacing))
      (setq number-of-X-tics (1- number-of-X-tics)))))
</pre></td></tr></table></P><P>

Finally, we need to write the <CODE>print-X-axis</CODE> that uses 
<CODE>print-X-axis-tic-line</CODE> and
<CODE>print-X-axis-numbered-line</CODE>.
</P><P>

The function must determine the local values of the variables used by both
<CODE>print-X-axis-tic-line</CODE> and <CODE>print-X-axis-numbered-line</CODE>, and
then it must call them.  Also, it must print the carriage return that
separates the two lines.
</P><P>

The function consists of a varlist that specifies five local variables,
and calls to each of the two line printing functions:
</P><P>

<A NAME="IDX126"></A>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun print-X-axis (numbers-list)
  "Print X axis labels to length of NUMBERS-LIST."
  (let* ((leading-spaces 
          (make-string full-Y-label-width ? ))
       ;; symbol-width is provided by graph-body-print
       (tic-width (* symbol-width X-axis-label-spacing))
       (X-length (length numbers-list))
       (X-tic
        (concat  
         (make-string 
          ;; Make a string of blanks.
          (-  (* symbol-width X-axis-label-spacing)
              (length X-axis-tic-symbol))
          ? )
         ;; Concatenate blanks with tic symbol.
         X-axis-tic-symbol))
       (tic-number
        (if (zerop (% X-length tic-width))
            (/ X-length tic-width)
          (1+ (/ X-length tic-width)))))
    (print-X-axis-tic-line tic-number leading-spaces X-tic)
    (insert "\n")
    (print-X-axis-numbered-line tic-number leading-spaces)))
</pre></td></tr></table></P><P>

You can test <CODE>print-X-axis</CODE>:
</P><P>

<OL>
<LI>
Install <CODE>X-axis-tic-symbol</CODE>, <CODE>X-axis-label-spacing</CODE>,
<CODE>print-X-axis-tic-line</CODE>, as well as <CODE>X-axis-element</CODE>,
<CODE>print-X-axis-numbered-line</CODE>, and <CODE>print-X-axis</CODE>.
<P>

<LI>
Copy the following expression:
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(progn
 (let ((full-Y-label-width 5)
       (symbol-width 1))
   (print-X-axis
    '(1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16))))
</pre></td></tr></table></P><P>

<LI>
Switch to the <TT>`*scratch*'</TT> buffer and place the cursor where you
want the axis labels to start.
<P>

<LI>
Type <KBD>M-:</KBD> (<CODE>eval-expression</CODE>).
<P>

<LI>
Yank the test expression into the minibuffer
with <KBD>C-y</KBD> (<CODE>yank)</CODE>.
<P>

<LI>
Press <KBD>RET</KBD> to evaluate the expression.
</OL>
<P>

Emacs will print the horizontal axis like this:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>     |   |    |    |    |
     1   5   10   15   20
</pre></td></tr></table></P><P>

<A NAME="Print Whole Graph"></A>
<HR SIZE="6">
<A NAME="SEC235"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC234"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC236"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC233"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_23.html#SEC242">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> C.4 Printing the Whole Graph </H2>
<!--docid::SEC235::-->
<P>

Now we are nearly ready to print the whole graph.
</P><P>

The function to print the graph with the proper labels follows the
outline we created earlier (@xref{Full Graph, , A Graph with Labelled Axes}), but with additions.
</P><P>

Here is the outline:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun print-graph (numbers-list)
  "<VAR>documentation</VAR><small>...</small>"
  (let ((height  <small>...</small>
        <small>...</small>))
    (print-Y-axis height <small>...</small> )
    (graph-body-print numbers-list)
    (print-X-axis <small>...</small> )))
</pre></td></tr></table></P><P>

The final version is different from what we planned in two ways:
first, it contains additional values calculated once in the varlist;
second, it carries an option to specify the labels' increment per row.
This latter feature turns out to be essential; otherwise a graph may
have more rows than fit on a display or on a sheet of paper.
</P><P>

This new feature requires a change to the <CODE>Y-axis-column</CODE>
function, to add <CODE>vertical-step</CODE> to it.  The function looks like
this:
</P><P>

<A NAME="IDX127"></A>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>;;; Final version.
(defun Y-axis-column
  (height width-of-label &#38;optional vertical-step)
  "Construct list of labels for Y axis.
HEIGHT is maximum height of graph.  
WIDTH-OF-LABEL is maximum width of label.
VERTICAL-STEP, an option, is a positive integer 
that specifies how much a Y axis label increments 
for each line.  For example, a step of 5 means 
that each line is five units of the graph."
  (let (Y-axis
        (number-per-line (or vertical-step 1)))
    (while (&#62; height 1)
      (if (zerop (% height Y-axis-label-spacing))
          ;; Insert label.
          (setq Y-axis
                (cons
                 (Y-axis-element
                  (* height number-per-line)
                  width-of-label)
                 Y-axis))
        ;; Else, insert blanks.
        (setq Y-axis
              (cons
               (make-string width-of-label ? )
               Y-axis)))
      (setq height (1- height)))
    ;; Insert base line.
    (setq Y-axis (cons (Y-axis-element 
                        (or vertical-step 1)
                        width-of-label)
                       Y-axis))
    (nreverse Y-axis)))
</pre></td></tr></table></P><P>

The values for the maximum height of graph and the width of a symbol
are computed by <CODE>print-graph</CODE> in its <CODE>let</CODE> expression; so
<CODE>graph-body-print</CODE> must be changed to accept them.
</P><P>

<A NAME="IDX128"></A>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>;;; Final version.
(defun graph-body-print (numbers-list height symbol-width)
  "Print a bar graph of the NUMBERS-LIST.
The numbers-list consists of the Y-axis values.
HEIGHT is maximum height of graph.
SYMBOL-WIDTH is number of each column."
  (let (from-position)
    (while numbers-list
      (setq from-position (point))
      (insert-rectangle
       (column-of-graph height (car numbers-list)))
      (goto-char from-position)
      (forward-char symbol-width)
      ;; Draw graph column by column.
      (sit-for 0)               
      (setq numbers-list (cdr numbers-list)))
    ;; Place point for X axis labels.
    (forward-line height)
    (insert "\n")))
</pre></td></tr></table></P><P>

Finally, the code for the <CODE>print-graph</CODE> function:
</P><P>

<A NAME="IDX129"></A>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>;;; Final version.
(defun print-graph
  (numbers-list &#38;optional vertical-step)
  "Print labelled bar graph of the NUMBERS-LIST.
The numbers-list consists of the Y-axis values.

Optionally, VERTICAL-STEP, a positive integer,
specifies how much a Y axis label increments for
each line.  For example, a step of 5 means that
each row is five units."
  (let* ((symbol-width (length graph-blank))
         ;; <CODE>height</CODE> is both the largest number
         ;; and the number with the most digits.
         (height (apply 'max numbers-list))
         (height-of-top-line
          (if (zerop (% height Y-axis-label-spacing))
              height
            ;; else
            (* (1+ (/ height Y-axis-label-spacing))
               Y-axis-label-spacing)))
         (vertical-step (or vertical-step 1))
         (full-Y-label-width
          (length
           (concat
            (int-to-string
             (* height-of-top-line vertical-step))
            Y-axis-tic))))

    (print-Y-axis
     height-of-top-line full-Y-label-width vertical-step)
    (graph-body-print
     numbers-list height-of-top-line symbol-width)
    (print-X-axis numbers-list)))
</pre></td></tr></table></P><P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="emacs-lisp-intro_22.html#SEC236">C.4.1 Testing <CODE>print-graph</CODE></A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Run a short test.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="emacs-lisp-intro_22.html#SEC237">C.4.2 Graphing Numbers of Words and Symbols</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Executing the final code.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="emacs-lisp-intro_22.html#SEC241">C.4.3 The Printed Graph</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">The graph itself!</TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Test print-graph"></A>
<HR SIZE="6">
<A NAME="SEC236"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC235"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC237"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC233"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC235"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_23.html#SEC242">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H3> C.4.1 Testing <CODE>print-graph</CODE> </H3>
<!--docid::SEC236::-->
<P>

We can test the <CODE>print-graph</CODE> function with a short list of numbers
</P><P>

<OL>
<LI>
Install the final versions of <CODE>Y-axis-column</CODE>,
<CODE>graph-body-print</CODE>, and <CODE>print-graph</CODE> (in addition to the
rest of the code.)
<P>

<LI>
Copy the following expression:
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(print-graph '(3 2 5 6 7 5 3 4 6 4 3 2 1))
</pre></td></tr></table></P><P>

<LI>
Switch to the <TT>`*scratch*'</TT> buffer and place the cursor where you
want the axis labels to start.
<P>

<LI>
Type <KBD>M-:</KBD> (<CODE>eval-expression</CODE>).
<P>

<LI>
Yank the test expression into the minibuffer
with <KBD>C-y</KBD> (<CODE>yank)</CODE>.
<P>

<LI>
Press <KBD>RET</KBD> to evaluate the expression.
</OL>
<P>

Emacs will print a graph that looks like this:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>10 -              
                  
                  
         *        
        **   *    
 5 -   ****  *    
       **** ***   
     * *********  
     ************ 
 1 - *************

     |   |    |    |
     1   5   10   15
</pre></td></tr></table></P><P>

On the other hand, if you pass <CODE>print-graph</CODE> a
<CODE>vertical-step</CODE> value of 2, by evaluating this expression:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(print-graph '(3 2 5 6 7 5 3 4 6 4 3 2 1) 2)
</pre></td></tr></table></P><P>

The graph looks like this:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>20 -              
                  
                  
         *        
        **   *    
10 -   ****  *    
       **** ***   
     * *********  
     ************ 
 2 - *************

     |   |    |    |
     1   5   10   15
</pre></td></tr></table></P><P>

(A question: is the `2' on the bottom of the vertical axis a bug or a
feature?  If you think it is a bug, and should be a `1' instead, (or
even a `0'), you can modify the sources.)
</P><P>

<A NAME="Graphing words in defuns"></A>
<HR SIZE="6">
<A NAME="SEC237"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC236"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC238"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC233"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC235"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC241"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_23.html#SEC242">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H3> C.4.2 Graphing Numbers of Words and Symbols </H3>
<!--docid::SEC237::-->
<P>

Now for the graph for which all this code was written: a graph that
shows how many function definitions contain fewer than 10 words and
symbols, how many contain between 10 and 19 words and symbols, how
many contain between 20 and 29 words and symbols, and so on.
</P><P>

This is a multi-step process.  First make sure you have loaded all the
requisit code.
</P><P>

It is a good idea to reset the value of <CODE>top-of-ranges</CODE> in case
you have sent it to some different value.  You can evaluate the
following:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(setq top-of-ranges
 '(10  20  30  40  50
   60  70  80  90 100
  110 120 130 140 150
  160 170 180 190 200
  210 220 230 240 250
  260 270 280 290 300)
</pre></td></tr></table></P><P>

Next create a list of the number of words and symbols in each range.
</P><P>

Evaluate the following:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(setq list-for-graph
       (defuns-per-range
         (sort
          (recursive-lengths-list-many-files 
           (directory-files "/usr/local/emacs/lisp"
                            t ".+el$"))
          '&#60;)
         top-of-ranges))
</pre></td></tr></table></P><P>

On my machine, this takes about an hour.  It looks though 303 Lisp
files in my copy of Emacs version 19.23.  After all that computing,
the <CODE>list-for-graph</CODE> has this value:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(537 1027 955 785 594 483 349 292 224 199 166 120 116 99 
90 80 67 48 52 45 41 33 28 26 25 20 12 28 11 13 220)
</pre></td></tr></table></P><P>

This means that my copy of Emacs has 537 function definitions with
fewer than 10 words or symbols in them, 1,027 function definitions
with 10 to 19 words or symbols in them, 955 function definitions with
20 to 29 words or symbols in them, and so on.
</P><P>

Clearly, just by looking at this list we can see that most function
definitions contain ten to thirty words and symbols.
</P><P>

Now for printing.  We do <EM>not</EM> want to print a graph that is
1,030 lines high <small>...</small>  Instead, we should print a graph that is
fewer than twenty-five lines high.  A graph that height can be
displayed on almost any monitor, and easily printed on a sheet of paper.
</P><P>

This means that each value in <CODE>list-for-graph</CODE> must be reduced to
one-fiftieth it present value.
</P><P>

Here is a short function to do just that, using two functions we have
not yet seen, <CODE>mapcar</CODE> and <CODE>lambda</CODE>.
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun one-fiftieth (full-range)
  "Return list, each number one-fiftieth of previous."
 (mapcar '(lambda (arg) (/ arg 50)) full-range))
</pre></td></tr></table></P><P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="emacs-lisp-intro_22.html#SEC238">A <CODE>lambda</CODE> Expression</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How to write an anonymous function.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="emacs-lisp-intro_22.html#SEC239">The <CODE>mapcar</CODE> Function</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Apply a function to elements of a list.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="emacs-lisp-intro_22.html#SEC240">Another Bug <small>...</small> Most Insidious</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Yet another <small>...</small> of a most insidious type.</TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="lambda"></A>
<HR SIZE="6">
<A NAME="SEC238"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC237"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC239"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC236"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC237"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC241"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_23.html#SEC242">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H4> A <CODE>lambda</CODE> Expression </H4>
<!--docid::SEC238::-->
<P>

<CODE>lambda</CODE> is the symbol for an anonymous function, a function
without a name.  Every time you use an anonymous function, you need to
include its whole body.
</P><P>

Thus,
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(lambda (arg) (/ arg 50))
</pre></td></tr></table></P><P>

is a function definition that says `return the value resulting from
dividing whatever is passed to me as <CODE>arg</CODE> by 50'.
</P><P>

Earlier, for example, we had a function <CODE>multiply-by-seven</CODE>; it
multiplied its argument by 7.  This function is similar, except it
divides its argument by 50; and, it has no name.  The anonymous
equivalent of <CODE>multiply-by-seven</CODE> is:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(lambda (number) (* 7 number))
</pre></td></tr></table></P><P>

(See section <A HREF="emacs-lisp-intro_4.html#SEC42">The <CODE>defun</CODE> Special Form</A>.)
</P><P>

If we want to multiply 3 by 7, we can write:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(multiply-by-seven 3)
 \_______________/ ^
         |         |
      function  argument
</pre></td></tr></table></P><P>

This expression returns 21.
</P><P>

Similarly, we can write:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>((lambda (number) (* 7 number)) 3)
 \____________________________/ ^
               |                |
      anonymous function     argument
</pre></td></tr></table></P><P>

If we want to divide 100 by 50, we can write:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>((lambda (arg) (/ arg 50)) 100)
 \______________________/  \_/
             |              |
    anonymous function   argument
</pre></td></tr></table></P><P>

This expression returns 2.  The 100 is passed to the function, which
divides that number by 50.
</P><P>

See section `Lambda Expressions' in <CITE>The GNU Emacs Lisp Reference Manual</CITE>, for more about <CODE>lambda</CODE>.  Lisp and lambda
expressions derive from the Lambda Calculus.
</P><P>

<A NAME="mapcar"></A>
<HR SIZE="6">
<A NAME="SEC239"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC238"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC240"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC236"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC237"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC241"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_23.html#SEC242">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H4> The <CODE>mapcar</CODE> Function </H4>
<!--docid::SEC239::-->
<P>

<CODE>mapcar</CODE> is a function that calls its first argument with each
element of its second argument, in turn.  The second argument must be
a sequence.
</P><P>

For example, 
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(mapcar '1+ '(2 4 6))
     => (3 5 7)
</pre></td></tr></table></P><P>

The function <CODE>1+</CODE> which adds one to its argument, is executed on
<EM>each</EM> element of the list, and a new list is returned.
</P><P>

Contrast this with <CODE>apply</CODE>, which applies its first argument to
all the remaining. 
(See section <A HREF="emacs-lisp-intro_16.html#SEC184">Изготовляем график</A>, for a explanation of
<CODE>apply</CODE>.)
</P><P>

In the definition of <CODE>one-fiftieth</CODE>, the first argument is the
anonymous function:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(lambda (arg) (/ arg 50))
</pre></td></tr></table></P><P>

and the second argument is <CODE>full-range</CODE>, which will be bound to
<CODE>list-for-graph</CODE>.
</P><P>

The whole expression looks like this:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(mapcar '(lambda (arg) (/ arg 50)) full-range))
</pre></td></tr></table></P><P>

See section `Mapping Functions' in <CITE>The GNU Emacs Lisp Reference Manual</CITE>, for more about <CODE>mapcar</CODE>.
</P><P>

Using the <CODE>one-fiftieth</CODE> function, we can generate a list in
which each element is one-fiftieth the size of the corresponding
element in <CODE>list-for-graph</CODE>.
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(setq fiftieth-list-for-graph
      (one-fiftieth list-for-graph))
</pre></td></tr></table></P><P>

The resulting list looks like this:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(10 20 19 15 11 9 6 5 4 3 3 2 2 
1 1 1 1 0 1 0 0 0 0 0 0 0 0 0 0 0 4)
</pre></td></tr></table></P><P>

This we are almost ready to print!  (We also notice the loss of
information: many of the higher ranges are 0, meaning that fewer than
50 defuns had that many words or symbols --- but not necessarily meaning
that none had that many words or symbols.)
</P><P>

<A NAME="Another Bug"></A>
<HR SIZE="6">
<A NAME="SEC240"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC239"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC241"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC236"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC237"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC241"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_23.html#SEC242">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H4> Another Bug <small>...</small> Most Insidious </H4>
<!--docid::SEC240::-->
<P>

I said `almost ready to print'!  Of course, there is a bug in the
<CODE>print-graph</CODE> function <small>...</small>  It has a <CODE>vertical-step</CODE>
option, but not a <CODE>horizontal-step</CODE> option.  The
<CODE>top-of-range</CODE> scale goes from 10 to 300 by tens.  But the
<CODE>print-graph</CODE> function will print only by ones.  
</P><P>

This is a classic example of what some consider the most insidious
type of bug, the bug of omission.  This is not the kind of bug you can
find by studying the code, for it is not in the code; it is an omitted
feature.  Your best actions are to try your program early and often;
and try to arrange, as much as you can, to write code that is easy to
understand and easy to change.  Try to be aware, whenever you can,
that whatever you have written, <EM>will</EM> be rewritten, if not soon,
eventually.  A hard maxim to follow.
</P><P>

It is the <CODE>print-X-axis-numbered-line</CODE> function that needs the
work; and then the <CODE>print-X-axis</CODE> and the <CODE>print-graph</CODE>
functions need to be adapted.  Not much needs to be done; there is one
nicety: the numbers ought to line up under the tic marks.  This takes
a little thought.
</P><P>

Here is the corrected <CODE>print-X-axis-numbered-line</CODE>:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun print-X-axis-numbered-line
  (number-of-X-tics X-axis-leading-spaces
   &#38;optional horizontal-step)
  "Print line of X-axis numbers"
  (let ((number X-axis-label-spacing)
        (horizontal-step (or horizontal-step 1)))
    (insert X-axis-leading-spaces)
    ;; Delete extra leading spaces.
    (delete-char
     (- (1-
         (length (int-to-string horizontal-step)))))
    (insert (concat  
             (make-string 
              ;; Insert white space.
              (-  (* symbol-width
                     X-axis-label-spacing) 
                  (1-
                   (length
                    (int-to-string horizontal-step)))
                  2)
              ? )
             (int-to-string
              (* number horizontal-step))))
    ;; Insert remaining numbers.
    (setq number (+ number X-axis-label-spacing))
    (while (&#62; number-of-X-tics 1)
      (insert (X-axis-element
               (* number horizontal-step)))
      (setq number (+ number X-axis-label-spacing))
      (setq number-of-X-tics (1- number-of-X-tics)))))
</pre></td></tr></table></P><P>

If you are reading this in Info, you can see the new versions of
<CODE>print-X-axis</CODE> <CODE>print-graph</CODE> and evaluate them.  If you are
reading this in a printed book, you can see the changed lines here
(the full text is too much to print).
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun print-X-axis (numbers-list horizontal-step)
  "Print X axis labels to length of NUMBERS-LIST.
Optionally, HORIZONTAL-STEP, a positive integer,
specifies how much an X  axis label increments for
each column."
;; Value of symbol-width and full-Y-label-width 
;; are passed by `print-graph'.
  (let* ((leading-spaces 
          (make-string full-Y-label-width ? ))
       ;; symbol-width is provided by graph-body-print
       (tic-width (* symbol-width X-axis-label-spacing))
       (X-length (length numbers-list))
       (X-tic
        (concat  
         (make-string 
          ;; Make a string of blanks.
          (-  (* symbol-width X-axis-label-spacing)
              (length X-axis-tic-symbol))
          ? )
         ;; Concatenate blanks with tic symbol.
         X-axis-tic-symbol))
       (tic-number
        (if (zerop (% X-length tic-width))
            (/ X-length tic-width)
          (1+ (/ X-length tic-width)))))

    (print-X-axis-tic-line
     tic-number leading-spaces X-tic)
    (insert "\n")
    (print-X-axis-numbered-line
     tic-number leading-spaces horizontal-step)))
</pre></td></tr></table></P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun print-graph
  (numbers-list &#38;optional vertical-step horizontal-step)
  "Print labelled bar graph of the NUMBERS-LIST.
The numbers-list consists of the Y-axis values.

Optionally, VERTICAL-STEP, a positive integer,
specifies how much a Y axis label increments for
each line.  For example, a step of 5 means that
each row is five units.

Optionally, HORIZONTAL-STEP, a positive integer,
specifies how much an X  axis label increments for
each column."
  (let* ((symbol-width (length graph-blank))
         ;; <CODE>height</CODE> is both the largest number
         ;; and the number with the most digits.
         (height (apply 'max numbers-list))
         (height-of-top-line
          (if (zerop (% height Y-axis-label-spacing))
              height
            ;; else
            (* (1+ (/ height Y-axis-label-spacing))
               Y-axis-label-spacing)))
         (vertical-step (or vertical-step 1))
         (full-Y-label-width
          (length
           (concat
            (int-to-string
             (* height-of-top-line vertical-step))
            Y-axis-tic))))
    (print-Y-axis
     height-of-top-line full-Y-label-width vertical-step)
    (graph-body-print
        numbers-list height-of-top-line symbol-width)
    (print-X-axis numbers-list horizontal-step)))
</pre></td></tr></table></P><P>

<A NAME="Final Printed Graph"></A>
<HR SIZE="6">
<A NAME="SEC241"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC240"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_23.html#SEC242"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC237"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC235"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_23.html#SEC242">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H3> C.4.3 The Printed Graph </H3>
<!--docid::SEC241::-->
<P>

When made and installed, you can call the <CODE>print-graph</CODE> command
like this:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(print-graph fiftieth-list-for-graph 50 10)
</pre></td></tr></table></P><P>

Here is the graph:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>1000 -  *                             
        **                            
        **                            
        **                            
        **                            
 750 -  ***                           
        ***                           
        ***                           
        ***                           
        ****                          
 500 - *****                          
       ******                         
       ******                         
       ******                         
       *******                        
 250 - ********                       
       *********                     *
       ***********                   *
       *************                 *
  50 - ***************** *           *
       |   |    |    |    |    |    |    |
      10  50  100  150  200  250  300  350
</pre></td></tr></table></P><P>

The largest group of functions contain 10 --- 19 words and symbols each.
</P><P>

<A NAME="Index"></A>
<HR SIZE="6">
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_22.html#SEC237"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_23.html#SEC242">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="emacs-lisp-intro_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<BR>  
<FONT SIZE="-1">
This document was generated
on <I>December, 4  2003</I>
using <A HREF="http://www.mathematik.uni-kl.de/~obachman/Texi2html
"><I>texi2html</I></A>

<script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">_uacct = "UA-78697-3"; urchinTracker(); </script></body>
</HTML>
