<HTML>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- Created on March, 10  2004 by texi2html 1.64 -->
<!-- 
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Olaf Bachmann <obachman@mathematik.uni-kl.de>
Send bugs and suggestions to <texi2html@mathematik.uni-kl.de>
 
-->
<HEAD>
<TITLE>Программирование на Emacs Lisp: Полный график</TITLE>

<META NAME="description" CONTENT="Программирование на Emacs Lisp: Полный график">
<META NAME="keywords" CONTENT="Программирование на Emacs Lisp: Полный график">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META NAME="Generator" CONTENT="texi2html 1.64">

</HEAD>

<BODY LANG="" BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">

<A NAME="SEC226"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_22.html#SEC225"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC228"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_22.html#SEC215"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_24.html#SEC243"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_24.html#SEC243">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1> C. График с координатными осями </H1>
<!--docid::SEC226::-->
<P>

Координатные оси помогают воспринимать график, ведь обычно на них
наносится масштаб.  В предыдущих главах мы создали функции для печати
тела графика, сейчас мы напишем функции для создания вертикальной и
горизонтальной оси вместе с самим графиком.
</P><P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp-intro-ru_23.html#SEC227">Пример графика с координатными осями</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp-intro-ru_23.html#SEC228">C.1 Список переменных <CODE>print-graph</CODE></A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp-intro-ru_23.html#SEC229">C.2 Функция <CODE>print-Y-axis</CODE></A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Градуируем вертикальную ось.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp-intro-ru_23.html#SEC234">C.3 Функция <CODE>print-X-axis</CODE></A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Печатаем горизонтальную ось.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp-intro-ru_23.html#SEC236">C.4 Печать полного графика</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Пример графика с коор. осями"></A>
<A NAME="SEC227"></A>
<H2> Пример графика с координатными осями </H2>
<!--docid::SEC227::-->
<P>

Так как вставляемые символы заполняют буфер вправо и вниз наша новая
функция должна вначале печатать вертикальную ось (ось Y), затем тело
графика и наконец горизонтальную ось (ось X).  Работу будущей функции
можно представить следующим образом:
</P><P>

<OL>
<LI>
Инициализация необходимых переменных.
<P>

<LI>
Печать оси Y.
<P>

<LI>
Печать графика.
<P>

<LI>
Печать оси X.
</OL>
<P>

Вот как будет выглядеть наш график:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>    10 -          
                  *
                  *  *
                  *  **
                  *  ***
     5 -      *   *******
            * *** *******
            *************
          ***************
     1 - ****************
         |   |    |    |
         1   5   10   15
</pre></td></tr></table></P><P>

На этом графике координатные оси пронумерованы числами, однако иногда по
горизонтальной оси откладывается время и тогда лучше градуировать
единицами времени, например, месяцами, как в следующем графике:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>     5 -      * 
            * ** *
            *******
          ********** **
     1 - **************
         |    ^      |
         Jan  June   Jan
</pre></td></tr></table></P><P>

На самом деле, если мы проявим немного фантазии, то сможем придумать
множество возможных способов градуировки координатных осей, но это
только усложнит задачу.  Вместо этого лучше вначале, для первой попытки
выбрать простую схему, а впоследствии ее можно заменить или
модифицировать.
</P><P>

Все эти рассуждения приводят нас к следующему шаблону для будущей
функции <CODE>print-graph</CODE>:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun print-graph (numbers-list)
  "<VAR>документация</VAR><small>...</small>"
  (let ((height  <small>...</small>
        <small>...</small>))
    (print-Y-axis height <small>...</small> )
    (graph-body-print numbers-list)
    (print-X-axis <small>...</small> )))
</pre></td></tr></table></P><P>

Теперь можно по очереди реализовывать каждую часть определения функции
<CODE>print-graph</CODE>.
</P><P>

<A NAME="Список переменных print-graph"></A>
<HR SIZE="6">
<A NAME="SEC228"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC226"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC229"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC227"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC226"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_24.html#SEC243"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_24.html#SEC243">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> C.1 Список переменных <CODE>print-graph</CODE> </H2>
<!--docid::SEC228::-->
<P>

При создании функции <CODE>print-graph</CODE> первая задача придумать список
локальных переменных для выражения <CODE>let</CODE>.  (Пока мы не будем
задумываться о документировании функции и о том будет ли она
интерактивной или нет.)
</P><P>

Нам понадобится несколько локальных переменных.  Ясно, что верхняя метка
для вертикальной оси должна быть по крайней мере равна высоте графика,
значит нам нужна переменная, которая будет содержать эту величину.
Отметим, что функции <CODE>print-graph-body</CODE> так же требуется знать
высоту графика.  Нет никаких оснований вычислять ее в двух разных
местах, лучше немного изменить предыдущую версию <CODE>print-graph-body</CODE>
для того чтобы воспользоваться появившимися преимуществами.
</P><P>

Аналогично и функции для печати оси X и функции <CODE>print-graph-body</CODE>
необходимо знать ширину каждого символа, поэтому лучше произвести
вычисление ширины символа при создании списка аргументов и так же
немного изменить предыдущее определение <CODE>print-graph-body</CODE>.
</P><P>

Последняя метка откладываемая по горизонтали должна быть по крайней мере
такой же длины как и график, однако эта информация используется только в
функции для печати горизонтальной оси, поэтому мы можем не вычислять ее
в списке переменных выражения <CODE>let</CODE>.
</P><P>

Все это приводит нас к следующей форме списка переменных выражения
<CODE>let</CODE> для функции <CODE>print-graph</CODE>:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(let ((height (apply 'max numbers-list)) ; First version.
      (symbol-width (length graph-blank)))
</pre></td></tr></table></P><P>

В последствии мы увидим, что это выражение не совсем правильно.
</P><P>

<A NAME="print-Y-axis"></A>
<HR SIZE="6">
<A NAME="SEC229"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC228"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC230"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC226"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC226"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC234"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_24.html#SEC243">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> C.2 Функция <CODE>print-Y-axis</CODE> </H2>
<!--docid::SEC229::-->
<P>

Задача функции <CODE>print-Y-axis</CODE> пронумеровать вертикальную ось, что
будет выглядеть примерно следующим образом:
              
<TABLE><tr><td>&nbsp;</td><td class=example><pre>    10 -
        
        
        
        
     5 -
        
        
        
     1 -
</pre></td></tr></table></P><P>

В эту функцию надо передать высоту графика, для того чтобы она должным
образом напечатала соответствующие номера и метки.
</P><P>

Впрочем легко сказать и даже нарисовать, как должна выглядеть ось Y; но
создать функцию это совсем другое дело.  Будет не совсем правильно, если
мы скажем, что нам нужен номер и метка каждые пять строк: ведь между
<SAMP>`1'</SAMP> и <SAMP>`5'</SAMP> только три строки (строки 2, 3 и 4), а между
<SAMP>`5'</SAMP> и <CODE>10</CODE> уже четыре строки (строки 6, 7, 8, 9).  Лучше
скажем, что нам нужна метка и номер в начале оси и потом метка с номером
каждые следующие пять строк.
</P><P>

Теперь, надо обдумать чему будет равна последняя метка.  Предположим,
что максимальная высота колонки графика равна 7.  Какой должна быть
верхняя отметка по оси Y --- <SAMP>`5 -'</SAMP>, но тогда график будет выше
отметки?  Или верхняя метка должна быть равна <SAMP>`7 -'</SAMP>, чтобы мы знали
чему равна вершина графика?  А может быть верхняя метка должна быть
равна <CODE>10 -</CODE>, ведь 10 делится на пять, но тогда верхняя метка будет
расположена выше чем пик графика?
 
Лучше всего реализовать последний случай.  В большинстве случаев
координатные оси пронумерованы дискретно с шагом 5 --- 5, 10, 15, и
так далее.  Но как только мы решаем использовать дискретный шаг для
вертикальной оси, мы обнаруживаем, что простое выражение для списка
переменных вычисляющее высоту неправильно.  Выражение <CODE>(apply 'max
numbers-list)</CODE>, вернет максимальную высоту столбца, а нам необходимо
значение округленное к ближайшему большему числу кратному пяти.  Значит
необходимо придумать более сложное выражение.
</P><P>

Как обычно сложная задача станет проще, если ее разделить на несколько
простых задач.
</P><P>

Во первых может получится, что высота графика это число кратное пяти,
например --- 5, 10, 15 или какое-нибудь большее число.  В этом
случая мы можем прямо использовать это значение как высоту оси Y.
</P><P>

Самый простой способ определить кратность числа пяти это разделить число
на пять и проанализировать остаток.  Если остаток равен 0, значит число
кратно пяти.  Например семь при делении на пять дает в остатке 2, значит
семь не кратно пяти.  Можно сказать совсем просто, как обьясняют в
школе, пять входит в семь один раз с остатком два.  Однако пять входит в
десять дважды без остатка: значит десять кратно пяти.
</P><P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp-intro-ru_23.html#SEC230">C.2.1 Обходной путь: Вычисление остатка</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp-intro-ru_23.html#SEC231">C.2.2 Создание элементов оси Y</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp-intro-ru_23.html#SEC232">C.2.3 Создание колонки оси Y</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp-intro-ru_23.html#SEC233">C.2.4 Окончательная версия <CODE>print-Y-axis</CODE></A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Печать веритикальной оси.</TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Обход. вычисление остатка"></A>
<HR SIZE="6">
<A NAME="SEC230"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC229"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC231"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC228"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC229"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC234"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_24.html#SEC243">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H3> C.2.1 Обходной путь: Вычисление остатка </H3>
<!--docid::SEC230::-->
<P>

<A NAME="IDX115"></A>
<A NAME="IDX116"></A>
В Лиспе есть функция для вычисления остатка это <CODE>%</CODE>.  Эта функция
возвращает остаток от деления первого аргумента на второй.  Так
случилось, что <CODE>%</CODE> функция Emacs Lisp, которую вы не сможете
обнаружить с помощью <CODE>apropos</CODE>: поиск <KBD>M-x apropos <KBD>RET</KBD>
remainder <KBD>RET</KBD></KBD> ничего не выдаст.  Единственный способ узнать о
существовании <CODE>%</CODE> прочесть об этом в каком-нибудь учебнике или
изучив исходные тексты Emacs Lisp.  Функция <CODE>%</CODE> используется в
определении функции <CODE>rotate-yank-pointer</CODE>, об этом можно прочесть в
приложении (See section <A HREF="elisp-intro-ru_22.html#SEC217">Тело функции <CODE>rotate-yank-pointer</CODE></A>.)
</P><P>

Вы можете понять работу функцию <CODE>%</CODE>, вычислив следующие два
выражения:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(% 7 5)

(% 10 5)
</pre></td></tr></table></P><P>

Первое выражение вернет 2, а второе выражение вернет 0.
</P><P>

Для проверки того, равно ли значение, возвращаемое функцией <CODE>%</CODE>
нулю можно использовать функцию <CODE>zerop</CODE>.  Эта функция вернет
<CODE>t</CODE>, если ее аргумент, который должен быть числом, ноль.
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(zerop (% 7 5))
     => nil

(zerop (% 10 5))
     => t
</pre></td></tr></table></P><P>

Таким образом следующее выражение вернет <CODE>t</CODE>, если высота графика
кратна пяти:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(zerop (% height 5))
</pre></td></tr></table></P><P>

(Значение <CODE>height</CODE>, мы найдем с помощью выражения <CODE>(apply 'max
numbers-list)</CODE>.)
</P><P>

С другой стороны, если значение <CODE>height</CODE> не кратно пяти, мы должны
установить его в большее значение, которое кратно пяти.  Это достаточно
простое арифметическое действие, которое вполне можно выполнить уже
знакомыми нам функциями.  Сначала мы разделим значение <CODE>height</CODE> на
пять для того чтобы определить сколько раз пять входит в это число.
Например пять два раза входит в двенадцать, если мы добавим к частному
единицу и умножим его на пять, то мы получим большее число кратное пяти.
Пять два раза входит в двенадцать, добавив к двум один и умножив на пять
мы получим пятнадцать, число кратное пяти и большее чем двенадцать.
Соответствующее Лисп выражение приведено ниже:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(* (1+ (/ height 5)) 5)
</pre></td></tr></table></P><P>

После вычисления следующего выражения вы получите 15:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(* (1+ (/ 12 5)) 5)
</pre></td></tr></table></P><P>

Во время наших рассуждений мы использовали `пять', как значение
дискретного шага по оси Y; но мы вполне можем выбрать и какое-нибудь
другое значение, лучше всего, если мы заменим `пять' переменной, которой
мы сможем присвоить значение.  Самое лучшее имя, которое я смог
придумать это <CODE>Y-axis-label-spacing</CODE>.  Используя новоизобретенную
переменную и выражение <CODE>if</CODE>, получаем следующее выражение:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(if (zerop (% height Y-axis-label-spacing))
    height
  ;; else
  (* (1+ (/ height Y-axis-label-spacing))
     Y-axis-label-spacing))
</pre></td></tr></table></P><P>

Это выражение возвращает значение <CODE>height</CODE>, если высота кратна
значению <CODE>Y-axis-label-spacing</CODE> или вычисляет и присваивает
переменной <CODE>height</CODE> следующее большее число, кратное
<CODE>Y-axis-label-spacing</CODE>.
</P><P>

Мы можем теперь включить это выражение в список переменных формы
<CODE>let</CODE> для функции <CODE>print-graph</CODE> (конечно после того, как
присвоим значение переменной <CODE>Y-axis-label-spacing</CODE>):
<A NAME="IDX117"></A>
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defvar Y-axis-label-spacing 5
  "Масштаб по вертикальной оси.")

<small>...</small>
(let* ((height (apply 'max numbers-list))
       (height-of-top-line
        (if (zerop (% height Y-axis-label-spacing))
            height
          ;; else
          (* (1+ (/ height Y-axis-label-spacing))
             Y-axis-label-spacing)))
       (symbol-width (length graph-blank))))
<small>...</small>
</pre></td></tr></table></P><P>

(Стоит отметить, что здесь мы используем функцию <CODE>let*</CODE>: ведь
вначале вычисляется значение height с помощью <CODE>(apply 'max
numbers-list)</CODE> и после этого получившееся значение используется для
вычисления окончательного результата.  See section <A HREF="elisp-intro-ru_14.html#SEC155">The <CODE>let*</CODE> expression</A>, за дополнительной информацией о <CODE>let*</CODE>.)
</P><P>

<A NAME="Элемент оси Y"></A>
<HR SIZE="6">
<A NAME="SEC231"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC230"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC232"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC228"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC229"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC234"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_24.html#SEC243">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H3> C.2.2 Создание элементов оси Y </H3>
<!--docid::SEC231::-->
<P>

Когда мы печатаем вертикальные оси, мы вставляем метки, такие как
<SAMP>`5 -'</SAMP> и <SAMP>`10 - '</SAMP> каждые пять строк.  Кроме того
хотелось бы, чтобы вертикальные метки находились на одной линии, так что
более короткие номера придется выравнивать ведущими пробелами.  Если
некоторая метка это число, состоящее из двух цифр, тогда метка с числом,
состоящим из одной цифры должна быть выровнена с помощью дополнительного
пробела, расположенного перед числом.
</P><P>

<A NAME="IDX118"></A>
Для того чтобы найти количество цифр, входящих в число можно
использовать функцию <CODE>length</CODE>.  Но так как функция <CODE>length</CODE>
работает только со строками, а не с числами, число необходимо
предварительно превратить в строку.  Это можно сделать с помощью функции
<CODE>int-to-string</CODE>.  Например,
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(length (int-to-string 35))
     => 2

(length (int-to-string 100))
     => 3
</pre></td></tr></table></P><P>

Кроме этого в каждой метке за числом следует строка <SAMP>` - '</SAMP>,
которую мы будем называть маркером и назовем ее <CODE>Y-axis-tic</CODE>.
Давайте зададим эту переменную с помощью <CODE>defvar</CODE>:
</P><P>

<A NAME="IDX119"></A>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defvar Y-axis-tic " - "
   "Строка следующая за числом по оси Y.")
</pre></td></tr></table></P><P>

Длина метки по оси Y это сумма длин <CODE>Y-axis-tic</CODE> и длины
наибольшего числа отложенного по оси Y.
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(length (concat (int-to-string height) Y-axis-tic))
</pre></td></tr></table></P><P>

Это значение будет вычисляться в списке локальных переменных функции
<CODE>print-graph</CODE> и присваиваться переменной <CODE>full-Y-label-width</CODE>.
(Стоит отметить, что вначале мы и не думали что появится эта
переменная.)
</P><P>

Для того чтобы полностью напечатать метку по вертикальной оси, строку
<CODE>Y-axis-tic</CODE> надо обьединить с номером; а перед ними может
потребоваться вставить один или два пробела, в зависимости от того,
какой длины текущее число.  Таким образом координатная метка будет
состоять из трех частей: (необязательные) ведущие пробелы, число и
строка <CODE>Y-axis-tic</CODE> (в нашем случае это символ тире).  В функцию,
создающую координатную метку по оси Y передается число для текущей
строки и значение ширины верхней метки, (ведь она получится самой
широкой), которое вычисляется при создании локальных переменных в
функции <CODE>print-graph</CODE>.
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun Y-axis-element (number full-Y-label-width) 
  "Создает N-тую координатную метку по оси Y.
Координатная метка выглядит следующим образом `  5 - ',
для того, чтобы все метки были на одной линии
некоторые необходимо дополнить пробелами."
  (let* ((leading-spaces 
         (- full-Y-label-width
            (length
             (concat (int-to-string number)
                     Y-axis-tic)))))
    (concat
     (make-string leading-spaces ? )
     (int-to-string number)
     Y-axis-tic)))
</pre></td></tr></table></P><P>

В функции <CODE>Y-axis-element</CODE> обьединяются вместе пробелы, которые
могут и отсутствовать; число, предварительно превращенное в строку; и
строка <CODE>Y-axis-tic</CODE> в нашем случае это знак тире.
</P><P>

Для того чтобы вычислить, сколько потребуется дополнительных пробелов в
функции производится вычитание текущей длины метки, то есть длины числа
плюс длины символа <CODE>Y-axis-tic</CODE> из максимально допустимой ширины
метки.
</P><P>

<A NAME="IDX120"></A>
Пробелы вставляются с помощью функции <CODE>make-string</CODE>.  Этой функции
требуются два аргумента: первый задает, какой длины должна быть строка,
а второй--- это символ, который нужно вставить, заданный в особом
формате.  В нашем случае формат это знак вопроса за которым следует
пробел, например <SAMP>`? '</SAMP>.  See section `Character Type' in <CITE>The GNU Emacs Lisp Reference Manual</CITE>, за подробным описанием
синтаксиса для символов.
</P><P>

Функция <CODE>int-to-string</CODE> используется в выражении <CODE>concat</CODE> при
создании результирующей строки, для того, чтобы конвертировать число в
строку, которая будет слита с пробелами и знаком тире.
</P><P>

<A NAME="Y-axis-column"></A>
<HR SIZE="6">
<A NAME="SEC232"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC231"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC233"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC228"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC229"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC234"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_24.html#SEC243">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H3> C.2.3 Создание колонки оси Y </H3>
<!--docid::SEC232::-->
<P>

Теперь мы полностью готовы к созданию функции, которая выдаст нам список
пронумерованных и пустых меток, который будет представлять собой
вертикальную координатную ось:
</P><P>

<A NAME="IDX121"></A>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun Y-axis-column (height width-of-label)
  "Создать список пронумерованых и пустых меток для оси of Y.
Высота оси равна HEIGHT, ширина метки равна WIDTH-OF-LABEL."
  (let (Y-axis)
    (while (&#62; height 1)
      (if (zerop (% height Y-axis-label-spacing))
          ;; Вставляем числовую метку.
          (setq Y-axis
                (cons
                 (Y-axis-element height width-of-label)
                 Y-axis))
        ;; Иначе, вставляем пробелы.
        (setq Y-axis
              (cons
               (make-string width-of-label ? )
               Y-axis)))
      (setq height (1- height)))
    ;; Вставляем базовую метку для 1.
    (setq Y-axis
          (cons (Y-axis-element 1 width-of-label) Y-axis))
    (nreverse Y-axis)))
</pre></td></tr></table></P><P>

В этой функции в конце каждой итерации цикла <CODE>while</CODE> из начального
значения <CODE>height</CODE> последовательно вычитается единица.  Перед каждым
вычитанием проверяется, является ли значение <CODE>height</CODE> кратным
<CODE>Y-axis-label-spacing</CODE>, если да, то с помощью функции
<CODE>Y-axis-element</CODE> создается нумерованная метка; если же текущее
значение <CODE>height</CODE> не кратно <CODE>Y-axis-label-spacing</CODE>, то с
помощью функции <CODE>make-string</CODE> создается пустая метка.
</P><P>

В конце функции создается начальная метка для вертикальной оси, ранее мы
условились что она будет пронумерована единицей.
</P><P>

<A NAME="Окончательная версия print-Y-axis"></A>
<HR SIZE="6">
<A NAME="SEC233"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC232"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC234"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC228"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC229"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC234"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_24.html#SEC243">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H3> C.2.4 Окончательная версия <CODE>print-Y-axis</CODE> </H3>
<!--docid::SEC233::-->
<P>

Список созданный <CODE>Y-axis-column</CODE> передается в функцию
<CODE>print-Y-axis</CODE>, которая и напечатает его с помощью
<CODE>insert-rectangle</CODE>.
</P><P>

<A NAME="IDX122"></A>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun print-Y-axis (height full-Y-label-width )
  "Вставляет ось Y заданой высоты HEIGHT, ширина метки FULL-Y-LABEL-WIDTH.
HEIGHT должна быть максимальной высотой графика.  FULL-Y-LABEL-WIDTH
ширина самой верхней метки."
;; Значения height  full-Y-label-width 
;; вычисляются в функции `print-graph'.
  (let ((start (point)))
    (insert-rectangle
     (Y-axis-column height full-Y-label-width))
    ;; Переместить точку назад, где будет вставлен график.
    (goto-char start)      
    ;; Переместить точку вперед на максимальную ширину метки
    (forward-char full-Y-label-width)))
</pre></td></tr></table></P><P>

Функция <CODE>print-Y-axis</CODE> использует <CODE>insert-rectangle</CODE> для
вставки оси Y, которая создана с помощью функции <CODE>Y-axis-column</CODE>.
Кроме этого, она устанавливает точку в ту позицию откуда мы начнем
печатать график.
</P><P>

Давайте проверим работу <CODE>print-Y-axis</CODE>:
</P><P>

<OL>
<LI>
Установите
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>Y-axis-label-spacing
Y-axis-tic
Y-axis-element
print-Y-axis
</pre></td></tr></table></P><P>

<LI>
Скопируйте следующее выражение:
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(print-Y-axis 12 5)
</pre></td></tr></table></P><P>

<LI>
Переключитесь в буфер <TT>`*scratch*'</TT> и поместите курсор в точку, где
вы хотите вставить вертикальную ось.
<P>

<LI>
Наберите <KBD>M-:</KBD> (<CODE>eval-expression</CODE>).  Вставьте в минибуфер
выражение <CODE>(print-Y-axis 12 5)</CODE>
<P>

<LI>
Нажмите <KBD>RET</KBD> для вычисления выражения.
</OL>
<P>

В буфере <TT>`*scratch*'</TT> будет напечатана следующая ось Y:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>10 - 
     
     
     
     
 5 - 
     
     
     
 1 - 
</pre></td></tr></table></P><P>

Emacs напечатал метки вертикально, верхняя метка равна <SAMP>`10
-'</SAMP>.  (Функция <CODE>print-graph</CODE> передаст более правильное
значение, как вершину графика <CODE>height-of-top-line</CODE>, которое в этом
случае должно быть равно 15.)
</P><P>

<A NAME="print-X-axis"></A>
<HR SIZE="6">
<A NAME="SEC234"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC233"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC235"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC229"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC226"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC236"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_24.html#SEC243">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> C.3 Функция <CODE>print-X-axis</CODE> </H2>
<!--docid::SEC234::-->
<P>

Метки по оси X похожы на метки по оси Y, кроме того что маркеры
распологаются над номерами.  Метки должны выглядеть следующим образом:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>    |   |    |    |
    1   5   10   15
</pre></td></tr></table></P><P>

Первый маркер под первым столбцом графика, перед ним несколько пробелов,
это резервирует пространство для оси Y.  Второй, третий, четвертый и
последующие маркеры все расположены на одинаковом расстоянии друг от
друга, согласно значению <CODE>X-axis-label-spacing</CODE>.
</P><P>

Вторая строка оси X состоит из номеров, которые также разделены согласно
значению переменной <CODE>X-axis-label-spacing</CODE>.
</P><P>

Значение переменной <CODE>X-axis-label-spacing</CODE> надо задавать кратным
значению переменной <CODE>symbol-width</CODE>, ведь вполне возможно что вы
захотите изменить ширину символа, который мы используем для создания
тела графика и тогда ось X автоматически воспримет это изменение.
</P><P>

Функция <CODE>print-X-axis</CODE> будет очень похожа на функцию
<CODE>print-Y-axis</CODE>, разве что она будет печатать две строки: строку
маркеров и строку номеров.  Мы создадим две разные функции для печати
каждой строки и затем обьединим их в общей функции <CODE>print-X-axis</CODE>.
</P><P>

Получается трехшаговый процесс:
</P><P>

<OL>
<LI>
Создать функцию для печати маркеров по оси X
<CODE>print-X-axis-tic-line</CODE>.
<P>

<LI>
Создать функцию для печати номеров по оси X
<CODE>print-X-axis-numbered-line</CODE>.
<P>

<LI>
Создать основную функцию для печати двух строк, функцию
<CODE>print-X-axis</CODE>, которая будет использовать и
<CODE>print-X-axis-tic-line</CODE> и <CODE>print-X-axis-numbered-line</CODE>
</OL>
<P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp-intro-ru_23.html#SEC235">C.3.1 Маркеры оси X</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Создаем метки для горизонтальной оси.</TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Маркеры оси X"></A>
<HR SIZE="6">
<A NAME="SEC235"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC234"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC236"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC229"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC234"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC236"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_24.html#SEC243">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H3> C.3.1 Маркеры оси X </H3>
<!--docid::SEC235::-->
<P>

Первая функция должна напечатать маркеры для оси X.  Нам надо будет
задать сами маркеры и разделяющее их пространство.
 
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defvar X-axis-label-spacing 
  (if (boundp 'graph-blank)
      (* 5 (length graph-blank)) 5)
  "Количество символьных единиц от одной метки оси X до другой.")
</pre></td></tr></table></P><P>

(Напомним, что значение <CODE>graph-blank</CODE> инициализируется тоже с
помощью выражения <CODE>defvar</CODE>.  Предикат <CODE>boundp</CODE> проверяет
инициализировани ли его аргумент; если нет то <CODE>boundp</CODE> возвращает
<CODE>nil</CODE>.  Если бы символ <CODE>graph-blank</CODE> был бы еще
неинициализирован и мы бы не использовали условную конструкцию
<CODE>if</CODE>, тогда бы мы получили следующее сообщение об ошибке
<SAMP>`Symbol's value as variable is void'</SAMP>.)
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defvar X-axis-tic-symbol "|"
  "Строка для обозначения маркера по оси X.")
</pre></td></tr></table></P><P>

Наша цель напечатать строку, которая выглядит следующим образом:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>       |   |    |    |
</pre></td></tr></table></P><P>

Первый маркер выровнен так, чтобы находиться под первой колонкой графика
и освобождать место для оси Y.
</P><P>

Один полный элемент маркера состоит из пробелов, которые продолжаются от
одной метки до другой, плюс символ маркера.  Необходимое число пробелов
можно определить зная ширину символа маркера и
<CODE>X-axis-label-spacing</CODE>.
</P><P>

Соответствующий фрагмент кода выглядит следующим образом:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>;;; X-axis-tic-element
<small>...</small>
(concat  
 (make-string 
  ;; Создаем строку пробелов.
  (-  (* symbol-width X-axis-label-spacing)
      (length X-axis-tic-symbol))
  ? )
 ;; Соединяем пробелы с символом маркера.
 X-axis-tic-symbol)
<small>...</small>
</pre></td></tr></table></P><P>

Теперь давайте определим сколько пробелов понадобится для того, чтобы
правильно выровнять первую метку с первым столбцом графика.  Здесь мы
будем использовать значение <CODE>full-Y-label-width</CODE> вычисляемое в
функции <CODE>print-graph</CODE>.
</P><P>

Соответствующий код выглядит следующим образом:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>;; X-axis-leading-spaces
<small>...</small>
(make-string full-Y-label-width ? )
<small>...</small>
</pre></td></tr></table></P><P>

Также нам надо определить длину горизонтальной оси, которая равна длине
списка номеров и количеству меток на горизонтальной оси:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>;; X-length 
<small>...</small>
(length numbers-list)              

;; tic-width
<small>...</small>
(* symbol-width X-axis-label-spacing)

;; number-of-X-tics 
(if (zerop (% (X-length tic-width)))
    (/ (X-length tic-width))
  (1+ (/ (X-length tic-width))))
</pre></td></tr></table></P><P>

Теперь все готово для создания функции, которая напечатает строку
координатных маркеров по оси X:
</P><P>

<A NAME="IDX123"></A>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun print-X-axis-tic-line
  (number-of-X-tics X-axis-leading-spaces X-axis-tic-element)
  "Печатает маркеры для ось X." 
    (insert X-axis-leading-spaces)
    (insert X-axis-tic-symbol)  ; Под первой колонкой.
    ;; Вставка второго маркера в правильное место.
    (insert (concat  
             (make-string 
              (-  (* symbol-width X-axis-label-spacing)
                  ;; Вставка пробелов до второго маркера.
                  (* 2 (length X-axis-tic-symbol)))
              ? )
             X-axis-tic-symbol))
    ;; Вставка остальных маркеров.
    (while (&#62; number-of-X-tics 1)
      (insert X-axis-tic-element)
      (setq number-of-X-tics (1- number-of-X-tics))))
</pre></td></tr></table></P><P>

Вставка строки номеров очень похожа:
</P><P>

Вначале мы создаем пронумерованный элемент с необходимым числом пробелов
перед каждым номером:
</P><P>

<A NAME="IDX124"></A>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun X-axis-element (number)
  "Создаем пронумерованный элемент для оси X."
  (let ((leading-spaces 
         (-  (* symbol-width X-axis-label-spacing)
             (length (int-to-string number)))))
    (concat (make-string leading-spaces ? )
            (int-to-string number))))
</pre></td></tr></table></P><P>

Теперь можно написать функцию, которая напечатает строку номеров для
координатной оси, при этом под первым столбцом графика мы напечатаем
"1":
</P><P>

<A NAME="IDX125"></A>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun print-X-axis-numbered-line
  (number-of-X-tics X-axis-leading-spaces)
  "Печатает строку номеров по оси  X"
  (let ((number X-axis-label-spacing))
    (insert X-axis-leading-spaces)
    (insert "1")
    (insert (concat  
             (make-string 
              ;; Вставка пробелов до следующего числа.
              (-  (* symbol-width X-axis-label-spacing) 2)
              ? )
             (int-to-string number)))
    ;; Вставка оставшихся чисел.
    (setq number (+ number X-axis-label-spacing))
    (while (&#62; number-of-X-tics 1)
      (insert (X-axis-element number))
      (setq number (+ number X-axis-label-spacing))
      (setq number-of-X-tics (1- number-of-X-tics)))))
</pre></td></tr></table></P><P>

Наконец нам надо создать функцию <CODE>print-X-axis</CODE>, в которой мы будем
использовать и <CODE>print-X-axis-tic-line</CODE> и
<CODE>print-X-axis-numbered-line</CODE>.
</P><P>

Эта функция должна определить локальные значения переменных,
используемые и <CODE>print-X-axis-tic-line</CODE> и
<CODE>print-X-axis-numbered-line</CODE>, и вызвать эти две функции.  Также она
должна напечатать символ перевода строки, которая должна разделять
строку маркеров и строку номеров.
</P><P>

Функция состоит из списка переменных, который описывает пять локальных
переменных, и вызовов каждой из двух печатающих различные строки
функций:
</P><P>

<A NAME="IDX126"></A>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun print-X-axis (numbers-list)
  "Печатать метки для оси X длины NUMBERS-LIST."
  (let* ((leading-spaces 
          (make-string full-Y-label-width ? ))
       ;; ширина символа находится  graph-body-print
       (tic-width (* symbol-width X-axis-label-spacing))
       (X-length (length numbers-list))
       (X-tic
        (concat  
         (make-string 
          ;; Создаем строку пробелов.
          (-  (* symbol-width X-axis-label-spacing)
              (length X-axis-tic-symbol))
          ? )
         ;; Обьединяем пробелы с символом маркера.
         X-axis-tic-symbol))
       (tic-number
        (if (zerop (% X-length tic-width))
            (/ X-length tic-width)
          (1+ (/ X-length tic-width)))))
    (print-X-axis-tic-line tic-number leading-spaces X-tic)
    (insert "\n")
    (print-X-axis-numbered-line tic-number leading-spaces)))
</pre></td></tr></table></P><P>

Давайте проверим <CODE>print-X-axis</CODE>:
</P><P>

<OL>
<LI>
Установите <CODE>X-axis-tic-symbol</CODE>, <CODE>X-axis-label-spacing</CODE>,
<CODE>print-X-axis-tic-line</CODE>, так же как <CODE>X-axis-element</CODE>,
<CODE>print-X-axis-numbered-line</CODE>, и <CODE>print-X-axis</CODE>.
<P>

<LI>
<P>

Скопируйте следующее выражение:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(progn
 (let ((full-Y-label-width 5)
       (symbol-width 1))
   (print-X-axis
    '(1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16))))
</pre></td></tr></table></P><P>

<LI>
Переключитесь в буфер <TT>`*scratch*'</TT> и расположите курсор в то место,
откуда вы будет печатать горизонтальную ось.
<P>

<LI>
Наберите <KBD>M-:</KBD> (<CODE>eval-expression</CODE>).
<P>

<LI>
Скопируйте проверочное выражение в минибуфер с помощью <KBD>C-y</KBD>
(<CODE>yank)</CODE>.
<P>

<LI>
Нажмите <KBD>RET</KBD> для того чтобы вычислит это выражение.
</OL>
<P>

Emacs должен напечатать следующую горизонтальную ось:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>     |   |    |    |    |
     1   5   10   15   20
</pre></td></tr></table></P><P>

<A NAME="Печать полного графика"></A>
<HR SIZE="6">
<A NAME="SEC236"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC235"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC237"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC234"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC226"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_24.html#SEC243"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_24.html#SEC243">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> C.4 Печать полного графика </H2>
<!--docid::SEC236::-->
<P>

Сейчас мы почти готовы создать функцию для печати всего графика.
</P><P>

Функция для печати графика с координатными осями будет в целом
соответствовать шаблону, который мы уже создали ранее, (see section <A HREF="elisp-intro-ru_23.html#SEC226">Пример графика с пометками</A>) но с небольшими добавлениями.
</P><P>

Вот и шаблон:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun print-graph (numbers-list)
  "<VAR>документация</VAR><small>...</small>"
  (let ((height  <small>...</small>
        <small>...</small>))
    (print-Y-axis height <small>...</small> )
    (graph-body-print numbers-list)
    (print-X-axis <small>...</small> )))
</pre></td></tr></table></P><P>

Последняя версия будет отличаться от более ранней двумя нюансами:
во-первых, она содержит дополнительных локальные переменные; а во-вторых
мы предусмотрим опцию, которая будет задавать масштаб меток по оси.  Это
может оказаться очень критичным; в противном случае в графике может быть
больше строк чем способно уместиться на дисплее или на листе бумаги.
</P><P>

Эта новая возможность требует незначительной модификации функции
<CODE>Y-axis-column</CODE>, надо добавить необязательный параметр
<CODE>vertical-step</CODE>.  Функция выглядит следующим образом:
</P><P>

<A NAME="IDX127"></A>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>;;; Последняя версия.
(defun Y-axis-column
  (height width-of-label &#38;optional vertical-step)
  "Создает список меток для оси Y.
HEIGHT это максимальная высота графика.  
WIDTH-OF-LABEL это максимальная высота метки.
VERTICAL-STEP это положительное целое, 
которое задает масштаб по оси Y.  Например,
шаг равный 5 означает, что каждая строка содержит
пять единиц на графике."
  (let (Y-axis
        (number-per-line (or vertical-step 1)))
    (while (&#62; height 1)
      (if (zerop (% height Y-axis-label-spacing))
          ;; Вставить метку.
          (setq Y-axis
                (cons
                 (Y-axis-element
                  (* height number-per-line)
                  width-of-label)
                 Y-axis))
        ;; Иначе, вставить пробелы.
        (setq Y-axis
              (cons
               (make-string width-of-label ? )
               Y-axis)))
      (setq height (1- height)))
    ;; Вставить основную линию.
    (setq Y-axis (cons (Y-axis-element 
                        (or vertical-step 1)
                        width-of-label)
                       Y-axis))
    (nreverse Y-axis)))
</pre></td></tr></table></P><P>

Значения для максимальной высоты графика и ширины символа вычисляются
функцией <CODE>print-graph</CODE> в выражении <CODE>let</CODE>; поэтому функцию
<CODE>graph-body-print</CODE> надо немного изменить.
</P><P>

<A NAME="IDX128"></A>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>;;; Последняя версия.
(defun graph-body-print (numbers-list height symbol-width)
  "Печатает столбцовый график для NUMBERS-LIST.
numbers-list состоит из значений по оси Y.
HEIGHT это максимальная высота графика.
SYMBOL-WIDTH это номер каждой колонки."
  (let (from-position)
    (while numbers-list
      (setq from-position (point))
      (insert-rectangle
       (column-of-graph height (car numbers-list)))
      (goto-char from-position)
      (forward-char symbol-width)
      ;; Рисует график столбец за столбцом.
      (sit-for 0)               
      (setq numbers-list (cdr numbers-list)))
    ;; Переместить точку для печати оси X.
    (forward-line height)
    (insert "\n")))
</pre></td></tr></table></P><P>

Наконец код функции <CODE>print-graph</CODE>:
</P><P>

<A NAME="IDX129"></A>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>;;; Последняя версия.
(defun print-graph
  (numbers-list &#38;optional vertical-step)
  "Печатает график с координатными осями согласно NUMBERS-LIST.
NUMBERS-LIST состоит из значений по оси Y.

Необязательный параметр VERTICAL-STEP это положительное число
задает масштаб по оси Y. Например, шаг равный 5 означает,
что каждая строка содержит пять единиц на графике."
  (let* ((symbol-width (length graph-blank))
         ;; <CODE>height</CODE> это наибольшее число.
         (height (apply 'max numbers-list))
         (height-of-top-line
          (if (zerop (% height Y-axis-label-spacing))
              height
            ;; else
            (* (1+ (/ height Y-axis-label-spacing))
               Y-axis-label-spacing)))
         (vertical-step (or vertical-step 1))
         (full-Y-label-width
          (length
           (concat
            (int-to-string
             (* height-of-top-line vertical-step))
            Y-axis-tic))))

    (print-Y-axis
     height-of-top-line full-Y-label-width vertical-step)
    (graph-body-print
     numbers-list height-of-top-line symbol-width)
    (print-X-axis numbers-list)))
</pre></td></tr></table></P><P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp-intro-ru_23.html#SEC237">C.4.1 Проверка функции <CODE>print-graph</CODE></A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Быстрая проверка.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp-intro-ru_23.html#SEC238">C.4.2 График количества слов в функциях</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp-intro-ru_23.html#SEC242">C.4.3 Окончательная печать графика</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Проверка print-graph"></A>
<HR SIZE="6">
<A NAME="SEC237"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC236"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC238"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC234"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC236"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_24.html#SEC243"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_24.html#SEC243">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H3> C.4.1 Проверка функции <CODE>print-graph</CODE> </H3>
<!--docid::SEC237::-->
<P>

Мы можем вначале проверить функцию <CODE>print-graph</CODE> с помощью
короткого списка чисел
</P><P>

<OL>
<LI>
Установите последнии версии <CODE>Y-axis-column</CODE>,
<CODE>graph-body-print</CODE> и <CODE>print-graph</CODE> (а также весь остальной
код.)
<P>

<LI>
Скопируйте следующее выражение:
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(print-graph '(3 2 5 6 7 5 3 4 6 4 3 2 1))
</pre></td></tr></table></P><P>

<LI>
Переключитесь в буфер <TT>`*scratch*'</TT> и расположите курсор в то место,
где вы хотите напечать график.
<P>

<LI>
Наберите <KBD>M-:</KBD> (<CODE>eval-expression</CODE>).
<P>

<LI>
Скопируйте проверочное выражение в минибуфер с помощью <KBD>C-y</KBD>
(<CODE>yank)</CODE>.
<P>

<LI>
Нажмите <KBD>RET</KBD> для того чтобы вычислит это выражение.
</OL>
<P>

Emacs напечатает следующий график:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>10 -              
                  
                  
         *        
        **   *    
 5 -   ****  *    
       **** ***   
     * *********  
     ************ 
 1 - *************

     |   |    |    |
     1   5   10   15
</pre></td></tr></table></P><P>

С другой стороны, если вы передадите в <CODE>print-graph</CODE> значение 2 для
аргумента <CODE>vertical-step</CODE>, вычислив следующее выражение:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(print-graph '(3 2 5 6 7 5 3 4 6 4 3 2 1) 2)
</pre></td></tr></table></P><P>

График будет выглядеть следующим образом:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>20 -              
                  
                  
         *        
        **   *    
10 -   ****  *    
       **** ***   
     * *********  
     ************ 
 2 - *************

     |   |    |    |
     1   5   10   15
</pre></td></tr></table></P><P>

<A NAME="График кол. слов в функциях"></A>
<HR SIZE="6">
<A NAME="SEC238"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC237"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC239"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC234"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC236"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC242"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_24.html#SEC243">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H3> C.4.2 График количества слов в функциях </H3>
<!--docid::SEC238::-->
<P>

Теперь мы сможем наконец полностью напечатать график, который покажет
сколько определений функций содержит менее 10 слов и символов, сколько
между 10 и 19, сколько между 20 и 29 и так далее.
</P><P>

Это многошаговый процесс.  Сначала убедитесь, что вы загрузили весь
требуемый код.
</P><P>

Неплохая мысль заново установить <CODE>top-of-ranges</CODE> в случае если вы
уже установили ее в другое значение.  Вы можете вычислить следующее:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(setq top-of-ranges
 '(10  20  30  40  50
   60  70  80  90 100
  110 120 130 140 150
  160 170 180 190 200
  210 220 230 240 250
  260 270 280 290 300)
</pre></td></tr></table></P><P>

Затем надо создать список номеров слов и символов в каждом диапазоне.
</P><P>

Вычислите следующее:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(setq list-for-graph
       (defuns-per-range
         (sort
          (recursive-lengths-list-many-files 
           (directory-files "/usr/local/emacs/lisp"
                            t ".+el$"))
          '&#60;)
         top-of-ranges))
</pre></td></tr></table></P><P>

На моей машине это заняло около одного часа.  Необходимо было
просмотреть все 303 файла в моей версии Emacs.  После всех вычислений
переменная <CODE>list-for-graph</CODE> имела следующее значение:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(537 1027 955 785 594 483 349 292 224 199 166 120 116 99 
90 80 67 48 52 45 41 33 28 26 25 20 12 28 11 13 220)
</pre></td></tr></table></P><P>

Все это значило, что в моей версии Emacs было 537 определений функции, в
которых было менее 10 слов, 1027 определений функции, в которых от 10 до
19 слов, 955 определений функции, в которых 20 от 29 слов, и так далее.
</P><P>

Ясно, что одного взгляда на этот список достаточно, чтобы понять что
наибольшее число функции содержат от десяти до тридцати слов.
</P><P>

Теперь о печати.  Мы <EM>не</EM> хотим напечатать график в котором около
тысячи строк <small>...</small>.  Вместо этого нам бы хотелось напечатать график в
котором менее 25 строк.  Это число строк можно отобразить почти на любом
мониторе.
</P><P>

Это означает, что каждое значение в списке <CODE>list-for-graph</CODE> надо
уменьшить в пятьдесят раз.
</P><P>

Ниже коротенькая функция, которая сможет сделать это правда с помощью
двух еще незнакомых нам функций, <CODE>mapcar</CODE> и <CODE>lambda</CODE>.
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun one-fiftieth (full-range)
  "Возвращает список, каждый элемент которого уменьшен в 50 раз."
 (mapcar '(lambda (arg) (/ arg 50)) full-range))
</pre></td></tr></table></P><P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp-intro-ru_23.html#SEC239">Выражение <CODE>lambda</CODE></A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Создание безымянной функции.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp-intro-ru_23.html#SEC240">Функция <CODE>mapcar</CODE></A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Запуск функции для каждого элемента списка.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp-intro-ru_23.html#SEC241">Последняя ошибка <small>...</small> самая коварная</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Последняя ошибка обычно самая коварная.</TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="lambda"></A>
<HR SIZE="6">
<A NAME="SEC239"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC238"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC240"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC237"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC238"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC242"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_24.html#SEC243">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H4> Выражение <CODE>lambda</CODE> </H4>
<!--docid::SEC239::-->
<P>

<CODE>lambda</CODE> это символ, обозначающий безымянную функцию, то есть
функцию, которой не присвоено имя.  Каждый раз когда вы используете
безымянную функцию вам нужно включать все ее определение.
</P><P>

Например,
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(lambda (arg) (/ arg 50))
</pre></td></tr></table></P><P>

это определение функции, котороя возвращает результат от деления
переданного ее аргумента <CODE>arg</CODE> на 50.
</P><P>

В одной из ранних глав мы создали функцию <CODE>умножить-на-семь</CODE>,
которая, как вы сразу же вспомнили умножала, переданный в нее аргумент
на семь.  Безымянная функция, выполняющая ту же работу, будет выглядеть
следующим образом:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(lambda (number) (* 7 number))
</pre></td></tr></table></P><P>

(See section <A HREF="elisp-intro-ru_5.html#SEC43">The <CODE>defun</CODE> Special Form</A>.)
</P><P>

если нам понадобиться умножить 3 на 7, мы можем написать:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(умножить-на-семь 3)
 \_______________/ ^
         |         |
      функция  аргумент
</pre></td></tr></table></P><P>

Это выражение вернет 21.
</P><P>

С помощью безымянной функции, надо написать следующее:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>((lambda (number) (* 7 number)) 3)
 \____________________________/ ^
               |                |
     безымянная функция     аргумент
</pre></td></tr></table></P><P>

Если нам надо разделить 100 на 50, тогда мы запишем:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>((lambda (arg) (/ arg 50)) 100)
 \______________________/  \_/
             |              |
    безымянная функция     аргумент             
</pre></td></tr></table></P><P>

Это выражение вернет 2.  В функцию передан аргумент 100, который будет
разделен на 50.
</P><P>

Дополнительную информацию о безымянных функция можно найти как всегда в
справочном руководстве по Emacs Lisp See section `Lambda Expressions' in <CITE>The GNU Emacs Lisp Reference Manual</CITE>.
</P><P>

<A NAME="mapcar"></A>
<HR SIZE="6">
<A NAME="SEC240"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC239"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC241"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC237"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC238"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC242"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_24.html#SEC243">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H4> Функция <CODE>mapcar</CODE> </H4>
<!--docid::SEC240::-->
<P>

<CODE>mapcar</CODE> это функция, которая по очередно вызывает свой первый
аргумент (функцию) с каждым элементом своего второго аргумента.  Второй
аргумент должен быть списком.
</P><P>

Например, 
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(mapcar '1+ '(2 4 6))
     => (3 5 7)
</pre></td></tr></table></P><P>

Функция <CODE>1+</CODE>, добавляющая единицу к своему аргументу выполняется
для каждого элемента списка, в результате чего возвращается новый
список.
</P><P>

Сравните действие функции <CODE>mapcar</CODE> с функцией <CODE>apply</CODE>, которая
применяет свой первый аргумент ко всем оставшимся сразу.
(See section <A HREF="elisp-intro-ru_17.html#SEC185">Изготовляем график</A>, где описано
использование <CODE>apply</CODE>.)
</P><P>

В определении <CODE>one-fiftieth</CODE> первый аргумент это безымянная
функция:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(lambda (arg) (/ arg 50))
</pre></td></tr></table></P><P>

а второй аргумент это <CODE>full-range</CODE>, который будет связан с
<CODE>list-for-graph</CODE>.
</P><P>

Таким образом все выражение будет выглядеть следующим образом:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(mapcar '(lambda (arg) (/ arg 50)) full-range)
</pre></td></tr></table></P><P>

See section `Mapping Functions' in <CITE>The GNU Emacs Lisp Reference Manual</CITE>, можно найти дополнительную информацию о
<CODE>mapcar</CODE>.
</P><P>

С помощью функции <CODE>one-fiftieth</CODE> мы можем создать список в котором
каждый элемент будет в пятьдесят раз меньше чем соответствующий элемент
в списке <CODE>list-for-graph</CODE>.
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(setq fiftieth-list-for-graph
      (one-fiftieth list-for-graph))
</pre></td></tr></table></P><P>

Результирующий список выглядит следующим образом:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(10 20 19 15 11 9 6 5 4 3 3 2 2 
1 1 1 1 0 1 0 0 0 0 0 0 0 0 0 0 0 4)
</pre></td></tr></table></P><P>

Вот этот список мы почти готовы напечатать!
</P><P>

<A NAME="Последняя ошибка"></A>
<HR SIZE="6">
<A NAME="SEC241"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC240"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC242"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC237"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC238"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC242"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_24.html#SEC243">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H4> Последняя ошибка <small>...</small> самая коварная </H4>
<!--docid::SEC241::-->
<P>

Я сказал `почти готовы печатать'!  Конечно же есть ошибка в функции
<CODE>print-graph</CODE> <small>...</small>.  В ней есть опция <CODE>vertical-step</CODE>, но
нет опции <CODE>horizontal-step</CODE>.  Переменная <CODE>top-of-range</CODE>
принимает значения от 10 до 300 с шагом 10.  Но функция
<CODE>print-graph</CODE> напечатает только первые значения.
</P><P>

Это класический пример ошибки, которые некоторые считают наиболее
коварным типом ошибки, ошибка упущения.  Эту ошибку вы не сможете найти
изучая программу, так как ее нет там; это упущенная возможность.  Лучше
всего если вы будете чаще переписывать свою программу; и попробуете
писать программу, так чтобы ее было легче понимать и изменять.
Попытайтесь осознать, очень простой факт, все что вы написали рано или
поздно <EM>надо будет</EM> изменить.  Это основной закон практического
программирования.
</P><P>

Основному изменению подвергнется функция
<CODE>print-X-axis-numbered-line</CODE>, после этого надо будет немного
подправить функции <CODE>print-X-axis</CODE> и <CODE>print-graph</CODE>.  Не так уж
много, но есть одна тонкость числа должны быть под символами маркера.
Придется немного подумать.
</P><P>

Ниже скорректированная функция <CODE>print-X-axis-numbered-line</CODE>:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun print-X-axis-numbered-line
  (number-of-X-tics X-axis-leading-spaces
   &#38;optional horizontal-step)
  "Печать строки номеров по оси X"
  (let ((number X-axis-label-spacing)
        (horizontal-step (or horizontal-step 1)))
    (insert X-axis-leading-spaces)
    ;; Удаляем лишние ведущие пробелы.
    (delete-char
     (- (1-
         (length (int-to-string horizontal-step)))))
    (insert (concat  
             (make-string 
              ;; Вставка пробелов.
              (-  (* symbol-width
                     X-axis-label-spacing) 
                  (1-
                   (length
                    (int-to-string horizontal-step)))
                  2)
              ? )
             (int-to-string
              (* number horizontal-step))))
    ;; Вставка оставшися чисел.
    (setq number (+ number X-axis-label-spacing))
    (while (&#62; number-of-X-tics 1)
      (insert (X-axis-element
               (* number horizontal-step)))
      (setq number (+ number X-axis-label-spacing))
      (setq number-of-X-tics (1- number-of-X-tics)))))
</pre></td></tr></table></P><P>

Если вы читаете этот документ в Инфо, вы можете увидеть полностью новые
версии функций <CODE>print-X-axis</CODE> <CODE>print-graph</CODE> и вычислить их.
Если вы читаете книгу, вы увидите только измененные строки (не хочется
печатать слишком много лишнего).
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun print-X-axis (numbers-list horizontal-step)
  "Печатает ось X согласно длине NUMBERS-LIST.
Необязательный параметр, HORIZONTAL-STEP, это положительное число,
задающее масштаб по оси X."
;; Значение SYMBOL-WIDTH и FULL-Y-LABEL-WIDTH 
;; вычисляются в `print-graph'.
  (let* ((leading-spaces 
          (make-string full-Y-label-width ? ))
       ;; SYMBOL-WIDTH нужен graph-body-print
       (tic-width (* symbol-width X-axis-label-spacing))
       (X-length (length numbers-list))
       (X-tic
        (concat  
         (make-string 
          ;; Создаем строку из пробелов.
          (-  (* symbol-width X-axis-label-spacing)
              (length X-axis-tic-symbol))
          ? )
         ;; Соединяем пробелы с символом маркера.
         X-axis-tic-symbol))
       (tic-number
        (if (zerop (% X-length tic-width))
            (/ X-length tic-width)
          (1+ (/ X-length tic-width)))))

    (print-X-axis-tic-line
     tic-number leading-spaces X-tic)
    (insert "\n")
    (print-X-axis-numbered-line
     tic-number leading-spaces horizontal-step)))
</pre></td></tr></table></P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun print-graph
  (numbers-list &#38;optional vertical-step horizontal-step)
  "Печатает график с координатными осями согласно NUMBERS-LIST.
NUMBERS-LIST состоит из значений по оси Y.

Необязательный параметр, VERTICAL-STEP, это положительное число,
задающее масштаб по оси Y.  Например шаг равный 5 означает, что в
каждой строке содержится пять единиц.

Необязательный параметр, HORIZONTAL-STEP, это положительное число,
задающее масштаб по оси Y."
  (let* ((symbol-width (length graph-blank))
         ;; <CODE>height</CODE> это наибольшее число
         ;; and the number with the most digits.
         (height (apply 'max numbers-list))
         (height-of-top-line
          (if (zerop (% height Y-axis-label-spacing))
              height
            ;; else
            (* (1+ (/ height Y-axis-label-spacing))
               Y-axis-label-spacing)))
         (vertical-step (or vertical-step 1))
         (full-Y-label-width
          (length
           (concat
            (int-to-string
             (* height-of-top-line vertical-step))
            Y-axis-tic))))

    (print-Y-axis
     height-of-top-line full-Y-label-width vertical-step)
    (graph-body-print
        numbers-list height-of-top-line symbol-width)
    (print-X-axis numbers-list horizontal-step)))
</pre></td></tr></table></P><P>

<A NAME="Напечатанный график Graph"></A>
<HR SIZE="6">
<A NAME="SEC242"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC241"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_24.html#SEC243"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC238"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC236"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_24.html#SEC243"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_24.html#SEC243">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H3> C.4.3 Окончательная печать графика </H3>
<!--docid::SEC242::-->
<P>

Теперь когда вы все исправили и заново установили можно наконец вызвать
функцию <CODE>print-graph</CODE> следующим образом:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(print-graph fiftieth-list-for-graph 50 10)
</pre></td></tr></table></P><P>

А вот и долгожданный график:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>1000 -  *                             
        **                            
        **                            
        **                            
        **                            
 750 -  ***                           
        ***                           
        ***                           
        ***                           
        ****                          
 500 - *****                          
       ******                         
       ******                         
       ******                         
       *******                        
 250 - ********                       
       *********                     *
       ***********                   *
       *************                 *
  50 - ***************** *           *
       |   |    |    |    |    |    |    |
      10  50  100  150  200  250  300  350
</pre></td></tr></table></P><P>

Из графика видно, что больше всего функций, которые содержат от 10 до 19
слов.
</P><P>

<A NAME="Index"></A>
<HR SIZE="6">
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_23.html#SEC238"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_24.html#SEC243"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_24.html#SEC243">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp-intro-ru_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<BR>  
<FONT SIZE="-1">
This document was generated
on <I>March, 10  2004</I>
using <A HREF="http://www.mathematik.uni-kl.de/~obachman/Texi2html
"><I>texi2html</I></A>

<script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">_uacct = "UA-78697-3"; urchinTracker(); </script></body>
</HTML>
